jQuery(function(e){function a(e){for(var a="",t=e.split(/(<[^<>]+>)/g),n=0,i=0;i<t.length;i++){var s=t[i];if(s.match(/^<code[\s>]|^<pre[\s>]|^<style[\s>]|^<script[\s>]/g)?n++:0!==n&&s.match(/^<\/code[\s>]|^<\/pre[\s>]|^<\/style[\s>]|^<\/script[\s>]/g)&&n--,0!==n||0===s.length||"<"===s.charAt(0)&&s.match(/^<\s*[\w]{1,20}:\/\//g))a+=s;else{var o=" "+s+" ";o=o.replace(/([\s(<.,;:!?])([\w]{1,20}:\/\/(?=\S{1,2000}\s)[\w\x80-\x9f\xa1-\xff#%~\/@\[\]*(+=&$-]*(?:['.,;:!?)][\w\x80-\x9f\xa1-\xff#%~\/@\[\]*(+=&$-]+)*)(\)?)/g,' <a href="$2">$2</a>'),o=o.replace(/([\s>])((www|ftp)\.[\w\x80-\xff#$%&~\/.\-;:=,?@\[\]+]+)/gi,' <a href="http://$2">$2</a>'),o=o.replace(/([\s>])([.0-9a-z_+-]+)@(([0-9a-z-]+\.)+[0-9a-z]{2,})/gi,' <a href="mailto:$2@$3">$2@$3</a>'),o=o.substr(1,o.length-2),a+=o}}return a=a.replace(/(<a([ \r\n\t]+[^>]+?>|>))<a [^>]+?>([^>]+?)<\/a><\/a>/g,"$1$3</a>")}function t(e){return"undefined"!=typeof sharedValidation?sharedValidation.Utils.getFirstInvalidLink(e):""}function n(e,a){this.allowedNumberOfLinks=e,this.validateMaxLinks=a}n.prototype.validate=function(e,n,i){var s=a(e),o=s.match(/<a [^>]*href/g),l=!0;if(o){var r=o.length,d=t(e);if(""!==d){var c=utilsArgs.linksValidationErrMsg.replace("%s",d);n(c),l=!1}else this.validateMaxLinks&&this.allowedNumberOfLinks<r&&(n("No more than "+this.allowedNumberOfLinks+" links are allowed in comments. Please reduce the number of links."),l=!1)}l&&i()},e(document).ready(function(){function a(e){this.callbacks=[],this.textarea=e,this._observe()}var t=window.commentValidation.BLOGS_PAGE,i=window.commentValidation.max_links_number,s=window.commentValidation.validateMaxLinks;if("single"===t)e(document).on("tinymce-editor-setup",function(a,t){var o=e(t.formElement).find(".validation-message .validation-message__text"),l=e("#submit"),r=e(t.formElement).closest(".comment-respond").find(".save.button"),d=new n(i,s),c=function(e){o.text(e),o.parent().removeClass("validation-message_hidden"),l.prop("disabled",!0),r.prop("disabled",!0)},m=function(){o.text(""),o.parent().addClass("validation-message_hidden"),l.prop("disabled",!1),r.prop("disabled",!1)},f=function(a){r=e(t.formElement).closest(".comment-respond").find(".save.button"),d.validate(a,c,m)};m(),t.on("Change",function(e){f(e.level.content)}),t.on("keyup",function(){f(t.getContent())})});else if("comment.php"===t){a.prototype._observe=function(){var e=this,a=e.textarea.value;setInterval(function(){var t=e.textarea.value;if(0!==a.localeCompare(t))for(var n=0;n<e.callbacks.length;n++)e.callbacks[n](t);a=t},500)},a.prototype.subscribe=function(e){this.callbacks.push(e)};var o=e("#"+wpActiveEditor),l=o.closest(".wp-editor-wrap"),r=e('<div class="comment-form__validaton-message validation-message validation-message_hidden"><span class="validation-message__text"></span></div>');l.prepend(r),r=r.find(".validation-message__text");var d=new n(i),c=new a(document.getElementById(wpActiveEditor)),m=e("#save");c.subscribe(function(e){d.validate(e,function(e){r.text(e),r.parent().removeClass("validation-message_hidden"),m.prop("disabled",!0)},function(){r.text(""),r.parent().addClass("validation-message_hidden"),m.prop("disabled",!1)})})}})});