!function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t){!function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=39)}([function(e,t,i){"use strict";var n=this&&this.__spreadArrays||function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<i;t++)for(var r=arguments[t],s=0,a=r.length;s<a;s++,o++)n[o]=r[s];return n};Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=t.LogTypes=void 0,function(e){e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error",e.TABLE="table",e.CUSTOM="custom"}(t.LogTypes||(t.LogTypes={}));var o=function(){function e(e){this.loggerSubject=e,this.isActive=!(!window._middyo||!window._middyo.debug)}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.logMessage("debug",e)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.logMessage("info",e)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.logMessage("error",e)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.logMessage("warn",e)},e.prototype.table=function(e){if(this.isActive)try{console.table(e)}catch(t){this.info("Table fallback: ",e)}},e.prototype.custom=function(e,t){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];var o=[{msg:e,style:t,args:i}];this.logMessage("custom",o)},e.prototype.logMessage=function(e,t){this.isActive&&("custom"!==e?console[e].apply(console,n(["["+this.loggerSubject+"]"],t)):console.info("%c["+this.loggerSubject+"] "+t[0].msg,t[0].style,t[0].args))},e.prototype.logWaterfallDetails=function(e,t,i){e.waterfall=e.waterfall||[];var n="x:"+e.ref.getBoundingClientRect().left+", y:"+e.offsetTop,o=e.selectedSize?e.selectedSize.w+"x"+e.selectedSize.h:"null";["header_bidding","ix"].includes(t.rt)?e.waterfall.push({provider:t.rt,adIndex:e.adIndex,adUnit:"-",size:o,position:n,isLazy:e.isLazyLoading,status:i}):(t.c=t.c,e.waterfall.push({provider:t.c.p,adIndex:e.adIndex,adUnit:t.c.au,size:o,position:n,isLazy:e.isLazyLoading,status:i})),this.info("Waterfall Table:"),this.table(e.waterfall)},e.prototype.hbLog=function(e,t,i,n){if(this.isActive){console.group("auction result "+t+", winner: %c"+(n&&n.bidder||"None"),"color:green;font-size:20px");var o=(e&&e.bids||[]).map((function(e){return{bidder:e.bidder,cpm:e.cpm,size:e.width+"x"+e.height,currency:e.currency}})),r=i.map((function(e){return{bidder:e.bidder,cpm:-1,size:"NA",currency:"NA"}}));this.table(o.concat(r)),console.groupEnd()}},e.prototype.apsLog=function(e,t){this.isActive&&(console.group(e+" result %c[aps]","color:green;font-size:20px"),this.table([t]),console.groupEnd())},e}();t.Logger=o},function(e,t,i){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__spreadArrays||function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<i;t++)for(var r=arguments[t],s=0,a=r.length;s<a;s++,o++)n[o]=r[s];return n};Object.defineProperty(t,"__esModule",{value:!0}),t.Utils=void 0;var r=i(3),s=i(41),a=i(2),l=i(10),d=i(7),p=i(4),c=i(5),u=i(6),f=i(16),h=function(){function e(){}return e.getBrowsiTag=function(){return window.top.browsitag||null},e.buildBrowsiOutput=function(t){var i,n;if(t.debugMode){var o=t.identity.pageviewId,s=Object.assign(t||{},{getFiredEvents:r.EventsService.getFiredEvents,f:e,getStayAwayElements:l.default.instance.getStayAwayElementsList});(null===(i=s.domData)||void 0===i?void 0:i.mainContent)&&(s.domData.mainContent.elements=(null===(n=c.SpotsUtils.getConf(p.SPOT_TAGS_MAP[p.SpotType.DYNAMIC_MC]))||void 0===n?void 0:n.elements)||[]),window.browsiOutput=window.browsiOutput?window.browsiOutput:{},window.browsiOutput[o]=window.browsiOutput[o]?Object.assign(window.browsiOutput[o],s):s,window.browsiOutput.state=t.state}},e.getBrowsiOutput=function(e){return e?window.browsiOutput[e]:window.browsiOutput[a.Profiler.get().identity.pageviewId]},e.querySelector=function(t,i){if(t)try{return e.getCurrentContextElement().querySelector(t)}catch(e){i("Invalid selector ["+t+"]")}return null},e.getLoaderParams=function(){return window._middyo},e.isEmptyObj=function(e){return 0===Object.keys(e).length},e.querySelectorAll=function(t,i,n){return t&&t.length?t.reduce((function(t,o){var r=[];try{r=Array.from((n?document:e.getCurrentContextElement()).querySelectorAll(o))}catch(e){i("Invalid selector ["+o+"]")}return t.concat(r)}),new Array):[]},e.querySelectorInsideElements=function(t,i,n){return e.querySelectorAll(t,n).filter((function(t){return i.includes(t)||e.isDescendantElement(i,t)}))},e.isElement=function(e){return e&&e instanceof Element},e.getPositionFallback=function(t){if(!t)return 0;var i=e.getElementPosition(t).top;if("none"!==t.style.display&&i>0)return i;for(var n,o=t.previousElementSibling;o;){if(n=e.getElementPosition(o).top,"none"!==o.style.display&&n>0)return o.getBoundingClientRect().height+n;o=o.previousElementSibling}return this.getPositionFallback(t.parentElement)},e.getElementPosition=function(e,t){var i={top:-1,left:-1};return e&&this.isElement(e)?((i=this.getElementCoordinates(e)).top=this.getOffsetIfEndless(i.top,e,t),i):i},e.getOffsetIfEndless=function(e,t,i){var n=d.DcsUtils.getIfEndless();if(n){i=i||a.Profiler.get().identity.pageviewId;var o=n.pvs.find((function(e){return e.pv===i}));o&&o.e&&(!t||o.e===t||o.e.contains(t))&&(e-=this.getElementCoordinates(o&&o.e||document.body).top)}return e},e.getPercentageInView=function(e){var t=e.getBoundingClientRect(),i=this.getViewportHeight();return(i-t.top)/i*100},e.isDescendantElement=function(e,t){for(var i=0,n=e;i<n.length;i++){var o=n[i];if(this.isContainedElement(o,t))return!0}return!1},e.isContainedElement=function(e,t){return!(!e||!t)&&!!(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY)},e.getElementSize=function(e){var t=e.getBoundingClientRect();return{h:t.height,w:t.width}},e.getDfpAdSize=function(e){var t=e.getElementsByTagName("iframe")[0];if(t)try{return{size:{w:+t.width,h:+t.height},element:t}}catch(e){}return{size:this.getElementSize(e),element:e}},e.getViewportHeight=function(){return window.innerHeight||0},e.getViewportWidth=function(){return Math.max(document.documentElement.clientWidth,window.innerWidth||0)},e.getElementFoldNumber=function(t){var i=(e.getElementPosition(t).top+s.FixedHeaderService.get().getNoneFixedHeaderSize())/e.getViewportHeight()+1;return Number(i.toFixed(2))},e.getScreenSize=function(){var e=window.top;return{w:e.screen.availWidth||e.screen.width,h:e.screen.availHeight||e.screen.height}},e.getPageWidth=function(){var e=window.top.document,t=e.body,i=e.documentElement;return Math.floor(Math.max(t.scrollWidth,t.offsetWidth,i.clientWidth,i.scrollWidth,i.offsetWidth))},e.getPageHeight=function(){var t=window.top.document,i=t.body,n=t.documentElement,o=Math.floor(Math.max(i.scrollHeight,i.offsetHeight,n.clientHeight,n.scrollHeight,n.offsetHeight));return d.DcsUtils.getIfEndless()?o-e.getElementPosition(d.DcsUtils.dcsElement).top:o},e.getElementCoordinates=function(e){var t=e.getBoundingClientRect(),i=document.body,n=document.documentElement,o=this.getPageYOffset(),r=window.top.pageXOffset||n.scrollLeft||i.scrollLeft,a=n.clientTop||i.clientTop||0,l=n.clientLeft||i.clientLeft||0,d=t.top+o-a+s.FixedHeaderService.get().getNoneFixedHeaderSize(),p=t.left+r-l;return{top:Math.round(d),left:Math.round(p)}},e.isVisible=function(t){var i=t;return e.isElement(i)&&null!==i.offsetParent&&i.getBoundingClientRect().height>1&&"0"!==window.getComputedStyle(i).opacity},e.calculateDistanceBetween=function(t,i){var n=0;if(t&&i&&t!==i){var o=e.sortElementsByDomOrder(t,i);n=e.getElementPosition(o.lower).top-e.getElementPosition(o.upper).top,e.isDescendantElement([o.upper],o.lower)||(n-=e.getElementSize(o.upper).h)}return n},e.calculateTextNodeHeight=function(t){var i=e.nextVisibleSibling(t),n=e.nextVisibleSibling(t,!0);if(i){if(t.nodeValue&&n)return e.calculateDistanceBetween(n,i)}else if(t.parentElement&&n){var o=t.parentElement.getBoundingClientRect(),r=n.getBoundingClientRect();return o.top+o.height-(r.top+r.height)}return 0},e.nextVisibleSibling=function(t,i){for(var n=i?t.previousElementSibling:t.nextElementSibling;n&&!e.isVisible(n);)n=i?n.previousElementSibling:n.nextElementSibling;return n},e.sortElementsByDomOrder=function(t,i){return e.getElementPosition(t).top<e.getElementPosition(i).top?{upper:t,lower:i}:{upper:i,lower:t}},e.sortedString=function(e){return e.sort().join(",")},e.getHighestElement=function(e,t){return this.sortElementsByDomOrder(e,t).upper},e.getMaxWrapSize=function(e){var t=e.filter((function(e){return e.optionalEmbeddings.includes("wrapped")}));return t.length?t.reduce((function(e,t){return e.h>t.h?e:t})):void 0},e.getWrappingOffset=function(e,t,i){return i&&!this.isContainedElement(e,t)?this.getMaxWrappingOffsetDistance(e,i):0},e.isFloatImage=function(e){if("IMG"!==e.nodeName)return!1;var t=window.getComputedStyle(e);return"right"===t.getPropertyValue("float")||"left"===t.getPropertyValue("float")},e.isParagraphElement=function(e){return"P"===e.nodeName},e.isEmptyParagraph=function(e){return!(!this.isParagraphElement(e)||this.isNullOrUndefined(e.textContent))&&0===e.textContent.replace(/\s*/,"").length},e.isPositionContained=function(e,t){return!!(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY)},e.isPositionOrderAs=function(e,t){return!!t&&!!(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_FOLLOWING)},e.isPositionFixed=function(e){return"fixed"===window.getComputedStyle(e).position||!!e.parentElement&&this.isPositionFixed(e.parentElement)},e.removeElementsPositionedAfter=function(t,i){return this.isNullOrUndefined(t)?i:i.filter((function(i){return e.isPositionOrderAs(i,t)}))},e.toUrlParams=function(e){return Object.keys(e).map((function(t){return t+"="+("object"==typeof e[t]?encodeURIComponent(JSON.stringify(e[t])):encodeURIComponent(e[t]))})).join("&")},e.onIframeLoad=function(e,t){if(e.contentWindow&&"complete"===e.contentWindow.document.readyState)t();else var i=window.setInterval((function(){e.contentWindow&&"complete"===e.contentWindow.document.readyState&&(window.clearInterval(i),t())}),100)},e.getMarginTopBySpotStyle=function(e,t,i){i=i.previousElementSibling&&"break"===t?i.previousElementSibling:e.ref;var n=window.getComputedStyle(i),o=16,r=n.margin.split(" ");if(n.margin){var s=Number(r[0].replace("px",""));o="break"===t?o-s:s}else if(n.marginTop){s=Number(n.marginTop.replace("px",""));o="break"===t?o-s:s}return(isNaN(o)||o<0)&&(o=16),o},e.getDfpEventSize=function(e){return e.size?{w:e.size[0],h:e.size[1]}:{w:-1,h:-1}},e.appendScript=function(e,t){return new Promise((function(i,n){var o,r=document.createElement("script");r.async=!0,r.setAttribute("src",e),r.addEventListener("load",(function(){i("success")})),r.addEventListener("error",(function(){n("error")})),(null===(o=t.iframe)||void 0===o?void 0:o.contentDocument)?t.iframe.contentDocument.body.appendChild(r):t.wrapper&&t.wrapper.appendChild(r)}))},e.createClass=function(e,t,i){var n=i.createElement("style");n.type="text/css",i.getElementsByTagName("head")[0].appendChild(n),(n.sheet||{}).insertRule?n.sheet.insertRule(e+"{"+t+"}",0):(n.styleSheet||n.sheet).addRule(e,t)},e.buildAdMarking=function(t,i){var n=document.createElement("div");n.innerText=i.text,n.id="browsi_adv_"+t.adIndex;var o=i.color?"height: 16px !important;\npadding: 0 !important;\nfont-family: Arial, sans-serif !important;\nmargin: auto !important;\nmargin-bottom: 10px !important;\ntext-align: center !important;\nline-height: 16px !important;\nfont-weight: normal !important;\ncolor:  "+i.color+" !important;\nfont-size: 11px !important;":i.customStyle?i.customStyle:"";return e.createClass(".browsi_adv_"+t.adIndex,o,document),n.setAttribute("class","browsi_adv_"+t.adIndex),n},e.getAdMarkingExpectedHeight=function(){var e=a.Profiler.get().spotEngineConfig.adMarking;if(e){if(e.expectedHeight)return e.expectedHeight;var t=this.calculateAdMarkingHeight(e);return e.expectedHeight=t,t}return 0},e.calculateAdMarkingHeight=function(e){var t=document.createElement("div");t.innerText=e.text;var i=e.color?"height: 16px !important;\npadding: 0 !important;\nfont-family: Arial, sans-serif !important;\nmargin: auto !important;\nmargin-bottom: 10px !important;\ntext-align: center !important;\nline-height: 16px !important;\nfont-weight: normal !important;\ncolor:  "+e.color+" !important;\nfont-size: 11px !important;":e.customStyle?e.customStyle:"";t.setAttribute("style",i),t.style.visibility="hidden",document.body.appendChild(t);var n=t.style.marginTop&&parseInt(t.style.marginTop)||0,o=t.style.marginBottom&&parseInt(t.style.marginBottom)||0,r=t.clientHeight+n+o;return document.body.removeChild(t),r},e.getScrollPosition=function(){var e=s.FixedHeaderService.get(),t={top:window.top.pageYOffset+e.getNoneFixedHeaderSize()+e.getFixedHeaderSize(),bottom:window.top.pageYOffset+window.top.innerHeight};return t.top=this.getOffsetIfEndless(t.top),t.bottom=this.getOffsetIfEndless(t.bottom),t},e.getLogStyle=function(e,t,i){return"font-size:"+e+"px;color:"+t+";background:"+i+";"},e.sortSpotsByOffsetTop=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.sort((function(e,t){return e.offsetTop-t.offsetTop}))},e.sortSpotsByPosition=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return t.sort((function(t,i){return e.getPositionFallback(t.ref)-e.getPositionFallback(i.ref)}))},e.sortElementsByPosition=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return t.sort((function(t,i){return e.getPositionFallback(t)-e.getPositionFallback(i)}))},e.sortByHeight=function(e){return e.sort((function(e,t){return e.h>t.h?1:-1}))},e.getCurrentTime=function(e){var t=Date.now();return e?Math.floor(t/1e3):t},e.isInCurrentArticle=function(e){var t=d.DcsUtils.getCurrentDcsElement();return!(t&&t instanceof Element)||this.isPositionContained(t,e)},e.isFixed=function(e){return!(!e||e===document.body)&&("fixed"===window.getComputedStyle(e).position||!!e.parentElement&&this.isFixed(e.parentElement))},e.is1x1=function(e){return 1===e.w&&1===e.h},e.isFluidSize=function(e){return 0===e.w&&0===e.h},e.merge=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Object.assign.apply(Object,o([{}],e))},e.getSpotCoords=function(t){return t.isImpression&&t.browsiAd.container?t.browsiAd.iframe?e.getElementPosition(t.browsiAd.iframe):e.getElementPosition(t.browsiAd.container):e.getElementPosition(t.ref)},e.getPageUrl=function(){return window.top.document.location.protocol+"//"+window.top.document.location.host+window.top.document.location.pathname},e.getUrlQueryParams=function(){var e=window.top.document.location.search.substring(1).split("&");return 0===e.length?"":(e.length>10&&(e.length=10),e.join("&"))},e.findParentElementByType=function(e,t){for(var i=null,n=0,o=Array.from(document.querySelectorAll(e));n<o.length;n++){var r=o[n];this.isContainedElement(r,t)&&(i=r)}return i},e.isObject=function(e){return e&&"object"==typeof e&&!Array.isArray(e)&&null!==e},e.mergeDeep=function(e,t){var i=this;return this.isObject(e)&&this.isObject(t)&&Object.keys(t).forEach((function(n){var o,r;i.isObject(t[n])?(e[n]||Object.assign(e,((o={})[n]={},o)),i.mergeDeep(e[n],t[n])):Object.assign(e,((r={})[n]=t[n],r))})),e},e.removeSpaces=function(e){return e.replace(/(\n|\r|\s+)/gm,"")},e.getMaxWrappingOffsetDistance=function(t,i){var n=t.parentElement?t.parentElement:t,o=getComputedStyle(n),r=n.getBoundingClientRect().width;r-=parseFloat(o.paddingLeft||"0")+parseFloat(o.paddingRight||"0");var s=e.getWrapFullSize(i),a=s.h+this.getAdMarkingExpectedHeight();return s.w*a/r-a},e.isPositionedAfter=function(e,t){return!!t&&!!(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_PRECEDING)},e.isPositionedDisconnected=function(e,t){return!!t&&!!(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_DISCONNECTED)},e.isPositionedBefore=function(e,t){return!!t&&!!(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_PRECEDING)},e.getEmbedTypesFromSizes=function(e){for(var t=[],i=!1,n=!1,o=0,r=e;o<r.length;o++)for(var s=0,a=r[o].optionalEmbeddings;s<a.length;s++){var l=a[s];if("break"!==l||n?"wrapped"!==l&&"left"!==l&&"right"!==l||i||(t.push("wrapped"),i=!0):(t.push(l),n=!0),n&&i)return t}return t},e.sizeToString=function(e){return e.w+"x"+e.h},e.toSize=function(e){void 0===e&&(e="");var t=/^(\d+)x(\d+)$/.exec(e);return t&&3===t.length?{w:Number(t[1]),h:Number(t[2])}:{w:-1,h:-1}},e.isEngagedUser=function(t){var i;if(!c.SpotsUtils.getOptimizeViewabilityTypes().includes(t.type))return!1;var n=a.Profiler.get();return!(!!(null===(i=c.SpotsUtils.getConf(t.tags))||void 0===i?void 0:i.engagedUsers)&&t.optimizeViewability)||e.getScrollPosition().top>0||n.isUserEngaged},e.removeElement=function(e){return!(!e||!e.parentElement)&&(e.parentElement.removeChild(e),!0)},e.throttle=function(e,t){var i=!1;return function(n){i||(e(n),i=!0,setTimeout((function(){i=!1,e(n)}),t))}},e.getCurrentFoldDecimal=function(){var e=this.getScreenSize();return this.getScrollPosition().top/e.h+1},e.getScrollDepthPercentages=function(){var e=this.getScrollingDistance();return this.getDepthPercentages(e)},e.getScrollingDistance=function(){return this.getPageYOffset()+this.getWindowHeight()},e.getDepthPercentages=function(e){var t=this.getPageHeight()||1;return e=e||0,Math.round(e/t*100)},e.getWindowHeight=function(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight},e.getPageYOffset=function(){return window.pageYOffset||("CSS1Compat"===document.compatMode?document.documentElement.scrollTop:document.body.scrollTop)},e.getNowInSeconds=function(){return Math.floor(Date.now()/1e3)},e.getTimeOffset=function(){return Date.now()-a.Profiler.get().identity.timeOffset},e.getCookie=function(e){var t=encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&"),i=new RegExp("(?:(?:^|.*;)\\s*"+t+"\\s*\\=\\s*([^;]*).*$)|^.*$"),n=document.cookie.replace(i,"$1");return decodeURIComponent(n)||""},e.compareObjectKeys=function(e,t){return JSON.stringify(Object.keys(e))===JSON.stringify(Object.keys(t))},e.getExternalFlowHandler=function(e){var t=a.Profiler.get().rules;if(t&&t[e]&&"function"==typeof t[e])return t[e]},e.toSet=function(e){var t=new Set;return e.forEach((function(e){return t.add(e)})),t},e.toUnique=function(e){var t=[];return this.toSet(e).forEach((function(e){return t.push(e)})),t},e.getMainContentSize=function(t){if(!t||!t.mainContent.lastElement||!t.mainContent.firstElement)return-1;var i=e.getElementPosition(t.mainContent.firstElement).top,n=t.mainContent.borderElement?e.getElementPosition(t.mainContent.borderElement).top:e.getElementPosition(t.mainContent.lastElement).top+t.mainContent.lastElement.getBoundingClientRect().height;return Math.round(n-i)},e.reportNewBrowsiAd=function(t){e.dispatchBrowsiAdEvent("ban",t)},e.reportBrowsiAdRemoved=function(t){e.dispatchBrowsiAdEvent("bar",t)},e.dispatchBrowsiAdEvent=function(e,t){var i=new CustomEvent(e,{detail:t});window.top.dispatchEvent(i)},e.clone=function(e){return JSON.parse(JSON.stringify(e))},e.getWrapFullSize=function(e){var t=a.Profiler.get().spotEngineConfig.spotStyle,i=t.l.p.r+t.l.p.l>t.r.p.r+t.r.p.l?t.l.p:t.r.p,n=t.l.m.r+t.l.m.l>t.r.m.r+t.r.m.l?t.l.m:t.r.m;return{w:e.w+i.l+n.l+i.r+n.r,h:e.h+i.b+n.b+i.t+n.t}},e.xhrPromise=function(e,t,i){return new Promise((function(n,o){var r=new XMLHttpRequest;r.open(t||"GET",e,!0),r.onreadystatechange=function(){r.readyState==XMLHttpRequest.DONE&&(r.status>=200&&r.status<300?n(r):o(null))},"POST"===t&&i?r.send(i):r.send()}))},e.logXhrRequestTime=function(e,t,i){var n=performance.getEntriesByType("resource").find((function(t){return t.name.includes(e)}));n&&n.duration&&u.ResponseTimeCollector.get().setXhrEnd(t,Number(n.duration.toFixed(2)),i)},e.findAllChildrenScripts=function(e){return Array.from(e.querySelectorAll("SCRIPT"))},e.isNullOrUndefined=function(e){return null==e},e.cloneAndEmbedBoostrap=function(){var e=document.querySelector("#browsi-tag"),t=document.createElement("script");return e?(Array.from(e.attributes).forEach((function(e){e.nodeName&&e.nodeValue&&t.setAttribute(e.nodeName,e.nodeValue)})),t.setAttribute("async",""),document.body.appendChild(t),e):null},e.getArticlesList=function(){var e=d.DcsUtils.getWindowObject();if(e)switch(e.dcsType){case"end_less":case"slides":return[]}return[]},e.isBetweenArticles=function(e){var t=this.getArticlesList();if(!t.length)return!1;var i=d.DcsUtils.getCurrentPvsObject();if(i instanceof HTMLElement&&t){var n=t.indexOf(i),o=t[n+1];if(o instanceof HTMLElement){var r=this.getElementPosition(e).top,s=this.getElementPosition(i).top,a=this.getElementPosition(o).top;return s<r&&r<a}}return!1},e.getCurrentContextElement=function(){return d.DcsUtils.getIfEndless()&&d.DcsUtils.dcsElement||document},e.getSlotTargeting=function(e){return e&&"function"==typeof e.getTargetingMap?e.getTargetingMap():{}},e.isStickyActive=function(){return!!c.SpotsUtils.getConf(p.SPOT_TAGS_MAP[p.SpotType.STICKY])},e.isValidStickyHeight=function(e){return e<=.3*this.getViewportHeight()},e.isValidStickySize=function(e){return this.isValidStickyHeight(e.h)&&e.w<=this.getViewportWidth()},e.isValidObject=function(e,t){try{for(var i=e.split("."),n=t||window[i[0]],o=1;o<i.length;o++)n=n[i[o]];return!this.isNullOrUndefined(n)}catch(e){return!1}},e.querySelectorOnDocument=function(e,t){var i=null;if(e instanceof HTMLIFrameElement){var n=this.getIframeWindow(e);n&&(i=n.document)}else e instanceof HTMLElement&&e.shadowRoot?i=e.shadowRoot:(e instanceof Document||e instanceof HTMLElement)&&(i=e);return i?Array.prototype.slice.call(i.querySelectorAll(t)).map((function(t){return{element:t,referer:e}})):[]},e.getIframeWindow=function(e){var t;try{t=e.contentWindow&&e.contentWindow.document?e.contentWindow:void 0}catch(e){}return t},e.isFriendlyIframe=function(e){var t=+new Date+""+Math.random();try{var i=e.contentWindow;return!!i&&(i[t]="asd","asd"===i[t])}catch(e){return!1}},e.getBlockRefreshList=function(e){if(e){var t=e.getResponseInformation();if(t){var i=t.lineItemId||t.sourceAgnosticLineItemId,o=t.campaignId;return n(n({},i?{li:i}:{}),o?{oi:o}:{})}}},e.isBlacklistedForApiOptimization=function(e,t){var i,n,o=(null===(n=null===(i=a.Profiler.get().layouts.spots.api)||void 0===i?void 0:i.s)||void 0===n?void 0:n.viewabilityOptimizationBlocklist)||[];return!!t&&(o.includes(t)||o.includes(e))},e.getUserID=function(){return f.default.hasUserConsent?a.Profiler.get().identity.userId:"anonymous"},e}();t.Utils=h},function(e,t,i){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__spreadArrays||function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<i;t++)for(var r=arguments[t],s=0,a=r.length;s<a;s++,o++)n[o]=r[s];return n};Object.defineProperty(t,"__esModule",{value:!0}),t.Profiler=void 0;var r=i(1),s=i(0),a=i(4),l=i(5),d=i(6),p=i(24),c=function(){function e(e){this._profile=this.buildProfile(e,this.getRules(e)),window._middyo.pvid=this._profile.identity.pageviewId}return e.prototype.getRules=function(t){if(t.externalFlowHandler&&t.externalFlowHandler.preEngine){try{e.logger.info("initiating rules"),t.externalFlowHandler.preEngine(t)}catch(t){e.logger.error("failed to initiating rules",t)}return t.externalFlowHandler}},e.get=function(){return e.instance||(e.instance=new e(r.Utils.getLoaderParams())),e.instance._profile},e.setLoadTime=function(e){this.get().loadTime=e-this.get().identity.timeOffset},e.prototype.buildProfile=function(e,t){var i,n,o,s,a=r.Utils.getScreenSize();return{debugMode:!!e.debug,runMode:e.m,identity:{siteKey:e.i.sk,publisherKey:e.i.pk,userId:e.i.u,sessionId:e.i.s,pageviewId:e.i.pv,isBenchmarkPageview:e.r.b,bootstrapPageviewId:e.bpvi,supplyConfigId:e.i.sc,url:encodeURIComponent(location.protocol+"//"+location.host+location.pathname),timeOffset:e.to,articleId:e.i.aid},yieldData:{isBenchmarked:e.r.b,countryCode:e.r.cc,trafficSource:e.r.ts,isReturningUser:e.r.ru,version:e.ses.v,eventServerUrl:e.r.es,host:e.yhn},deviceDetails:{browser:e.dt.b,device:e.dt.d,deviceType:e.dt.p,os:e.dt.os,osVersion:e.dt.osv,screenWidth:a.w,screenHeight:a.h,browserType:e.dt.bt,deviceVendor:e.dt.v},spotEngineConfig:{embedType:e.sec.et,spotStyle:r.Utils.mergeDeep(this.getDefaultStyling(),e.sec.s),adMarking:this.getAdMarkingConfiguration(e.sec.adm),publisherAdsMinDistance:e.sec.dad,railsPublisherAdsMinDistance:e.sec.rdad,isLazySAActive:e.sec.lsa,tryInsideTables:!!e.sec.ti,dcs:this.getDcsConfig(e.sec.dcs),useNewStayAwayCalc:!!e.sec.sapc,stayAwayConfigs:(null===(i=e.sec.ux)||void 0===i?void 0:i.sa)||[],mainContentConfig:e.sec.mc,pageLayoutSA:e.sec.plsa,fixedHeader:e.sec.fh,wrappingAdditionalElements:e.sec.wae||[],blockAdRequestOnOOF:e.sec.barof,targetSelectors:e.sec.ts||[],rails:e.sec.rl,fixedTargeting:e.sec.fte},layouts:this.getLayouts(e.ly),siteInfo:{adInViewport:e.si.aiv,activeView:!!e.si.av,blockLineItemIds:e.si.bli,prebidData:e.si.pd,prebidPath:e.si.pd.p,ixPath:e.si.ixp,enableMoat:!!e.si.em},optimizedData:{lazyFetchTime:null===(n=e.od)||void 0===n?void 0:n.lft},referrer:encodeURIComponent(window.top.document.referrer),state:"bootstrap_loaded",adBlockerDetectionUrl:e.sec.abd,rules:t,isUserEngaged:!1,logEngagement:e.ses.le,browsiViewability50Key:e.si.v50,pageKeyValues:e.ly.pgkv,pubAdsRefresh:this.getPubAdsRefreshConfig((null===(o=e.pub)||void 0===o?void 0:o.r)||void 0,(null===(s=e.si.pd)||void 0===s?void 0:s.g)||void 0),userAnonymousContinent:e.r.cl,reportResponseTime:{active:e.si.rrt,timers:e.td}}},e.buildMainContent=function(e,t,i,n){var o=n.sec.mc,s=o&&o.u,a={start:-1,width:-1,widthThreshold:i,endPosition:-1,inputElements:[],firstElement:null,lastElement:null,borderElement:null};if(e.length){var l=null;o.e&&(l=r.Utils.querySelector(o.e[0],this.errorCallback));var d=r.Utils.querySelector(s,this.errorCallback)||e[0],p=e[e.length-1];a={start:r.Utils.getElementPosition(d).top,width:t,widthThreshold:i,endPosition:l?r.Utils.getElementPosition(l).top:r.Utils.getElementPosition(p).top+p.getBoundingClientRect().height,inputElements:e,firstElement:d,lastElement:p,borderElement:l}}return a},e.buildAdSizes=function(e,t,i,n,o){var s=this,a=[],l=r.Utils.getAdMarkingExpectedHeight();return t.forEach((function(t){var r=s.buildCompatibleSize(e,t,l,i,n,o);r&&a.push(r)})),a},e.buildCompatibleSize=function(e,t,i,n,o,s){var a=void 0;if(e>=t.w||r.Utils.isFluidSize(t)){var d=this.getAdSizeType(t);a={w:t.w,h:t.h,adSizeType:d,minSizeForWrapping:this.calculateValidHeights(t,e,i),optionalEmbeddings:s&&l.SpotsUtils.getRailsTypes().includes(s)?["break"]:this.getEmbedTypes(d,t.h,n,o)}}return a},e.getAdSizeType=function(e){return r.Utils.isFluidSize(e)?"wide":e.w<=400?"narrow":"wide"},e.getEmbedTypes=function(e,t,i,n){var o=[];return"narrow"==e?(t<=400&&i&&o.push("break"),n&&o.push("wrapped")):o.push("break"),o},e.calculateValidHeights=function(e,t,i){var n=r.Utils.getWrapFullSize(e);return n.h+=i,n.h-n.h*n.w/t},e.validateProfileForBehavior=function(e,t,i){if(!i)return[];var n=e.mainContent.inputElements,o=i.elements,s=i.allowedCreativeSizes,l=[];if(i.stopInFold&&i.startInFold&&i.startInFold>i.stopInFold&&i.stopInFold>0&&l.push("startIF/stopIF_Violation"),t===a.SpotType.DYNAMIC_MC&&0===n.length)l.push("No_Main_Content_Found");else if(0===o.length&&l.push("No_Elements_For_Scan"),0===s.length&&l.push("No_compatibleSizes"),t===a.SpotType.DYNAMIC_MC){var d=e.skippedElements,p=!0;n.forEach((function(e){p&&!d.some((function(t){return t===e||r.Utils.isDescendantElement([t],e)}))&&(p=!1)})),p&&l.push("Main_Content_Inside_Skipped")}return l},e.prototype.getAdMarkingConfiguration=function(e){if(e){var t={text:e.t,expectedHeight:0};return e.c?t.color=e.c:e.s&&(t.customStyle=e.s),t.expectedHeight=r.Utils.calculateAdMarkingHeight(t),t}},e.getPotentialSpots=function(e,t,i){var n=this.collectTargetElements(e,t);return i&&r.Utils.isDescendantElement(t,i)&&(n=r.Utils.removeElementsPositionedAfter(i,n)),n},e.prototype.getDcsConfig=function(t){if(t){if(t.t&&t.s&&t.s.length){var i=t.s.reduce((function(e,t){return t&&e.push({type:t.t,elementSelector:t.s1,containerSelector:t.s2,value:t.v}),e}),[]);return{type:t.t,steps:i,urlChange:t.u,delay:t.d,rescanRails:!!t.r}}e.logger.error("bad DCS configuration",t)}else;},e.prototype.getPubAdsRefreshConfig=function(t,i){if(t){if(t.c&&t.r&&t.l&&t.t)return{active:!0,adIdType:t.t,adIds:t.l,refreshCount:t.c,refreshRate:t.r,dfpOnly:t.d,sendRefreshKV:t.kv,customPbjsName:i};e.logger.error("bad PubAdsConfig configuration",t)}},e.collectTargetElements=function(e,t){var i=[];e.length&&(i=t.reduce((function(t,i){return t.concat(Array.from(i.querySelectorAll(""+e.toString())).filter((function(e){return r.Utils.isVisible(e)})))}),[]));var n=t.reduce((function(e,t){return e.concat(Array.from(t.querySelectorAll("p")).filter((function(e){return r.Utils.isVisible(e)&&!r.Utils.isDescendantElement(i,e)})))}),[]),s=o(n,i).sort((function(e,t){return r.Utils.isPositionedAfter(e,t)?1:-1}));return r.Utils.toUnique(s)},e.detectAdBlocker=function(t){e.adBlockerExists?t():new Promise((function(t,i){function n(){"undefined"===window.adblockDetector?t(!1):window.adblockDetector.init({debug:e.get().debugMode,found:function(){t(!0)},notFound:function(){t(!1)}})}var o=document.createElement("script");o.src=e.get().adBlockerDetectionUrl,o.setAttribute("crossorigin","anonymous"),o.onload=n,o.onerror=n,d.ResponseTimeCollector.get().measureScript("adb",o),document.body.appendChild(o)})).then((function(i){e.adBlockerExists=i,e.logger.custom("Ad Blocker Detected: "+i,r.Utils.getLogStyle(18,"black","green")),t()}))},e.collectDOMData=function(){var t,i,n,o,s=window._middyo,a=(s.sec.mc&&s.sec.mc.s?r.Utils.querySelectorAll(s.sec.mc.s,e.errorCallback):[]).filter((function(e){return r.Utils.isVisible(e)})),l=r.Utils.querySelectorAll((null===(i=null===(t=s.sec.ux)||void 0===t?void 0:t.sk)||void 0===i?void 0:i.c)||[],e.errorCallback),d=r.Utils.querySelectorInsideElements(["div[style*=float] + p, img[style*=float]+p, iframe[style*=float] + p"],a,e.errorCallback),p=this.getWidthForEmbed(a[0]),c=s.sec.mc&&s.sec.mc.t?s.sec.mc.t:500,u=!!(e.get().layouts.wrapAroundText&&p>=c),f=(null===(o=null===(n=s.ly)||void 0===n?void 0:n.in)||void 0===o?void 0:o.s)||[],h=this.buildAdSizes(p,f,!0,u);return{mainContent:this.buildMainContent(a,p,c,s),stayAwayElements:[],skippedElements:l,dynamicCompatibleSizes:h,foundFloatElements:d,allowNarrowWrap:u}},e.getWidthForEmbed=function(e){var t=e?e.getBoundingClientRect().width:-1;if(r.Utils.isElement(e)){var i=window.getComputedStyle(e);i.paddingLeft&&i.paddingRight&&(t-=parseFloat(i.paddingLeft)+parseFloat(i.paddingRight))}return t},e.prototype.getDefaultStyling=function(){return{b:{m:{b:16,t:16}},l:{m:{t:-1,r:16,b:16,l:0},p:{t:-1,r:0,b:0,l:0}},r:{m:{t:-1,r:0,b:16,l:16},p:{t:-1,r:0,b:0,l:0}}}},e.prototype.getLayouts=function(e){var t;return{potentialSpots:e.ps,analysisMode:!!e.am,lazySpots:this.convertLayoutLazyConfig(e.ll),wrapAroundText:!!(null===(t=e.in)||void 0===t?void 0:t.w),spots:this.getLayoutSpots(e),placeholder:e.ph,eagerFirstFold:e.eff,fixedSpotsFirst:!!e.fsf}},e.prototype.getLayoutSpots=function(e){return{dynamic:this.convertLayoutDynamicConfig(e.in,e.ps),fixedBottom:this.convertLayoutFixedConfig(e.b),fixedMC:this.convertLayoutFixedConfig(e.in),fixedTop:this.convertLayoutFixedConfig(e.t),rails:this.convertRailsLayout(e.r,e.ps),api:this.convertLayoutApiSpot(e),sticky:this.convertLayoutStickySpot(e.s)}},e.prototype.convertLayoutDynamicConfig=function(e,t){var i;if(null==e?void 0:e.dy)return n(n(n({},this.convertInContentSpot(e)),this.convertFoldConfig(e)),{distance:e.d,maxItems:e.dy.mi,maxSpots:Math.max(e.dy.mi,t||0),additionalSizes:[],elements:[],targetElements:[],viewabilityThreshold:null===(i=e.ov)||void 0===i?void 0:i.vt})},e.prototype.convertLayoutFixedConfig=function(e){var t;if(null==e?void 0:e.fi)return n(n(n({},this.convertScannedSpot(e)),this.convertFoldConfig(e)),{maxItems:-1,maxSpots:-1,elements:[],targetElementPosition:e.fi.tep,targetElements:e.fi.te,viewabilityThreshold:null===(t=e.ov)||void 0===t?void 0:t.vt})},e.prototype.convertScannedSpot=function(e){var t,i;return{allowedCreativeSizes:e.s||[],engagedUsers:(null===(t=e.ov)||void 0===t?void 0:t.eu)||!1,lazyLoading:(null===(i=e.ov)||void 0===i?void 0:i.ll)?{firstAdIndex:e.ov.ll.fai,firstFold:e.ov.ll.ff}:void 0}},e.prototype.convertFoldConfig=function(e){return{startInFold:e.start||0,stopInFold:e.stop||0}},e.prototype.convertInContentSpot=function(e){return n(n({},this.convertScannedSpot(e)),{startInFold:e.start,stopInFold:e.stop})},e.prototype.convertLayoutStickySpot=function(e){if(e)return{location:e.l,allowedCreativeSizes:e.s||[],closeButton:!!e.cb}},e.prototype.convertLayoutApiSpot=function(e){var t=this;if(e){var i={};return["in","t","b","s","r"].forEach((function(o){var r,s,a=e[o];a&&("r"===o&&(o=(null==a?void 0:a.p)===p.RailsSides.RIGHT?"r":"l"),i[o]=n({sizes:a.s||[],viewabilityOptimizationBlocklist:(null===(r=a.api)||void 0===r?void 0:r.vob)||[],positionIds:null===(s=a.api)||void 0===s?void 0:s.ids,targetElementPosition:e.atep||"INSIDE"},t.getOptimizationParams(a)))})),i}},e.prototype.convertRailsLayout=function(e,t){var i,o,r,s;if(e)return n(n(n({},this.convertInContentSpot(e)),this.convertFoldConfig(e)),{distance:e.d,maxItems:(null===(i=e.dy)||void 0===i?void 0:i.mi)||0,maxSpots:Math.max((null===(o=e.dy)||void 0===o?void 0:o.mi)||0,t||0),additionalSizes:[],elements:[],targetElements:(null===(r=e.fi)||void 0===r?void 0:r.te)||[],viewabilityThreshold:null===(s=e.ov)||void 0===s?void 0:s.vt,railSide:e.p})},e.prototype.convertLayoutLazyConfig=function(e){var t={avgFetchTime:e.aft,approvalCount:e.ac,staticUser:e.su,threshold:e.t,dynamicFetchTime:e.dft};return e.m||(t.autoThreshold=e.d),t},e.prototype.getOptimizationParams=function(e){var t,i=null===(t=e)||void 0===t?void 0:t.ov;if(i)return{optimizeViewability:n({engagedUsersOnly:i.eu,viewabilityThreshold:i.vt},i.ll?{lazyLoadingConfig:{firstAdIndex:i.ll.fai,firstFold:i.ll.ff}}:{})}},e.logger=new s.Logger("Profiler"),e.errorCallback=function(t){return e.logger.error(t)},e}();t.Profiler=c},function(e,t,i){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__spreadArrays||function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<i;t++)for(var r=arguments[t],s=0,a=r.length;s<a;s++,o++)n[o]=r[s];return n};Object.defineProperty(t,"__esModule",{value:!0}),t.EventsService=void 0;var r=i(2),s=i(0),a=i(1),l=i(7),d=i(5),p=i(4),c=i(16),u=function(){function e(){this.commonFields=this.buildCommonFields(),this.eventServerUrl=r.Profiler.get().yieldData.eventServerUrl,this.logger=new s.Logger("Events"),this.profile=r.Profiler.get()}return e.get=function(){return e._instance||(this._instance=new e),e._instance},e.prototype.sendEngineLoadedEvent=function(){var e=r.Profiler.get(),t=this.getEngineLoadedEvent(e);this.send("supply",t.et,[t])},e.prototype.sendSpotFoundEvent=function(e){var t=this.getSpotFoundEvent(e);this.send("demand",t.et,[t])},e.prototype.sendPageviewEvent=function(e,t,i,n,o,r,s){var a=s&&s.length>0?{rsn:s.join(";")}:{},l=this.getPageviewEvent(e,t,i,n,o,r,a);this.send("supply",l.et,[l])},e.prototype.sendAdBlockerEvent=function(){var e=this.getAdBlockerEvent();this.send("supply",e.et,[e])},e.prototype.sendSpotEngineDoneEvent=function(){var e=r.Profiler.get(),t=this.getSpotEngineDoneEvent(e);this.send("supply",t.et,[t])},e.prototype.sendAdRequest=function(e,t,i){var n=this.getAdRequestEvent(e,t,i);this.send("demand",n.et,[n])},e.prototype.sendAdMatchedEvent=function(e,t,i,n,o){var r=this.getAdMatchedEvent(e,t,i,n,o);this.send("demand",r.et,[r])},e.prototype.sendAdImpression=function(e,t,i){var n=a.Utils.getSpotCoords(e),o=a.Utils.getBlockRefreshList(e.slot),r=this.getAdImpressionEvent(n,e,t,i,o);this.send("demand",r.et,[r])},e.prototype.sendViewedImpression=function(e,t){var i=a.Utils.getSpotCoords(e),n=this.getViewedImpressionEvent(i,e,t);this.send("demand",n.et,[n])},e.prototype.sendViewedImpression100=function(e){var t=a.Utils.getSpotCoords(e),i=this.getViewedImpression100Event(t,e);this.send("demand",i.et,[i])},e.prototype.sendViewedImpressionAV=function(e){var t=this.getViewedImpressionEventAV(e);this.send("demand",t.et,[t])},e.prototype.sendViewedPublisherAd=function(e,t){var i=this.getViewedPublisherAdEvent(e,t);this.send("demand",i.et,[i])},e.prototype.sendUserEngagementEvent=function(){var e=this.getUserEngagementEvent();this.send("supply",e.et,[e])},e.prototype.sendEngagementReportEvent=function(e){var t=this,i=e.map((function(e){return Object.assign({},t.commonFields,e)}));this.send("engagement",i[0].et,i)},e.prototype.sendBidRequest=function(e,t){var i=this.getBidRequestEvent(e,t);this.send("hb",i.et,[i])},e.prototype.sendBidMatched=function(e,t){var i=this.getBidMatchedEvent(e,t);this.send("hb",i.et,[i])},e.prototype.sendAdBlockedEvent=function(e,t){e.adRequestBlockedSent=!0;var i=this.getAdBlockedEvent(e,t);this.send("demand",i.et,[i])},e.prototype.sendApiRequestBlockedEvent=function(e,t,i){var n=this.getApiBlockEvent(e,t,i);this.send("demand","api_request_blocked",[n])},e.prototype.sendPubAdRefreshBlockedEvent=function(e,t,i,n){var o=this.getRefreshBlockEvent(e,t,i,n);this.send("demand","parb",[o])},e.prototype.sendFocusChangedEvent=function(e){var t=this.getFocusChangedEvent(e);this.send("supply",t.et,[t])},e.prototype.sendPublisherAdFound=function(e,t,i){var n=this.getPublisherAdFoundEvent(e,t,i);this.send("demand",n.et,[n])},e.prototype.sendPubAdRefreshRequest=function(e,t,i){var n=this.getPubAdRefreshEvent(e,t,i);this.send("demand",n.et,[n])},e.prototype.sendAdInViewport=function(e,t){var i=this.getAdInViewportEvent(e,t);this.send("demand",i.et,[i])},e.prototype.sendDcs=function(e,t){void 0===t&&(t={});var i=this.getDcsEvent(e,t);this.send("supply",e,[i])},e.prototype.sendAdMeasurableEvent=function(e,t,i,n){var o=this.getAdMeasurableEvent(e,t,i,n);this.send("demand",o.et,[o])},e.prototype.sendAdClicked=function(e,t,i,n,o,r){var s=this.getAdClickedEvent(e,t,i,n,o,r);this.send("demand",s.et,[s])},e.prototype.sendViewedPublisherAdAV=function(e){var t=this.getViewedPublisherAdAv(e);this.send("demand",t.et,[t])},e.prototype.sendStickyClosedEvent=function(e){var t=this.getStickyClosedEvent(e);this.send("demand","sticky_closed",[t])},e.prototype.sendPrebidErrorEvent=function(e,t){var i=this.getPrebidErrorEvent(e,t);this.sendError("prebid_error",i)},e.prototype.sendPlaceholderViewed=function(e){var t=this.getPlaceholderEvent(e,"placeholder_viewed");this.send("demand","placeholder_viewed",[t])},e.prototype.sendPlaceholderClosed=function(e){var t=this.getPlaceholderEvent(e,"placeholder_closed");this.send("demand","placeholder_closed",[t])},e.prototype.getResponseTimeEvent=function(e){return{sk:this.profile.identity.siteKey,pk:this.profile.identity.publisherKey,pvid:this.profile.identity.pageviewId,geo:this.profile.yieldData.countryCode,url:this.profile.identity.url,dos:this.profile.deviceDetails.os,dosv:this.profile.deviceDetails.osVersion,dv:this.profile.deviceDetails.deviceVendor,dbt:this.profile.deviceDetails.browserType,ibpv:this.profile.identity.isBenchmarkPageview,ts:this.profile.yieldData.trafficSource,db:this.profile.deviceDetails.browser,d:this.profile.deviceDetails.device,dp:this.profile.deviceDetails.deviceType,mv:this.profile.yieldData.version,scid:this.profile.identity.supplyConfigId,aid:this.profile.identity.articleId,now:a.Utils.getNowInSeconds(),et:"rt",pl:a.Utils.getPageHeight(),to:a.Utils.getTimeOffset(),td:e}},e.prototype.getEngineLoadedEvent=function(e){return Object.assign({},this.commonFields,{now:a.Utils.getCurrentTime(!0),et:"engine_loaded",to:this.getTimeOffset(),res:e.deviceDetails.screenWidth+"x"+e.deviceDetails.screenHeight})},e.prototype.getSpotFoundEvent=function(e){return n(n(n(n({},this.commonFields),{now:a.Utils.getCurrentTime(!0),et:"spot_found",adix:e.adIndex,f:this.getFold(e),pt:e.positionTypeToString(),ot:e.offsetTop,to:this.getTimeOffset(),ill:e.isLazyLoading,pw:a.Utils.getPageWidth(),st:e.type}),this.getDcsEventData(e.isDcs)),this.getSpotTags(e))},e.prototype.getPageviewEvent=function(e,t,i,o,r,s,l){var u,f,h,g,m;return n(n(n(n(n({},this.commonFields),l),{now:a.Utils.getCurrentTime(!0),et:"page_view",uid:a.Utils.getUserID(),sid:this.profile.identity.sessionId,bpvid:this.profile.identity.bootstrapPageviewId,sf:e,fsf:t,dcs:!1,ie:e+t>0,tlls:-1,pl:a.Utils.getPageHeight(),pw:a.Utils.getPageWidth(),to:this.getTimeOffset(),res:this.profile.deviceDetails.screenWidth+"x"+this.profile.deviceDetails.screenHeight,scid:this.profile.identity.supplyConfigId,iru:this.profile.yieldData.isReturningUser,mcs:this.profile.domData?this.profile.domData.mainContent.start:-1,mcw:this.profile.domData?this.profile.domData.mainContent.width:-1,mch:a.Utils.getMainContentSize(this.profile.domData),sl:this.profile.deviceDetails.screenHeight,mi:(null===(u=d.SpotsUtils.getConf(p.SPOT_TAGS_MAP[p.SpotType.DYNAMIC_MC]))||void 0===u?void 0:u.maxItems)||0,fmi:(null===(f=d.SpotsUtils.getConf(p.SPOT_TAGS_MAP[p.SpotType.FIXED_MC]))||void 0===f?void 0:f.maxItems)||0,ftmi:(null===(h=d.SpotsUtils.getConf(p.SPOT_TAGS_MAP[p.SpotType.FIXED_TOP]))||void 0===h?void 0:h.maxItems)||0,fbmi:(null===(g=d.SpotsUtils.getConf(p.SPOT_TAGS_MAP[p.SpotType.FIXED_BOTTOM]))||void 0===g?void 0:g.maxItems)||0,ssf:i,rmi:(null===(m=this.profile.layouts.spots.rails)||void 0===m?void 0:m.maxItems)||0,rrsf:r,lrsf:s,ftbsf:o,grs:c.default.getTimeOffset("gdpr"),crs:c.default.getTimeOffset("ccpa")}),this.profile.runMode?{mod:this.profile.runMode}:{}),this.getDcsEventData())},e.getFiredEvents=function(){return e.firedEvents},e.prototype.getAdBlockerEvent=function(){return n(n({},this.commonFields),{now:a.Utils.getCurrentTime(!0),et:"ad_blocker",to:this.getTimeOffset(),ex:r.Profiler.adBlockerExists})},e.prototype.getUserEngagementEvent=function(){return n(n({},this.commonFields),{now:a.Utils.getCurrentTime(!0),et:"user_engaged",to:this.getTimeOffset()})},e.prototype.getSpotEngineDoneEvent=function(e){return n(n({},this.commonFields),{now:a.Utils.getCurrentTime(!0),et:"spot_engine_done",pl:a.Utils.getPageHeight(),to:this.getTimeOffset(),scid:e.identity.supplyConfigId,res:e.deviceDetails.screenWidth+"x"+e.deviceDetails.screenHeight})},e.prototype.getAdRequestEvent=function(e,t,i){var o;return n(n(n(n(n(n(n(n({},this.commonFields),{now:a.Utils.getCurrentTime(!0),et:"ad_request",adf:"display",adix:e.adIndex,au:e.adUnit,saas:e.isSaas,atix:e.attemptIndex,pr:t,f:this.getFold(e),ot:a.Utils.getSpotCoords(e).top,ill:e.isLazyLoading,pw:a.Utils.getPageWidth(),rc:e.refresh.count,to:this.getTimeOffset(),ul:a.Utils.getScrollPosition().top,st:e.type,pt:e.positionTypeToString(),di:e.demandIndex,s:this.getSizesByOrder(i)}),e.type===p.SpotType.API?{plid:e.ref.id}:{}),e.type===p.SpotType.API&&(null===(o=e.options)||void 0===o?void 0:o.disableViewabilityOptimization)?{vod:!0}:{}),this.getDcsEventData(e.isDcs)),e.generalData?{gd:e.generalData}:{}),this.getSpotTags(e)),e.placeholder?{ps:e.placeholder.size.w+"x"+e.placeholder.size.h}:{})},e.prototype.getSizesByOrder=function(e){return Array.isArray(e[0])?e.sort((function(e,t){if("fluid"===e[0])return-1;if("fluid"===t[0])return 1;try{var i=e[0],n=t[0];return i===n?e[1]-t[1]:i-n}catch(e){return-1}})).map((function(e){return"fluid"===e[0]?"fluid":e[0]+"x"+e[1]})).join("|"):e.join("x")},e.prototype.getAdBlockedEvent=function(e,t){return n(n(n(n(n({},this.commonFields),{now:a.Utils.getCurrentTime(!0),et:"ad_request_blocked",adf:"display",adix:e.adIndex,au:e.adUnit,saas:e.isSaas,atix:e.attemptIndex,f:this.getFold(e),ot:a.Utils.getSpotCoords(e).top,ill:e.isLazyLoading,pw:a.Utils.getPageWidth(),rc:e.refresh.count,to:this.getTimeOffset(),rsn:t.map((function(e){return e.reason})).join(","),msg:t.map((function(e){return e.message||""})).join(","),ul:a.Utils.getScrollPosition().top,st:e.type,pt:e.positionTypeToString()}),this.getDcsEventData(e.isDcs)),e.generalData?{gd:e.generalData}:{}),this.getSpotTags(e))},e.prototype.getApiBlockEvent=function(e,t,i){return n(n({},this.commonFields),{now:a.Utils.getCurrentTime(!0),et:"api_request_blocked",rsn:e,msg:t,to:this.getTimeOffset(),plid:i})},e.prototype.getRefreshBlockEvent=function(e,t,i,o){return n(n(n({},this.commonFields),{now:a.Utils.getCurrentTime(!0),et:"parb",to:this.getTimeOffset(),rsn:o,plid:e,rc:t,pt:a.Utils.sortedString(i)}),this.getDcsEventData())},e.prototype.getPublisherAdFoundEvent=function(e,t,i){return n(n(n(n(n(n({},this.commonFields),{now:a.Utils.getCurrentTime(!0),et:"found_publisher_ad",adix:-1,au:e.adUnit,f:e.foldNum,ot:a.Utils.getElementPosition(e.element).top,ol:a.Utils.getElementPosition(e.element).left,ill:e.isLazyLoaded,pw:a.Utils.getPageWidth(),to:this.getTimeOffset(),pr:e.providerName,pt:a.Utils.sortedString(e.positionType),h:e.height,w:e.width,plid:e.placementId,ul:a.Utils.getScrollPosition().top,rc:e.refreshCount}),t),this.getDcsEventData()),e.refreshType?{rt:e.refreshType}:{}),(null==i?void 0:i.li)?{lid:i.li}:{})},e.prototype.getPubAdRefreshEvent=function(e,t,i){return n(n(n({},this.commonFields),{now:a.Utils.getCurrentTime(!0),et:"pub_ad_refresh_request",adix:-1,au:e.adUnit,f:e.foldNum,ot:a.Utils.getElementPosition(e.element).top,ol:a.Utils.getElementPosition(e.element).left,ill:e.isLazyLoaded,pw:a.Utils.getPageWidth(),to:this.getTimeOffset(),pr:e.providerName,pt:a.Utils.sortedString(e.positionType),h:e.height,w:e.width,plid:e.placementId,ul:a.Utils.getScrollPosition().top,rc:t}),i?{rt:i}:{})},e.prototype.getViewedPublisherAdEvent=function(e,t){return n(n(n(n({},this.commonFields),{now:a.Utils.getCurrentTime(!0),et:"viewed_publisher_ad",adix:-1,au:e.adUnit,f:e.foldNum,ot:a.Utils.getElementPosition(e.element).top,ol:a.Utils.getElementPosition(e.element).left,ill:e.isLazyLoaded,pw:a.Utils.getPageWidth(),to:this.getTimeOffset(),pr:e.providerName,pt:a.Utils.sortedString(e.positionType),h:e.height,w:e.width,plid:e.placementId,ul:a.Utils.getScrollPosition().top,c:1,tiv:-1,piv:t,rc:e.refreshCount}),this.getDcsEventData()),e.refreshType?{rt:e.refreshType}:{})},e.prototype.getAdMatchedEvent=function(e,t,i,o,r){return n(n(n(n(n(n(n({},this.commonFields),o?{rsn:o}:{}),{now:a.Utils.getCurrentTime(!0),et:"ad_matched",adf:"display",adix:e.adIndex,au:e.adUnit,im:i,saas:e.isSaas,atix:e.attemptIndex,w:e.selectedSize?e.selectedSize.w:-1,h:e.selectedSize?e.selectedSize.h:-1,pr:t,emt:e.selectedSize&&e.selectedSize.selectedEmbedding?e.selectedSize.selectedEmbedding:"NA",ot:a.Utils.getSpotCoords(e).top,f:this.getFold(e),ill:e.isLazyLoading,pw:a.Utils.getPageWidth(),rc:e.refresh.count,to:this.getTimeOffset(),st:e.type,pt:e.positionTypeToString(),di:e.demandIndex,ul:a.Utils.getScrollPosition().top}),this.getDcsEventData(e.isDcs)),r?{hb:r}:{}),e.generalData?{gd:e.generalData}:{}),this.getSpotTags(e))},e.prototype.getAdImpressionEvent=function(e,t,i,o,r){return n(n(n(n(n(n({},this.commonFields),{now:a.Utils.getCurrentTime(!0),et:"ad_impression",adf:"display",au:t.adUnit,h:t.browsiAd.h,w:t.browsiAd.w,adix:t.adIndex,saas:t.isSaas,emt:o,atix:t.attemptIndex,ol:e.left,ot:e.top,pr:i,f:this.getFold(t),ill:t.isLazyLoading,pw:a.Utils.getPageWidth(),rc:t.refresh.count,to:this.getTimeOffset(),ul:a.Utils.getScrollPosition().top,st:t.type,pt:t.positionTypeToString(),di:t.demandIndex}),this.getDcsEventData(t.isDcs)),(null==r?void 0:r.li)?{lid:r.li}:{}),t.generalData?{gd:t.generalData}:{}),this.getSpotTags(t))},e.prototype.getViewedImpressionEvent=function(e,t,i){return n(n(n(n(n({},this.commonFields),{now:a.Utils.getCurrentTime(!0),et:"viewed_impression",adf:"display",adix:t.adIndex,au:t.adUnit,saas:t.isSaas,h:t.browsiAd.h,w:t.browsiAd.w,emt:t.selectedSize&&t.selectedSize.selectedEmbedding?t.selectedSize.selectedEmbedding:"NA",ol:e.left,ot:e.top,atix:t.attemptIndex,c:1,pr:t.providerName,f:this.getFold(t),to:this.getTimeOffset(),pw:a.Utils.getPageWidth(),rc:t.refresh.impressionsEventCount,tiv:-1,piv:i,ill:t.isLazyLoading,st:t.type,pt:t.positionTypeToString(),di:t.demandIndex}),this.getDcsEventData()),t.generalData?{gd:t.generalData}:{}),this.getSpotTags(t))},e.prototype.getViewedImpression100Event=function(e,t){return n(n(n(n(n({},this.commonFields),{now:a.Utils.getCurrentTime(!0),et:"v_100",adf:"display",adix:t.adIndex,au:t.adUnit,saas:t.isSaas,h:t.browsiAd.h,w:t.browsiAd.w,emt:t.selectedSize&&t.selectedSize.selectedEmbedding?t.selectedSize.selectedEmbedding:"NA",ol:e.left,ot:e.top,atix:t.attemptIndex,c:1,pr:t.providerName,f:this.getFold(t),to:this.getTimeOffset(),pw:a.Utils.getPageWidth(),rc:t.refresh.impressionsEventCount,tiv:-1,ill:t.isLazyLoading,st:t.type,pt:t.positionTypeToString(),di:t.demandIndex}),this.getDcsEventData(t.isDcs)),t.generalData?{gd:t.generalData}:{}),this.getSpotTags(t))},e.prototype.getBidRequestEvent=function(e,t){var i=a.Utils.getSpotCoords(e);return n(n(n({},this.commonFields),{now:a.Utils.getNowInSeconds(),et:"bid_request",adix:e.adIndex,di:e.demandIndex,atix:e.attemptIndex,ot:i.top,rc:e.refresh.count,to:a.Utils.getTimeOffset(),st:e.type,b:t}),this.getSpotTags(e))},e.prototype.getBidMatchedEvent=function(e,t){var i=a.Utils.getSpotCoords(e);return n(n(n({},this.commonFields),{now:a.Utils.getNowInSeconds(),et:"bid_matched",adix:e.adIndex,di:e.demandIndex,atix:e.attemptIndex,ot:i.top,rc:e.refresh.count,to:a.Utils.getTimeOffset(),st:e.type,b:t}),this.getSpotTags(e))},e.prototype.getFocusChangedEvent=function(e){return n(n({},this.commonFields),{now:a.Utils.getCurrentTime(!0),et:"focus_changed",if:e,to:this.getTimeOffset()})},e.prototype.getAdInViewportEvent=function(e,t){return{now:a.Utils.getCurrentTime(!0),et:"ad_in_viewport",to:this.getTimeOffset(),pvid:this.commonFields.pvid,rc:e.refresh.count,atix:e.attemptIndex,adix:e.adIndex,ivp:t.toFixed(2)}},e.prototype.getDcsEvent=function(e,t){var i,o;return n(n(n({},this.commonFields),{now:a.Utils.getCurrentTime(!0),et:e,to:this.getTimeOffset(),pl:a.Utils.getPageHeight(),mi:(null===(o=null===(i=this.profile.layouts.spots)||void 0===i?void 0:i.dynamic)||void 0===o?void 0:o.maxItems)||0}),t)},e.prototype.getHBWinnerEvent=function(e,t,i){var o=r.Profiler.get(),s={n:t,s:[{br:i}]};return n({now:a.Utils.getNowInSeconds(),et:"hbw",pk:this.commonFields.pk,sk:this.commonFields.sk,dp:this.commonFields.dp,to:a.Utils.getTimeOffset(),url:o.identity.url,pvid:this.commonFields.pvid,adix:e.adIndex,di:e.demandIndex,st:e.type,atix:e.attemptIndex,rc:e.refresh.count,b:[s]},this.getSpotTags(e))},e.prototype.sendHBWinner=function(e,t){var i=this.getHBWinnerEvent(e,t.bidder,t.cpm);this.send("hb","hbw",[i])},e.prototype.sendAPSWinner=function(e){var t=this.getHBWinnerEvent(e,"aps",-1);this.send("hb","hbw",[t])},e.prototype.getAdMeasurableEvent=function(e,t,i,o){return n(n(n(n({},this.commonFields),{now:a.Utils.getNowInSeconds(),et:"measurable_impression",adix:e.adIndex,di:e.demandIndex,au:t||"NA",atix:e.attemptIndex,saas:i,pr:e.providerName?e.providerName:"NA",w:e.selectedSize?e.selectedSize.w:-1,h:e.selectedSize?e.selectedSize.h:-1,f:this.getFold(e),ot:a.Utils.getSpotCoords(e).top,pt:e.positionTypeToString(),ill:e.isLazyLoading,pw:a.Utils.getPageWidth(),rc:e.refresh.count||0,to:a.Utils.getTimeOffset(),dcs:e.isDcs,ul:a.Utils.getPageYOffset(),st:e.type}),o?{rsn:o}:{}),this.getSpotTags(e))},e.prototype.getStickyClosedEvent=function(e){var t,i={sk:(t=this.commonFields).sk,pk:t.pk,pvid:t.pvid,geo:t.geo,url:t.url,db:t.db,d:t.d,dp:t.dp,dos:t.dos,mv:t.mv};return n(n({},i),{now:a.Utils.getNowInSeconds(),et:"sticky_closed",adix:e.adIndex,di:e.demandIndex,pr:e.providerName?e.providerName:"NA",w:e.selectedSize?e.selectedSize.w:-1,h:e.selectedSize?e.selectedSize.h:-1,ot:a.Utils.getSpotCoords(e).top,pt:e.positionTypeToString(),rc:e.refresh.impressionsEventCount||0,to:a.Utils.getTimeOffset(),ul:a.Utils.getPageYOffset()})},e.prototype.sendError=function(e,t){this.profile.debugMode?this.logger.error(t):this.send("engineError",e,[t])},e.prototype.send=function(t,i,n){var r,s=new XMLHttpRequest;s.open("POST",""+this.eventServerUrl+t+"?p="+this.commonFields.pvid,!0),s.send(JSON.stringify(n)),e.addToFiredEvents(t,i,n),(r=this.logger).custom.apply(r,o([t+"/"+i,"background: #AAFF7F; color: black; font-weight: bold; text-decoration:underline; font-size: 18px;"],n))},e.addToFiredEvents=function(t,i,n){e.firedEvents.has(t)||e.firedEvents.set(t,new Map);var o=e.firedEvents.get(t);o&&!o.has(i)&&o.set(i,[]);var r=o&&o.get(i);r&&r.push.apply(r,n)},e.prototype.buildCommonFields=function(){var e=r.Profiler.get();return{sk:e.identity.siteKey,pk:e.identity.publisherKey,pvid:e.identity.pageviewId,geo:e.yieldData.countryCode,r:e.referrer,bpvid:e.identity.bootstrapPageviewId,url:e.identity.url,dos:e.deviceDetails.os,dosv:e.deviceDetails.osVersion,dv:e.deviceDetails.deviceVendor,dbt:e.deviceDetails.browserType,iru:e.yieldData.isReturningUser,ibpv:e.identity.isBenchmarkPageview,ts:e.yieldData.trafficSource,db:e.deviceDetails.browser,d:e.deviceDetails.device,dp:e.deviceDetails.deviceType,mv:e.yieldData.version,scid:e.identity.supplyConfigId,res:e.deviceDetails.screenWidth+"x"+e.deviceDetails.screenHeight,aid:e.identity.articleId}},e.prototype.getTimeOffset=function(){return a.Utils.getCurrentTime(!1)-this.profile.identity.timeOffset},e.prototype.getFold=function(e){return e.isImpression&&e.browsiAd.container?e.browsiAd.iframe?a.Utils.getElementFoldNumber(e.browsiAd.iframe):a.Utils.getElementFoldNumber(e.browsiAd.container):a.Utils.getElementFoldNumber(e.ref)},e.prototype.getDcsEventData=function(e){void 0===e&&(e=l.DcsUtils.isDcs);var t=l.DcsUtils.getWindowObject();return n({dcs:e},e&&t?{ac:l.DcsUtils.getActionCounter(),dcst:l.DcsUtils.dcsType}:{})},e.prototype.getAdClickedEvent=function(e,t,i,o,r,s){return n(n(n({now:a.Utils.getNowInSeconds(),to:a.Utils.getTimeOffset(),pvid:this.commonFields.pvid,sk:this.commonFields.sk,pk:this.commonFields.pk,uid:a.Utils.getUserID(),dp:this.commonFields.dp,mv:this.commonFields.mv,aid:this.commonFields.aid,et:"ad_clicked",rc:i,iba:e,c:t},"number"==typeof o?{adix:o}:{}),"number"==typeof r?{di:r}:{}),s?{plid:s}:{})},e.prototype.getViewedImpressionEventAV=function(e){return n(n(n({},this.commonFields),{now:a.Utils.getNowInSeconds(),et:"viewed_impression_av",adix:e.adIndex,di:e.demandIndex,au:e.adUnit||"NA",atix:e.attemptIndex,pr:e.providerName?e.providerName:"",w:e.selectedSize&&e.selectedSize.w?e.selectedSize.w:-1,h:e.selectedSize&&e.selectedSize.h?e.selectedSize.h:-1,f:this.getFold(e),ot:a.Utils.getSpotCoords(e).top,pt:e.positionTypeToString(),ill:e.isLazyLoading,rc:e.refresh.impressionsEventCount||0,to:a.Utils.getTimeOffset(),ul:a.Utils.getScrollPosition().top,st:e.type}),this.getSpotTags(e))},e.prototype.getViewedPublisherAdAv=function(e){return n(n({},this.commonFields),{now:a.Utils.getNowInSeconds(),et:"viewed_publisher_ad_av",rc:e.refreshCount,h:e.height,f:e.foldNum,ot:a.Utils.getElementPosition(e.element).top,to:a.Utils.getTimeOffset(),pt:e.positionType,pr:e.providerName,plid:e.placementId,au:e.adUnit,ill:e.isLazyLoaded,ul:a.Utils.getScrollPosition().top})},e.prototype.getPrebidErrorEvent=function(e,t){return{et:"prebid_error",msg:e,error:e,file:t,now:Math.floor(Date.now()/1e3),to:+new Date-this.profile.identity.timeOffset,lineNo:-1,columnNo:-1,ibpv:!1,r:this.commonFields.r,url:this.commonFields.url,d:this.commonFields.d,res:this.commonFields.res,bpid:this.profile.identity.bootstrapPageviewId,sk:this.profile.identity.siteKey,pk:this.profile.identity.publisherKey,uid:a.Utils.getUserID(),sid:this.profile.identity.sessionId,pvid:this.profile.identity.pageviewId,scid:this.profile.identity.supplyConfigId,geo:this.profile.yieldData.countryCode,ts:this.profile.yieldData.trafficSource,mv:this.profile.yieldData.version,iru:this.profile.yieldData.isReturningUser,db:this.profile.deviceDetails.browser,dbt:this.profile.deviceDetails.browserType,dp:this.profile.deviceDetails.deviceType,dv:this.profile.deviceDetails.deviceVendor,dos:this.profile.deviceDetails.os,dosv:this.profile.deviceDetails.osVersion}},e.prototype.getSpotTags=function(e){return{ptg:e.tags.positionTag,ttg:e.tags.typeTag}},e.prototype.getPlaceholderEvent=function(e,t){return n({now:a.Utils.getNowInSeconds(),et:t,mv:this.profile.yieldData.version,sk:this.profile.identity.siteKey,pk:this.profile.identity.publisherKey,di:e.demandIndex,st:e.type,dp:this.profile.deviceDetails.deviceType,to:a.Utils.getTimeOffset(),url:this.profile.identity.url,pvid:this.profile.identity.pageviewId,adix:e.adIndex,atix:e.attemptIndex,ul:a.Utils.getScrollPosition().top},this.getSpotTags(e))},e.firedEvents=new Map,e}();t.EventsService=u},function(e,t,i){"use strict";var n,o=this&&this.__spreadArrays||function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<i;t++)for(var r=arguments[t],s=0,a=r.length;s<a;s++,o++)n[o]=r[s];return n};Object.defineProperty(t,"__esModule",{value:!0}),t.SCAN_SPOT_TAGS=t.RAILS_TAGS=t.FIXED_TAGS=t.FIXED_RAILS_TAGS=t.DYNAMIC_RAILS_TAGS=t.SPOT_TAGS_MAP=t.SpotType=void 0;var r,s=i(9);!function(e){e.FIXED_MC="fixed_mc",e.FIXED_TOP="fixed_top",e.FIXED_BOTTOM="fixed_bottom",e.DYNAMIC_MC="dynamic_mc",e.STICKY="sticky",e.FIXED_RIGHT_RAIL="fixed_right_rail",e.FIXED_LEFT_RAIL="fixed_left_rail",e.DYNAMIC_RIGHT_RAIL="dynamic_right_rail",e.DYNAMIC_LEFT_RAIL="dynamic_left_rail",e.API="api"}(r=t.SpotType||(t.SpotType={})),t.SPOT_TAGS_MAP=((n={})[r.FIXED_MC]={oldType:r.FIXED_MC,typeTag:s.TypeTag.FIXED,positionTag:"in"},n[r.FIXED_TOP]={oldType:r.FIXED_TOP,typeTag:s.TypeTag.FIXED,positionTag:"t"},n[r.FIXED_BOTTOM]={oldType:r.FIXED_BOTTOM,typeTag:s.TypeTag.FIXED,positionTag:"b"},n[r.DYNAMIC_MC]={oldType:r.DYNAMIC_MC,typeTag:s.TypeTag.DYNAMIC,positionTag:"in"},n[r.STICKY]={oldType:r.STICKY,typeTag:s.TypeTag.STICKY,positionTag:"s"},n[r.FIXED_RIGHT_RAIL]={oldType:r.FIXED_RIGHT_RAIL,typeTag:s.TypeTag.FIXED,positionTag:"r"},n[r.FIXED_LEFT_RAIL]={oldType:r.FIXED_LEFT_RAIL,typeTag:s.TypeTag.FIXED,positionTag:"l"},n[r.DYNAMIC_RIGHT_RAIL]={oldType:r.DYNAMIC_RIGHT_RAIL,typeTag:s.TypeTag.DYNAMIC,positionTag:"r"},n[r.DYNAMIC_LEFT_RAIL]={oldType:r.DYNAMIC_LEFT_RAIL,typeTag:s.TypeTag.DYNAMIC,positionTag:"l"},n),t.DYNAMIC_RAILS_TAGS=[t.SPOT_TAGS_MAP[r.DYNAMIC_LEFT_RAIL],t.SPOT_TAGS_MAP[r.DYNAMIC_RIGHT_RAIL]],t.FIXED_RAILS_TAGS=[t.SPOT_TAGS_MAP[r.FIXED_LEFT_RAIL],t.SPOT_TAGS_MAP[r.FIXED_RIGHT_RAIL]],t.FIXED_TAGS=o([t.SPOT_TAGS_MAP[r.FIXED_MC],t.SPOT_TAGS_MAP[r.FIXED_TOP],t.SPOT_TAGS_MAP[r.FIXED_BOTTOM]],t.FIXED_RAILS_TAGS),t.RAILS_TAGS=o(t.DYNAMIC_RAILS_TAGS,t.FIXED_RAILS_TAGS),t.SCAN_SPOT_TAGS=o([t.SPOT_TAGS_MAP[r.DYNAMIC_MC]],t.FIXED_TAGS,t.DYNAMIC_RAILS_TAGS)},function(e,t,i){"use strict";var n=this&&this.__spreadArrays||function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<i;t++)for(var r=arguments[t],s=0,a=r.length;s<a;s++,o++)n[o]=r[s];return n};Object.defineProperty(t,"__esModule",{value:!0}),t.SpotsUtils=t.FIXED_TYPES=t.FIXED_RAIL_TYPES=t.DYNAMIC_RAIL_TYPES=void 0;var o=i(1),r=i(4),s=i(2),a=i(0),l=i(24),d=i(11);t.DYNAMIC_RAIL_TYPES=[r.SpotType.DYNAMIC_LEFT_RAIL,r.SpotType.DYNAMIC_RIGHT_RAIL],t.FIXED_RAIL_TYPES=[r.SpotType.FIXED_LEFT_RAIL,r.SpotType.FIXED_RIGHT_RAIL],t.FIXED_TYPES=n([r.SpotType.FIXED_MC,r.SpotType.FIXED_TOP,r.SpotType.FIXED_BOTTOM],t.FIXED_RAIL_TYPES);var p=function(){function e(){}return e.getConf=function(e){if(this.allSpotsConfigs||(this.allSpotsConfigs=this.buildTypesConf()),e.oldType===r.SpotType.API){var t=this.allSpotsConfigs[r.SpotType.API];return t?t[e.positionTag]:void 0}return this.allSpotsConfigs[e.oldType]},e.rebuild=function(){this.allSpotsConfigs=this.buildTypesConf()},e.isActive=function(e){switch(e.oldType){case r.SpotType.DYNAMIC_MC:case r.SpotType.FIXED_MC:case r.SpotType.FIXED_BOTTOM:case r.SpotType.FIXED_TOP:case r.SpotType.DYNAMIC_LEFT_RAIL:case r.SpotType.DYNAMIC_RIGHT_RAIL:case r.SpotType.FIXED_LEFT_RAIL:case r.SpotType.FIXED_RIGHT_RAIL:var t=this.getConf(e);return!!t&&0!==t.maxSpots;default:return!!this.getConf(e)}},e.isFixedSpot=function(e){return t.FIXED_TYPES.includes(e)},e.getElementsByType=function(i,n){var a,l,d;if(i===r.SpotType.DYNAMIC_MC){var p=s.Profiler.get().domData;return p?s.Profiler.getPotentialSpots(s.Profiler.get().spotEngineConfig.targetSelectors,p.mainContent.inputElements,p.mainContent.borderElement):[]}var c=o.Utils.sortElementsByPosition.apply(o.Utils,o.Utils.querySelectorAll(n,e.errorCallback,this.isRailSpot(i)));return t.DYNAMIC_RAIL_TYPES.includes(i)?s.Profiler.collectTargetElements((null===(d=null===(l=null===(a=s.Profiler.get().spotEngineConfig.rails)||void 0===a?void 0:a.ts)||void 0===l?void 0:l.ts)||void 0===d?void 0:d.e)||[],c):c},e.updateMCSpotsElements=function(){var e=this;[r.SPOT_TAGS_MAP[r.SpotType.DYNAMIC_MC],r.SPOT_TAGS_MAP[r.SpotType.FIXED_MC]].forEach((function(t){var i=e.getConf(t);i&&(i.elements=e.getElementsByType(t.oldType,i.targetElements))}))},e.isRailSpot=function(e){return this.getRailsTypes().includes(e)},e.getRailsTypes=function(){return n(t.DYNAMIC_RAIL_TYPES,t.FIXED_RAIL_TYPES)},e.getAllScanTypes=function(){return n([r.SpotType.DYNAMIC_MC],t.FIXED_TYPES,t.DYNAMIC_RAIL_TYPES)},e.getAllTypes=function(){return n([r.SpotType.DYNAMIC_MC,r.SpotType.STICKY,r.SpotType.API],t.FIXED_TYPES,t.DYNAMIC_RAIL_TYPES)},e.getTagsToScanBeforeDcs=function(){var e=this;return n([r.SPOT_TAGS_MAP[r.SpotType.STICKY],r.SPOT_TAGS_MAP[r.SpotType.FIXED_TOP]],r.RAILS_TAGS).filter((function(t){return e.isActive(t)}))},e.getTypesToDisableOnDcs=function(e){var t;return"end_less"===e&&(null===(t=s.Profiler.get().spotEngineConfig.dcs)||void 0===t?void 0:t.rescanRails)?[r.SpotType.STICKY]:n([r.SpotType.STICKY],this.getRailsTypes())},e.getOptimizeViewabilityTypes=function(){return n([r.SpotType.DYNAMIC_MC,r.SpotType.API],t.FIXED_TYPES,t.DYNAMIC_RAIL_TYPES)},e.getCompatibleSizesByType=function(e,t,i){var n,o,a=[];switch(e){case r.SpotType.FIXED_MC:a=i&&i.length?i:(null===(n=s.Profiler.get().domData)||void 0===n?void 0:n.dynamicCompatibleSizes)||[];break;case r.SpotType.DYNAMIC_MC:return(null===(o=s.Profiler.get().domData)||void 0===o?void 0:o.dynamicCompatibleSizes)||[];default:a=i}return this.buildAdSizes(t,a,e)},e.buildAdSizes=function(e,t,i){var n=[];return e.forEach((function(e){if(0!==t.length){var o=s.Profiler.getWidthForEmbed(e),r=s.Profiler.buildAdSizes(o,t,!0,!1,i);t=t.filter((function(e){return!r.find((function(t){return t.h===e.h&&t.w===e.w}))})),n=n.concat(r)}})),n},e.getBrowsiAdsStayAwayDistance=function(e){var t;return(null===(t=this.getConf(e))||void 0===t?void 0:t.distance)||0},e.buildTypesConf=function(){return{fixed_mc:this.generateFixedConfig(r.SpotType.FIXED_MC),fixed_top:this.generateFixedConfig(r.SpotType.FIXED_TOP),fixed_bottom:this.generateFixedConfig(r.SpotType.FIXED_BOTTOM),dynamic_mc:this.generateDynamicInContentConfig(),sticky:this.generateStickyConfig(),fixed_right_rail:this.generateRailsConfig(r.SpotType.FIXED_RIGHT_RAIL,!0),fixed_left_rail:this.generateRailsConfig(r.SpotType.FIXED_LEFT_RAIL,!0),dynamic_right_rail:this.generateRailsConfig(r.SpotType.DYNAMIC_RIGHT_RAIL),dynamic_left_rail:this.generateRailsConfig(r.SpotType.DYNAMIC_LEFT_RAIL),api:s.Profiler.get().layouts.spots.api}},e.generateDynamicInContentConfig=function(){var e=s.Profiler.get(),t=e.layouts.spots.dynamic;if(t){var i=this.getTargetElements(r.SpotType.DYNAMIC_MC),n=this.getElementsByType(r.SpotType.DYNAMIC_MC,i),o=t.maxItems||0;return{targetElements:i,elements:n,allowedCreativeSizes:this.getCompatibleSizesByType(r.SpotType.DYNAMIC_MC,n,t.allowedCreativeSizes),maxItems:o||0,maxSpots:Math.max(o,e.layouts.potentialSpots||0),lazyLoading:t.lazyLoading,startInFold:t.startInFold,stopInFold:t.stopInFold,engagedUsers:t.engagedUsers,distance:t.distance||0,viewabilityThreshold:t.viewabilityThreshold}}},e.generateFixedConfig=function(e){var t,i=s.Profiler.get();switch(e){case r.SpotType.FIXED_MC:t=i.layouts.spots.fixedMC;break;case r.SpotType.FIXED_BOTTOM:t=i.layouts.spots.fixedBottom;break;case r.SpotType.FIXED_TOP:t=i.layouts.spots.fixedTop}if(t){var n=this.getTargetElements(e),o=this.getElementsByType(e,n),a=o.length;return{targetElements:n,elements:o,allowedCreativeSizes:this.getCompatibleSizesByType(e,o,t.allowedCreativeSizes),maxSpots:a,maxItems:a,lazyLoading:t.lazyLoading,startInFold:t.startInFold,stopInFold:t.stopInFold,engagedUsers:t.engagedUsers,viewabilityThreshold:t.viewabilityThreshold,targetElementPosition:t.targetElementPosition}}},e.generateRailsConfig=function(e,t){var i=s.Profiler.get(),n=i.layouts.spots.rails;if(n&&this.isValidRailsConf(e)){var o=this.getTargetElements(e),r=this.getElementsByType(e,o),a=t?r.length:n.maxItems||0;return{targetElements:o,elements:r,allowedCreativeSizes:this.getCompatibleSizesByType(e,r,n.allowedCreativeSizes),maxSpots:Math.max(a,i.layouts.potentialSpots||0),maxItems:a,lazyLoading:n.lazyLoading,startInFold:n.startInFold,stopInFold:n.stopInFold,engagedUsers:n.engagedUsers,distance:n.distance,viewabilityThreshold:n.viewabilityThreshold,railSide:n.railSide}}},e.generateStickyConfig=function(){var e=s.Profiler.get().layouts.spots.sticky;if(e)return{location:e.location,allowedCreativeSizes:e.allowedCreativeSizes,closeButton:e.closeButton}},e.getLazyConfig=function(e){var t;return(null===(t=e.optimizeViewability)||void 0===t?void 0:t.lazyLoadingConfig)?{firstAdIndex:e.optimizeViewability.lazyLoadingConfig.firstAdIndex,firstFold:e.optimizeViewability.lazyLoadingConfig.firstFold}:void 0},e.getTargetElements=function(e){var t,i,n,o,a,d,p,c,u,f,h,g,m=s.Profiler.get().spotEngineConfig,y=m.rails,v=m.mainContentConfig,S=s.Profiler.get().layouts;switch(e){case r.SpotType.FIXED_BOTTOM:g=null===(t=S.spots.fixedBottom)||void 0===t?void 0:t.targetElements;break;case r.SpotType.FIXED_TOP:g=null===(i=S.spots.fixedTop)||void 0===i?void 0:i.targetElements;break;case r.SpotType.FIXED_MC:g=null===(n=S.spots.fixedMC)||void 0===n?void 0:n.targetElements;break;case r.SpotType.DYNAMIC_LEFT_RAIL:g=null===(a=null===(o=null==y?void 0:y.ts)||void 0===o?void 0:o.ts)||void 0===a?void 0:a.l;break;case r.SpotType.DYNAMIC_RIGHT_RAIL:g=null===(p=null===(d=null==y?void 0:y.ts)||void 0===d?void 0:d.ts)||void 0===p?void 0:p.r;break;case r.SpotType.FIXED_LEFT_RAIL:(null===(c=S.spots.rails)||void 0===c?void 0:c.railSide.includes(l.RailsSides.LEFT))&&(g=null===(u=S.spots.rails)||void 0===u?void 0:u.targetElements);break;case r.SpotType.FIXED_RIGHT_RAIL:(null===(f=S.spots.rails)||void 0===f?void 0:f.railSide.includes(l.RailsSides.RIGHT))&&(g=null===(h=S.spots.rails)||void 0===h?void 0:h.targetElements);break;case r.SpotType.DYNAMIC_MC:g=null==v?void 0:v.s}return g||[]},e.getViewabilityThreshold=function(t){var i;return(null===(i=e.getConf(t))||void 0===i?void 0:i.viewabilityThreshold)||null},e.isValidRailsConf=function(e){var t=s.Profiler.get(),i=t.layouts.spots.rails,n=t.spotEngineConfig.rails;switch(e){case r.SpotType.DYNAMIC_LEFT_RAIL:return!!(i&&(null==n?void 0:n.sd)&&(null==i?void 0:i.railSide.includes(l.RailsSides.LEFT)));case r.SpotType.DYNAMIC_RIGHT_RAIL:return!!(i&&(null==n?void 0:n.sd)&&(null==i?void 0:i.railSide.includes(l.RailsSides.RIGHT)));case r.SpotType.FIXED_LEFT_RAIL:return!!(i&&i.railSide.includes(l.RailsSides.LEFT)&&i.targetElements);case r.SpotType.FIXED_RIGHT_RAIL:return!!(i&&i.railSide.includes(l.RailsSides.RIGHT)&&i.targetElements);default:return!1}},e.shouldLazyLoad=function(e){return e.optimizeViewability&&d.default.get().isLazy(e)},e.getTargetElementPosition=function(t){var i;return(null===(i=e.getConf(t))||void 0===i?void 0:i.targetElementPosition)||"ABOVE"},e.isValidHeightForSkipSa=function(e){var t=o.Utils.getPageHeight();return o.Utils.getElementSize(e).h<.8*t},e.logger=new a.Logger("SpotsUtils"),e.errorCallback=function(t){return e.logger.error(t)},e}();t.SpotsUtils=p},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResponseTimeCollector=t.ResourceType=t.TimingType=void 0;var n=i(0),o=i(3),r=i(2),s={engineInitiator:"ei",preDemand:"pd",onPostDemand:"psd",preFetch:"prf",preFetchAsync:"pfa",preDfpHB:"pdh",preAuction:"pa",postFetch:"pof",postEmbed:"poe",prePubadsRefresh:"ppr"};!function(e){e.RULE="r",e.SUPPLY="s",e.SPOTSENGINE="se",e.RESOURCE="rs",e.GENERIC_JS="gjs",e.XHR_STICKY="xs",e.XHR_PUB_AD_REFRESH="xp",e.XHR_GET_DEMAND="d"}(t.TimingType||(t.TimingType={})),function(e){e.GPT="gpt",e.PREBID="pbd",e.APS="aps",e.GENERIC_JS="gjs",e.IX="ix",e.MIDDY="mdy",e.RULES_JS="rul",e.AD_BLOCKER="adb"}(t.ResourceType||(t.ResourceType={}));var a=function(){function e(){this.active=!1,this.responsesStartTimes={r:{},rs:{},s:-1,d:{},se:-1},this.responseData={r:{},rs:{},s:-1,d:[],se:-1,xs:[],xp:[]},this.logger=new n.Logger("TimeReporter");var e=r.Profiler.get().reportResponseTime;this.active=!!e.active,this.active&&(window.top.addEventListener("pagehide",this.sendEvent.bind(this)),window.top.addEventListener("beforeunload",this.sendEvent.bind(this)),window.top.addEventListener("unload",this.sendEvent.bind(this)))}return e.get=function(){return e.instance||(this.instance=new e),e.instance},e.prototype.setRuleBySpot=function(e,t,i){if(this.active){var n=this.getSpotUniqueId(t);i?this.setRuleStart(e,n):this.setRuleEnd(e,n)}},e.prototype.setXhrEnd=function(e,t,i){if(this.active){var n;switch(e){case"getDemand":return this.setDemandEnd(t,i);case"sticky":n="xs";break;case"pubad":n="xp"}n&&(this.responseData[n].push(t),this.logger.info("log XHR",e,"time:",t))}},e.prototype.setDemandEnd=function(e,t){this.responseData.d.push({t:e,sra:!!(null==t?void 0:t.sra)}),this.logger.info("log XHR for get deamnd","time:",e,"sra",!!(null==t?void 0:t.sra))},e.prototype.setRuleStart=function(e,t){if(this.active){var i=this.responsesStartTimes.r;i[e]=i[e]={},i[e][t]=this.getTime()}},e.prototype.setRuleEnd=function(e,t){var i,n;if(this.active){var o=null===(n=null===(i=this.responsesStartTimes.r)||void 0===i?void 0:i[e])||void 0===n?void 0:n[t];if(o){var r=Number((this.getTime()-o).toFixed(2)),a=this.responseData.r,l=s[e]||e;a[l]=a[l]||[],a[l].push(r)}}},e.prototype.setSingleStart=function(e,t){this.active&&(t?this.responsesStartTimes[e][t]=this.getTime():this.responsesStartTimes[e]=this.getTime())},e.prototype.setSingleEnd=function(e,t){if(this.active){var i=this.responsesStartTimes[e];if(i=t&&i?i[t]:i){var n=Number((this.getTime()-i).toFixed(2));t?this.responseData[e][t]=n:this.responseData[e]=n}}},e.prototype.measureScript=function(e,t){var i=this;if(this.active){var n=this.responsesStartTimes.rs;n[e]||(n[e]=this.getTime()),t.addEventListener("load",(function(){if(n[e]){var t=Number((i.getTime()-n[e]).toFixed(2));i.responseData.rs[e]=t}}))}},e.prototype.sendEvent=function(){if(this.active){this.active=!1;var e=r.Profiler.get().reportResponseTime;this.responseData.s=Number(e.timers.s||-1),this.responseData.rs.mdy=Number(e.timers.mdy||-1),this.responseData.rs.rul=Number(e.timers.rul||-1);var t=[o.EventsService.get().getResponseTimeEvent(this.responseData)];navigator.sendBeacon(r.Profiler.get().yieldData.eventServerUrl+"performance?p="+t[0].pvid,JSON.stringify(t)),window.top.removeEventListener("pagehide",this.sendEvent.bind(this)),window.top.removeEventListener("beforeunload",this.sendEvent.bind(this)),window.top.removeEventListener("unload",this.sendEvent.bind(this))}},e.prototype.getSpotUniqueId=function(e){return e.adIndex+"_ati_"+(e.attemptIndex?e.attemptIndex:1)+"_rc_"+(e.refresh?e.refresh.count:0)},e.prototype.getTime=function(){return Date.now()},e}();t.ResponseTimeCollector=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DcsUtils=void 0;var n=function(){function e(){}return e.getWindowObject=function(){return window.top[this.winObjName]},e.getDcsType=function(){var e=this.getWindowObject();return e&&e.dcsType},e.getIfEndless=function(){var e=this.getWindowObject();return e&&"end_less"===e.dcsType?e:void 0},e.getCurrentPvsObject=function(){var e=this.getWindowObject();return e&&e.pvs[e.count-1]},e.getCurrentDcsElement=function(){var e=this.getCurrentPvsObject();return e&&e.e},e.getHandledArticles=function(e){var t=[];return e&&(e.ppv.e&&t.push(e.ppv.e),e.pvs.forEach((function(e){t.push(e.e)}))),t},e.getActionCounter=function(){var e=this.getWindowObject();return e&&e.count||0},e.getDemandDcsSuffix=function(){var e=this.getActionCounter();return e?"_d_"+e:""},e.winObjName="__dcs",e.dcsElement=e.getCurrentDcsElement(),e.isDcs=!!e.getWindowObject(),e}();t.DcsUtils=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),o=i(2),r=function(){function e(){this.callbackMap={},this.logger=new n.Logger("ListenerService")}return e.get=function(){return this.instance||(this.instance=new e),this.instance},e.prototype.listen=function(e,t,i,n){o.Profiler.get().identity.pageviewId===window.top._middyo.i.pv?t&&"function"==typeof t.addEventListener?(this.insert(e,{callback:i,listenObject:t}),t.addEventListener(e,i,n),this.logger.info("Listening to "+e+" on ",t)):this.logger.error("Failed listening to: ",t):this.logger.info("Pv changed, NOT Listening to "+e+" on ",t)},e.prototype.removeListener=function(e,t,i){if(t&&"function"==typeof t.removeEventListener){var n=this.findListener(e,i);i=n?n.callback:i,this.remove(e,{callback:i,listenObject:t}),t.removeEventListener(e,i),this.logger.info("Stopped listening to "+e+" on ",t)}else this.logger.error("Failed listening to: ",t)},e.prototype.listenToPbjs=function(e,t,i){o.Profiler.get().identity.pageviewId===window.top._middyo.i.pv?t&&"function"==typeof t.onEvent?(this.insert(e,{callback:i,listenObject:t}),t.onEvent(e,i),this.logger.info("Listening to pbjs "+e+" on ",t)):this.logger.error("Failed listening to pbjs: ",t):this.logger.info("Pv changed, NOT Listening to "+e+" on ",t)},e.prototype.removePbjsListener=function(e,t,i){if(t&&"function"==typeof t.offEvent){var n=this.findListener(e,i);i=n?n.callback:i,this.remove(e,{callback:i,listenObject:t}),t.offEvent(e,i),this.logger.info("Stopped listening to pbjs "+e+" on ",t)}else this.logger.error("Failed listening to pbjs: ",t)},e.prototype.removeAll=function(){var e=this,t=function(t){i.callbackMap.hasOwnProperty(t)&&(i.callbackMap[t].forEach((function(i){if("removeEventListener"in i.listenObject)(n=i).listenObject.removeEventListener(t,n.callback);else if("offEvent"in i.listenObject){var n;(n=i).listenObject.offEvent(t,n.callback)}else e.logger.debug("could not remove callback",i);e.logger.info("Stopped listening to "+t+" on ",i.listenObject)})),i.callbackMap[t]=[])},i=this;for(var n in this.callbackMap)t(n)},e.prototype.findListener=function(e,t){return this.callbackMap[e]&&this.callbackMap[e].find((function(e){return e.callback===t}))},e.prototype.insert=function(e,t){this.callbackMap.hasOwnProperty(e)||(this.callbackMap[e]=[]),this.callbackMap[e].push(t)},e.prototype.remove=function(e,t){if(this.callbackMap.hasOwnProperty(e)){var i=this.callbackMap[e].find((function(e){return e.callback.toString()===t.callback.toString()&&e.listenObject===t.listenObject}));if(null!=i){var n=this.callbackMap[e].indexOf(i);n>-1&&this.callbackMap[e].splice(n,1)}}},e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypeTag=t.PositionTagLong=t.PositionTag=t.LayoutPositionTag=void 0,function(e){e.TOP="t",e.IN_CONTENT="in",e.BOTTOM="b",e.STICKY="s",e.RAILS="r"}(t.LayoutPositionTag||(t.LayoutPositionTag={})),function(e){e.TOP="t",e.IN_CONTENT="in",e.BOTTOM="b",e.STICKY="s",e.RIGHT_RAIL="r",e.LEFT_RAIL="l"}(t.PositionTag||(t.PositionTag={})),function(e){e.TOP="top",e.BOTTOM="bottom",e.IN_CONTENT="in-content",e.STICKY="adhesive",e.RIGHT_RAIL="right-rail",e.LEFT_RAIL="left-rail"}(t.PositionTagLong||(t.PositionTagLong={})),function(e){e.DYNAMIC="dy",e.FIXED="fi",e.API="api",e.STICKY="s"}(t.TypeTag||(t.TypeTag={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),o=i(28),r=i(1),s=i(13),a=i(4),l=i(2),d=i(7),p=i(5),c=i(9),u=function(){function e(){var e=this;this.profile=l.Profiler.get(),this.logger=new n.Logger("SAService"),this.spots=[],this.errorCallback=function(t){return e.logger.error(t)},this.mainContentElements=this.profile.spotEngineConfig.mainContentConfig&&this.profile.spotEngineConfig.mainContentConfig.s?r.Utils.querySelectorAll(this.profile.spotEngineConfig.mainContentConfig.s,this.errorCallback):[],this.mainContentEndElement=this.profile.spotEngineConfig.mainContentConfig&&this.profile.spotEngineConfig.mainContentConfig.e?r.Utils.querySelector(this.profile.spotEngineConfig.mainContentConfig.e[0],this.errorCallback):null,this.stayAwayConfigs=this.profile.spotEngineConfig.stayAwayConfigs||[],this.maxSaDistance=this.stayAwayConfigs.reduce((function(e,t){return e.d<t.d?t:e}),{v:[""],d:0}).d,this.stayAwayElements=[],this.scanDomForSA()}return Object.defineProperty(e,"instance",{get:function(){return this._instance||(this._instance=new e),this._instance},enumerable:!1,configurable:!0}),e.prototype.setSpots=function(e){this.spots=e},e.prototype.getStayAwayElementsList=function(){return this.stayAwayElements.map((function(e){return{element:e.element,distance:e.distance,selector:e.selector,inMainContent:e.inMainContent,target:e.target}}))},e.prototype.scanDomForSA=function(){var e=this;this.logger.info("scanDomForSA");var t=d.DcsUtils.getIfEndless();if(t){var i=t.pvs[t.count-1].data.sAE;i&&i.forEach((function(t){var i={sa:{element:t.element,distance:t.distance,selector:"__FROM LAST PV DCS__"},config:{d:0,v:["__FROM LAST PV DCS__"],t:t.target}};e.upsertStayAwayElement(t.element,i,!1)}))}this.stayAwayConfigs.forEach((function(t){t.v.forEach((function(i){var n=r.Utils.querySelectorAll([i],e.errorCallback);e.handleStayAwayConfig(n,t,i)}))}));var n=l.Profiler.get().domData;n&&(n.stayAwayElements=this.getStayAwayElementsList())},e.prototype.scanDomForLazySA=function(e,t,i){var n=this;this.logger.info("re-scanning dom for SA");var o=r.Utils.getPositionFallback(e);this.stayAwayConfigs.forEach((function(e){e.v.forEach((function(s){var a=r.Utils.querySelectorAll([s],n.errorCallback).filter((function(r){return n.shouldStayAwayFrom(r,o,t,i,e.t)}));n.handleStayAwayConfig(a,e,s,!0)}))}))},e.prototype.handleStayAwayConfig=function(e,t,i,n){var o=this;e.map((function(e){return{sa:{element:e,distance:t.d,selector:i},config:t}})).forEach((function(e){o.upsertStayAwayElement(e.sa.element,e,!!n)}))},e.prototype.shouldStayAwayFrom=function(e,t,i,n,o){return-1!==this.mapSATarget(o).indexOf(n)&&(Math.abs(r.Utils.getPositionFallback(e)-t)<=this.maxSaDistance&&(!i||r.Utils.isDescendantElement(this.mainContentElements,e)))},e.prototype.upsertStayAwayElement=function(e,t,i){if(!["__FROM LAST PV DCS__","pubAd"].includes(t.config.v[0])&&!p.SpotsUtils.isValidHeightForSkipSa(e))return this.logger.debug(e,"is over 80% of page height, ignore it"),null;var n=this.isInMainContent(e),o=this.stayAwayElements.find((function(t){return t.element===e}));if(o)return this.updateSaElement(e,o,n),null;var r=this.insertSaElement(e,t,i,n);return this.handleIfManualAd(t,r,i),void 0!==t.config.v?this.logger.debug(i?"Lazy ":"","Added",r,"By Config: ",t):this.logger.debug(i?"Lazy ":"","Added",r),r},e.prototype.updateSaElement=function(e,t,i){var n=Object.assign({},t),o=this.isSaValid(e);!t.isValid&&o&&(t.isLazy=!0),t.top=this.getPositionFromTop(e),t.height=e.getBoundingClientRect().height,t.isValid=o,t.inMainContent=i,n.top===t.top&&n.height===t.height&&e.style.display===t.element.style.display||this.logger.debug("Updated: ",n," TO: ",t)},e.prototype.insertSaElement=function(e,t,i,n){var o=e.getBoundingClientRect(),r={element:e,top:this.getPositionFromTop(e),height:o.height,distance:t.sa.distance,isLazy:i,inMainContent:n,isValid:this.isSaValid(e),isPubAd:"pubAd"===t.config.v[0],target:t.config.t,selector:t.sa.selector};return this.stayAwayElements.push(r),r},e.prototype.mapSATarget=function(e){var t=[];return e.includes(o.SATargets.MC)&&t.push(a.SpotType.FIXED_MC,a.SpotType.DYNAMIC_MC),e.includes(o.SATargets.TOP)&&t.push(a.SpotType.FIXED_TOP),e.includes(o.SATargets.BOTTOM)&&t.push(a.SpotType.FIXED_BOTTOM),e.includes(o.SATargets.RIGHT)&&t.push(a.SpotType.DYNAMIC_RIGHT_RAIL,a.SpotType.FIXED_RIGHT_RAIL),e.includes(o.SATargets.LEFT)&&t.push(a.SpotType.DYNAMIC_LEFT_RAIL,a.SpotType.FIXED_LEFT_RAIL),t},e.prototype.getPositionFromTop=function(e){return this.profile.spotEngineConfig.useNewStayAwayCalc?r.Utils.getPositionFallback(e):r.Utils.getElementPosition(e).top},e.prototype.isSaValid=function(e){return r.Utils.isVisible(e)&&!r.Utils.isPositionFixed(e)},e.prototype.validateSa=function(e){return!this.profile.spotEngineConfig.useNewStayAwayCalc||e.isValid},e.prototype.isElementContainedInSa=function(e,t){return!!this.profile.spotEngineConfig.useNewStayAwayCalc&&r.Utils.isPositionContained(e,t)},e.prototype.checkStayAwayViolation=function(e){if(e.tags.typeTag===c.TypeTag.FIXED&&this.profile.layouts.fixedSpotsFirst)return null;l.Profiler.get().spotEngineConfig.isLazySAActive&&(this.logger.debug("Checking SA from newly added elements (lazy)"),this.scanDomForLazySA(e.ref,e.type===a.SpotType.DYNAMIC_MC,e.type));var t=this.isStayAwayForAllEmbedTypes(e.ref,e.compatibleSizes,e.type===a.SpotType.DYNAMIC_MC,e.type);return"invalid"===t.status?{reason:"stay_away",message:t.message}:null},e.prototype.isStayAwayForAllEmbedTypes=function(e,t,i,n){var o=r.Utils.getEmbedTypesFromSizes(t),s=o.includes("break"),a=o.includes("wrapped");if(s){var l=this.isStayAwayElement(e,i,n);if("invalid"===l.status)return l;if(a)return this.checkWrapSA(e,t,i,n)}else if(a)return this.checkWrapSA(e,t,i,n);return{status:"valid"}},e.prototype.checkWrapSA=function(e,t,i,n){for(var o,r=t.length;r--;)if("invalid"===(o=this.removeViolatingWrappedEmbeddings(e,t[r],i,n)).status&&t.splice(r,1),0===t.length)return o;return{status:"valid"}},e.prototype.removeViolatingWrappedEmbeddings=function(e,t,i,n){var o=t.optionalEmbeddings.indexOf("wrapped");if(o>-1){var r=this.isStayAwayElement(e,i,n,t);if("invalid"===r.status)return t.optionalEmbeddings.splice(o,1),t.selectedEmbedding&&(t.selectedEmbedding="break"),t.optionalEmbeddings.length>0?{status:"valid"}:r}return{status:"valid"}},e.prototype.isStayAwayElement=function(e,t,i,n){var o=this,s=this.stayAwayElements.find((function(s){if(s.isPubAd&&p.SpotsUtils.isFixedSpot(i)||-1===o.mapSATarget(s.target).indexOf(i))return!1;if(!o.validateSa(s)||!r.Utils.isElement(s.element))return!1;if(t&&!s.inMainContent)return!1;if(o.isElementContainedInSa(s.element,e))return!0;var a=r.Utils.calculateDistanceBetween(e,s.element);r.Utils.isPositionedAfter(e,s.element)&&(a+=r.Utils.getAdMarkingExpectedHeight());var l=0;return r.Utils.isPositionedAfter(s.element,e)&&(l+=r.Utils.getWrappingOffset(e,s.element,n),l+=e.getBoundingClientRect().height),a+l<=s.distance}));return this.getViolationStatus(s)},e.prototype.getViolationStatus=function(e){return e&&e.element?{status:"invalid",message:e.isPubAd?"pub_ad":"stay_away",element:e.element}:{status:"valid"}},e.prototype.isInMainContent=function(e){return r.Utils.isDescendantElement(this.mainContentElements,e)},e.prototype.handleIfManualAd=function(e,t,i){if(e.config.adn){if(r.Utils.getElementSize(e.sa.element).h<=25)return void this.logger.info("ignoring sa ad element, height <= 25",e.sa.element);var n=this.getManualAdId(e);t.isPubAd=!0;var o={element:e.sa.element,providerName:e.config.adn,placementId:n,adUnit:n,isLazyLoaded:i,isManualAd:!0};s.default.get().addIfNew(o)}},e.prototype.getManualAdId=function(e){return e.sa.element.id||e.sa.selector},e}();t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),o=i(1),r=i(2),s=i(3),a=i(8),l=i(5),d=i(4),p=function(){function e(){var e=this;this.logger=new n.Logger("Lazy"),this.profile=r.Profiler.get(),this.lazySpots=[],this.lazySpotsLocations=[],this.generalLazyConfig=this.profile.layouts.lazySpots,this.lazyStatus={lastPosition:-1,positionListenerActive:!1,expectedNextPosition:-1,scrollDirection:"up",previousTime:-1},this.lazySpotsListener=o.Utils.throttle((function(){return e.checkLocationAndFetch()}),100),this.fetchTime=this.buildFetchTime(),this.postMovementTimeoutActive=!1,this.serviceActive=!1,this.userPositionInterval=null}return e.get=function(){return e._instance||(this._instance=new e),e._instance},e.isLazyConfiguredForSpotType=function(e){if(!this.isSupportedSpotType(e.type))return!1;var t=l.SpotsUtils.getConf(e.tags);return!(!t||!t.lazyLoading)},e.isSupportedSpotType=function(e){return l.SpotsUtils.getOptimizeViewabilityTypes().includes(e)},e.prototype.getThresholdMidPoint=function(e){if(e.isLazyLoading){e.offsetTop=o.Utils.getElementPosition(e.ref).top;var t=this.getThresholdLocation(e);return Math.floor(e.offsetTop-.5*(e.offsetTop-t))}return o.Utils.getScrollingDistance()},e.prototype.isLazy=function(t){var i;if(t.isEagerFirstFold())return!1;if(!e.isSupportedSpotType(t.type))return!1;var n=null===(i=l.SpotsUtils.getConf(t.tags))||void 0===i?void 0:i.lazyLoading;return!!(this.generalLazyConfig&&n&&this.shouldCheckLazyLoad(t))&&(void 0===n.firstAdIndex||void 0===n.firstFold?(this.logger.error(t.type+" spot "+t.adIndex+" has an illegal configuration",n),!1):t.typeIndex>=n.firstAdIndex&&o.Utils.getElementFoldNumber(t.ref)>=n.firstFold)},e.prototype.shouldCheckLazyLoad=function(e){return e.type!==d.SpotType.STICKY&&this.fetchTime>-1},e.prototype.buildFetchTime=function(){var e;if(!this.generalLazyConfig)return-1;if(!this.generalLazyConfig.dynamicFetchTime||!this.profile.loadTime)return this.logger.info("Selected fetchTime is average fetch time: "+this.generalLazyConfig.avgFetchTime),this.generalLazyConfig.avgFetchTime;var t=null===(e=this.profile.optimizedData)||void 0===e?void 0:e.lazyFetchTime;if(!t||!Array.isArray(t)||6!==t.length)return this.logger.info("Issue with dynamic fetch time buckets",t),-1;var i=Math.round(this.profile.loadTime/1e3);return i=Math.max(i,0),i=Math.min(i,5),this.logger.info("Selected fetchTime is: "+t[i],t),t[i]},e.prototype.subscribe=function(e,t){this.serviceActive||this.startService(),this.isSpotMissed(e)&&this.handleAdRequestBlock(e),e.offsetTop=o.Utils.getElementPosition(e.ref).top;var i=this.getThresholdLocation(e);this.logger.info(e.type+" spot "+e.typeIndex+" at "+e.offsetTop+" will start at "+i.toFixed(2)),this.lazySpots.push({spot:e,approvalsCount:0,thresholdLocation:i,fetchCallback:t}),this.lazySpotsLocations=this.lazySpots.sort((function(e,t){return e.spot.adIndex-t.spot.adIndex})).map((function(e){return{t:e.thresholdLocation,l:e.spot.offsetTop}})),this.fetchChecking()},e.prototype.unsubscribe=function(e){this.serviceActive&&this.lazySpots.length>0&&(this.logger.debug("Stopping subscription for "+e.length+" spots: ",e),this.lazySpots=this.lazySpots.filter((function(t){return!e.includes(t.spot)})),this.lazySpots.length||this.stopService())},e.prototype.getThresholdLocation=function(e){return e.offsetTop-o.Utils.getScreenSize().h*this.generalLazyConfig.threshold},e.prototype.stopService=function(e){this.logger.info("stopping service"),a.default.get().removeListener("scroll",window.top,this.lazySpotsListener),this.userPositionInterval&&clearInterval(this.userPositionInterval),this.serviceActive=!1,e||(this.lazyStatus=this.getLazyStatus(!0),this.fetchChecking())},e.prototype.startService=function(){this.logger.info("starting service"),this.lazyStatus=this.getLazyStatus(!0),a.default.get().listen("scroll",window.top,this.lazySpotsListener),this.startUserPositionInterval(),this.serviceActive=!0},e.prototype.getLazyStatus=function(e){var t=o.Utils.getScrollPosition().bottom,i=Date.now(),n=e?0:t-this.lazyStatus.lastPosition,r=e?0:i-this.lazyStatus.previousTime,s=e||this.lazyStatus.lastPosition<=t?"down":"up",a=this.fetchTime/r;return{scrollDirection:s,expectedNextPosition:0===r?t:t+n*a,previousTime:i,lastPosition:t,positionListenerActive:!e&&this.lazyStatus.positionListenerActive}},e.prototype.checkLocationAndFetch=function(){this.lazyStatus.positionListenerActive||this.startUserPositionInterval(),this.fetchChecking()},e.prototype.startUserPositionInterval=function(){var e=this;this.lazyStatus=this.getLazyStatus(),this.lazyStatus.positionListenerActive||(this.userPositionInterval=setInterval((function(){if(e.lazyStatus=e.getLazyStatus(),e.logger.debug("direction: ",e.lazyStatus.scrollDirection.toString(),"at ",o.Utils.getScrollPosition().bottom.toFixed(2),"spots threshold: ",e.lazySpotsLocations),e.noMovement()&&!e.postMovementTimeoutActive){var t=e.lazyStatus.lastPosition;setTimeout((function(){e.postMovementTimeoutActive=!1,t===e.lazyStatus.lastPosition&&(e.userPositionInterval&&clearInterval(e.userPositionInterval),e.generalLazyConfig.staticUser&&e.fetchChecking(!0),e.lazyStatus.positionListenerActive=!1,e.logger.debug("positionInterval stopped, static user"))}),500),e.postMovementTimeoutActive=!0}}),100)),this.lazyStatus.positionListenerActive=!0,this.logger.debug("positionInterval started")},e.prototype.noMovement=function(){return this.lazyStatus.lastPosition===this.lazyStatus.expectedNextPosition},e.prototype.fetchChecking=function(e){var t=this;if("down"===this.lazyStatus.scrollDirection)for(var i=0,n=this.lazySpots;i<n.length;i++){var o=n[i];if(this.isSpotMissed(o.spot))this.handleAdRequestBlock(o.spot),this.zeroApprovalsCount(o);else if(this.isUserInThreshold(o)){if(this.logger.debug("user in threshold of "+o.spot.type+" spot "+o.spot.typeIndex,this.lazyStatus.lastPosition,o.spot.ref),this.isExpectedNextPositionOk(o)){if(o.approvalsCount++,this.approvalsTargetReached(o)||e){this.logger.info(o.spot.type+" spot "+o.spot.typeIndex+" is good for fetching ,"+o.approvalsCount+" /"+this.generalLazyConfig.approvalCount),o.fetchCallback();var r=this.lazySpots.indexOf(o);r>-1&&this.lazySpots.splice(r,1),this.lazySpots.length||this.stopService()}break}this.zeroApprovalsCount(o)}else this.zeroApprovalsCount(o)}else this.lazySpots.forEach((function(e){return t.zeroApprovalsCount(e)}))},e.prototype.isSpotMissed=function(e){return o.Utils.getElementPosition(e.ref).top<=this.lazyStatus.lastPosition},e.prototype.handleAdRequestBlock=function(e){e.adRequestBlockedSent||(this.logger.debug(e.type+" spot "+e.typeIndex+" at position "+o.Utils.getElementPosition(e.ref).top+" missed, current position: "+o.Utils.getScrollPosition().bottom),s.EventsService.get().sendAdBlockedEvent(e,[{reason:"lazy_ad_missed",message:""+o.Utils.getCurrentFoldDecimal()}]))},e.prototype.zeroApprovalsCount=function(e){e.approvalsCount>0&&this.logger.debug("approval count reset"),e.approvalsCount=0},e.prototype.isUserInThreshold=function(e){var t=o.Utils.getElementPosition(e.spot.ref).top;return this.lazyStatus.lastPosition<t&&this.lazyStatus.lastPosition>e.thresholdLocation},e.prototype.isExpectedNextPositionOk=function(e){return this.lazyStatus.expectedNextPosition<o.Utils.getElementPosition(e.spot.ref).top},e.prototype.approvalsTargetReached=function(e){return this.logger.debug("approval count is now "+e.approvalsCount+" and approvalsCountTarget is "+this.generalLazyConfig.approvalCount,e.spot.ref),e.approvalsCount>=this.generalLazyConfig.approvalCount},e}();t.default=p},function(e,t,i){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__spreadArrays||function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<i;t++)for(var r=arguments[t],s=0,a=r.length;s<a;s++,o++)n[o]=r[s];return n};Object.defineProperty(t,"__esModule",{value:!0});var r=i(1),s=i(0),a=i(3),l=i(42),d=i(2),p=i(10),c=i(4),u=i(11),f=i(43),h=i(7),g=i(13),m=i(17),y=i(5),v=i(9),S=i(55),b=i(58),w=i(59),T=-1,E=0,A=600,I=100,P=200,_=300,C=400,D=700,O=800,F=function(){function e(){this.firstScanSpots=[],this.adIndexLimit=99,this.logger=new s.Logger("SpotEngine"),this.profile=d.Profiler.get(),this.availableSpots=[],this.spotsFromPreviousPageview=[],this.lastScannedElement=null,this.firstScannedElement=null,this.isMenuPositionFixed=!1,this.spotsStrategy=new l.DefaultSpotsStrategy,this.currentSpotType=c.SpotType.DYNAMIC_MC,this.spotsBeforeDcs=[],this.typesScannedBeforeDcs=[],this.apiSpots=[],this.profile.debugMode&&(this.profile.spotEngineTest={}),this.endlessRails={}}return Object.defineProperty(e,"instance",{get:function(){return this._instance||(this._instance=new e),this._instance},enumerable:!1,configurable:!0}),e.prototype.findSpots=function(t,i,n,o){var s,l,d,p,f,g=this;void 0===i&&(i=this.sendPageViewEvent.bind(this));var m=h.DcsUtils.getDcsType(),v=!!m;if(v&&(t=t.filter((function(e){return!y.SpotsUtils.getTypesToDisableOnDcs(m).includes(e.oldType)&&!g.typesScannedBeforeDcs.includes(e.oldType)})),"end_less"===m)){var S=h.DcsUtils.getCurrentDcsElement();this.endlessRails={element:h.DcsUtils.getCurrentDcsElement(),top:r.Utils.getElementCoordinates(S).top}}var b=t.filter((function(e){return y.SpotsUtils.isFixedSpot(e.oldType)})),w=[],T=[],E=[],A=[];b.length&&(w=this.scanFixedSpots(v,b,!n),(s=this.availableSpots).push.apply(s,w));var I=t.map((function(e){return e.oldType}));if(I.includes(c.SpotType.DYNAMIC_MC)){T=this.scanDynamicSpots(v),(l=this.availableSpots).push.apply(l,T);var P=y.SpotsUtils.getConf(c.SPOT_TAGS_MAP[c.SpotType.DYNAMIC_MC]),_=(null==P?void 0:P.maxItems)||0;this.logger.custom("Dynamic spots found: "+T.length,r.Utils.getLogStyle(18,"black","green"),T),this.logger.custom("Dynamic max items: "+_+" | potential spots: "+_,r.Utils.getLogStyle(16,"black","green"))}var C=t.filter((function(e){return y.DYNAMIC_RAIL_TYPES.includes(e.oldType)}));C.length&&(E=this.scanDynamicRailsSpots(C),(d=this.availableSpots).push.apply(d,E)),I.includes(c.SpotType.STICKY)&&(A=this.scanForSticky(v)),this.availableSpots=[];var D=this.setAdIndexesByColumn(T,w,E,A);for(var O in D)D.hasOwnProperty(O)&&(p=this.availableSpots).push.apply(p,D[O].spots);return this.availableSpots.forEach((function(e){e.type!==c.SpotType.STICKY&&(u.default.isLazyConfiguredForSpotType(e)&&(e.isLazyLoading=u.default.get().isLazy(e)),a.EventsService.get().sendSpotFoundEvent(e),g.logger.info("Found "+e.type+" spot",e.ref))})),n?((f=this.firstScanSpots).push.apply(f,w),this.availableSpots=[],w.filter((function(e){return!g.spotsFromPreviousPageview.includes(e)}))):(v&&this.handleSpotsFromPreviousPageview(),o||(i(e._instance),a.EventsService.get().sendSpotEngineDoneEvent(),this.profile.debugMode&&(this.buildSpotEngineTest(),this.profile.state="done")),this.availableSpots.filter((function(e){return!g.spotsFromPreviousPageview.includes(e)})))},e.prototype.setAdIndexesByColumn=function(e,t,i,n){var o=this,s={topSpots:{spots:r.Utils.sortSpotsByPosition.apply(r.Utils,t.filter((function(e){return e.type===c.SpotType.FIXED_TOP}))),startIndex:I},dynamicInContentSpots:{spots:r.Utils.sortSpotsByPosition.apply(r.Utils,e),startIndex:E},fixedInContentSpots:{spots:r.Utils.sortSpotsByPosition.apply(r.Utils,t.filter((function(e){return e.type===c.SpotType.FIXED_MC}))),startIndex:A},bottomSpots:{spots:r.Utils.sortSpotsByPosition.apply(r.Utils,t.filter((function(e){return e.type===c.SpotType.FIXED_BOTTOM}))),startIndex:P},dynamicRightRailSpots:{spots:r.Utils.sortSpotsByPosition.apply(r.Utils,i.filter((function(e){return e.type===c.SpotType.DYNAMIC_RIGHT_RAIL}))),startIndex:_},dynamicLeftRailSpots:{spots:r.Utils.sortSpotsByPosition.apply(r.Utils,i.filter((function(e){return e.type===c.SpotType.DYNAMIC_LEFT_RAIL}))),startIndex:C},fixedRightRailSpots:{spots:r.Utils.sortSpotsByPosition.apply(r.Utils,t.filter((function(e){return e.type===c.SpotType.FIXED_RIGHT_RAIL}))),startIndex:D},fixedLeftRailSpots:{spots:r.Utils.sortSpotsByPosition.apply(r.Utils,t.filter((function(e){return e.type===c.SpotType.FIXED_LEFT_RAIL}))),startIndex:O},stickySpots:{spots:n,startIndex:T}},a=this.firstScanSpots.filter((function(e){return y.SpotsUtils.getRailsTypes().includes(e.type)})).length,l=function(e){if(s.hasOwnProperty(e)){var t=s[e].spots,i=s[e].startIndex;t.forEach((function(e,t){var n=Math.min(t,o.adIndexLimit);e.adIndex=i+n,y.SpotsUtils.getRailsTypes().includes(e.type)&&(e.demandIndex=n+a)}))}};for(var d in s)l(d);return s},e.prototype.scanBeforeDcs=function(){var e=y.SpotsUtils.getTagsToScanBeforeDcs(),t=e.map((function(e){return e.oldType}));this.logger.info("scan for spots before DCS",t),this.spotsBeforeDcs=this.findSpots(e,(function(){}),!0),this.typesScannedBeforeDcs=t,this.availableSpots=[],m.YieldClient.get().handleSpots(this.spotsBeforeDcs)},e.prototype.sendPageViewEvent=function(){var e=this.getSpotsByType(c.SpotType.FIXED_BOTTOM).length+this.getSpotsByType(c.SpotType.FIXED_TOP).length;a.EventsService.get().sendPageviewEvent(this.getSpotsByType(c.SpotType.DYNAMIC_MC).length,this.getSpotsByType(c.SpotType.FIXED_MC).length,this.getSpotsByType(c.SpotType.STICKY).length,e,this.getRightRailsSpotsFound().length,this.getLeftRailsSpotsFound().length)},e.prototype.scanFixedSpots=function(e,t,i){var n=this;this.logger.info("Scanning for fixed spots... extra validation: "+i);var o=[];return t.forEach((function(t){var s=y.SpotsUtils.getConf(t);if(s){for(var a=s.maxSpots,l=s.elements,d=s.allowedCreativeSizes,p=function(l){if(i){if(!y.SpotsUtils.getRailsTypes().includes(t.oldType)&&n.isStopInFoldViolated(l,s.stopInFold))return n.logger.debug("invalid spot [below stop in fold]:",l),"continue";if("invalid"===n.validateSpot(l,!0,t,s).status)return"continue"}var p=r.Utils.clone(d).filter((function(e){return!n.isCompSizeBiggerThanParentSize(e,l)})),u=n.getCompatibleAdsSizes(l,0,t.oldType,p,!0);if(i&&"invalid"===n.validateStayAway(l,o,u,t.oldType===c.SpotType.FIXED_MC,t).status)return"continue";if(u.length>0){var f=o.filter((function(e){return e.type===t.oldType})).length,h=new b.FixedSpot(l,f,u,0,t.oldType,e);n.logger.info("New",t.oldType," spot found: ",h.ref),o.push(h)}else n.logger.debug("invalid fixed spot [no compatible size found]:",l);return o.filter((function(e){return e.type===t.oldType})).length>=a?"break":void 0},u=0,f=l;u<f.length;u++){if("break"===p(f[u]))break}n.logger.custom(t.oldType+" spots found: "+o.filter((function(e){return e.type===t.oldType})).length,r.Utils.getLogStyle(18,"black","green")),n.logger.custom(t.oldType+" max items: "+Math.min(a,s.maxItems)+" | potential spots: "+s.maxSpots,r.Utils.getLogStyle(16,"black","green"))}})),o},e.prototype.scanDynamicSpots=function(e){var t=this;this.logger.info("Scanning for dynamic spots...");var i=[];if(!this.profile.domData)return i;var n=y.SpotsUtils.getConf(c.SPOT_TAGS_MAP[c.SpotType.DYNAMIC_MC]);if(n)for(var o=function(o){var a;if(s.isAlreadyWrapped(i,o))return"continue";if(s.spotsStrategy.stopScanning(i))return s.lastScannedElement=o.previousElementSibling,"break";if(s.isStopInFoldViolated(o,n.stopInFold))return s.lastScannedElement=o.previousElementSibling,s.logger.debug("SpotEngine Stopped. StopIF = "+n.stopInFold+", reached element at fold "+r.Utils.getElementFoldNumber(o)+": ",o),"break";if("invalid"===s.validateSpot(o,!1,c.SPOT_TAGS_MAP[c.SpotType.DYNAMIC_MC],n).status)return"continue";var l=r.Utils.sortByHeight(r.Utils.clone(n.allowedCreativeSizes)).filter((function(e){return!t.isCompSizeBiggerThanParentSize(e,o)})),d=[],p=s.getNextParagraphsTotalHeight(o,s.profile.spotEngineConfig.wrappingAdditionalElements,l,d),u=s.getCompatibleAdsSizes(o,p,c.SpotType.DYNAMIC_MC,l);if("invalid"===s.validateStayAway(o,i,u,!0,c.SPOT_TAGS_MAP[c.SpotType.DYNAMIC_MC]).status)return"continue";if(s.hasValidDynamicSizes(u)){var f=new S.DynamicSpot(o,c.SpotType.DYNAMIC_MC,i.length,u,p,e);s.logger.info("New dynamic spot found: ",f.ref),(a=f.wrappedElements).push.apply(a,d),i.push(f)}else s.logger.debug("invalid dynamic spot [no compatible size found]:",o)},s=this,a=0,l=n.elements;a<l.length;a++){if("break"===o(l[a]))break}return this.logger.info("Spots found before filtering: ",i),this.spotsStrategy.selectSpots(i)},e.prototype.scanDynamicRailsSpots=function(e){var t=this;if(this.logger.info("Scanning for dynamic rails spots..."),!e.length)return[];var i=[];return e.forEach((function(e){for(var n=y.SpotsUtils.getConf(e),o=n.maxSpots,s=function(s){if(t.isAlreadyWrapped(i,s))return"continue";if("invalid"===t.validateSpot(s,!1,e,n).status)return"continue";var a=r.Utils.clone(n.allowedCreativeSizes).filter((function(e){return!t.isCompSizeBiggerThanParentSize(e,s)})),l=t.getCompatibleAdsSizes(s,0,e.oldType,a);if("invalid"===t.validateStayAway(s,i,l,!1,e).status)return"continue";if(t.hasValidDynamicSizes(l)){var d=new S.DynamicSpot(s,e.oldType,i.filter((function(t){return t.type===e.oldType})).length,l,0,!1);t.logger.info("New "+e.oldType+" spot found: ",d.ref),i.push(d)}else t.logger.debug("invalid "+e.oldType+" spot [no compatible size found]:",s);return i.filter((function(t){return t.type===e.oldType})).length>=o?"break":void 0},a=0,l=n.elements;a<l.length;a++){if("break"===s(l[a]))break}t.logger.custom(e.oldType+" spots found: "+i.filter((function(t){return t.type===e.oldType})).length,r.Utils.getLogStyle(18,"black","green")),t.logger.custom(e.oldType+" max items: "+Math.min(o,n.maxItems)+" | potential spots: "+n.maxSpots,r.Utils.getLogStyle(16,"black","green"))})),i},e.prototype.scanForSticky=function(e){if(!r.Utils.isStickyActive())return[];if(this.isStickyApiIdsConfigured())return this.logger.info("Sticky spot in invalid because Sticky Api spot is already defined"),[];if(this.stickyFoundOnPage())return this.logger.info("Sticky spot in invalid because of publisher sticky ad"),[];var t=new w.StickySpot(this.getStickyCompatibleAdsSizes(),e);return a.EventsService.get().sendSpotFoundEvent(t),this.logger.info("Found "+c.SpotType.STICKY+" spot"),m.YieldClient.get().stickyDemandRequest(t),[t]},e.prototype.isAlreadyWrapped=function(e,t){return e.some((function(e){return e.wrappedElements.map((function(e){return e.el})).includes(t)}))},e.prototype.stickyFoundOnPage=function(){return g.default.get().foundAds.some((function(e){return e.positionType.indexOf("sticky")>-1}))},e.prototype.hasValidDynamicSizes=function(e){return e.filter((function(e){return!r.Utils.is1x1(e)})).length>0},e.prototype.isSkippedElement=function(e){return this.profile.domData&&this.profile.domData.skippedElements.some((function(t){return r.Utils.isDescendantElement([t],e)&&y.SpotsUtils.isValidHeightForSkipSa(e)}))?{status:"invalid",message:"skipped element"}:{status:"valid"}},e.prototype.isBrowsiStayAway=function(e,t,i,n){if(y.SpotsUtils.isFixedSpot(n.oldType))return{status:"valid"};if(this.hasFoundSpots(t)){var o=this.getSpotsByColumn(t,n.oldType);return o.length&&o.some((function(t){if(t.ref===e)return{status:"invalid",message:"stay_away_from_browsi"};var o=r.Utils.calculateDistanceBetween(e,t.ref),s=r.Utils.getHighestElement(e,t.ref),a=e===s?i:t.compatibleSizes,l=r.Utils.getMaxWrapSize(a),d=r.Utils.getWrappingOffset(e,t.ref,l);return o+s.getBoundingClientRect().height+d<=y.SpotsUtils.getBrowsiAdsStayAwayDistance(n)}))?{status:"invalid",message:"stay_away_from_browsi"}:{status:"valid"}}return{status:"valid"}},e.prototype.isInsideSkippedRef=function(e,t){var i,n;if("INSIDE"===y.SpotsUtils.getTargetElementPosition(t)){var o=null===(n=null===(i=this.profile)||void 0===i?void 0:i.domData)||void 0===n?void 0:n.skippedElements;return o&&o.includes(e)?{status:"invalid",message:"skipped element"}:{status:"valid"}}return{status:"valid"}},e.prototype.getSpotsByColumn=function(e,t){var i=e.filter((function(e){return e.type===t}));switch(t){case c.SpotType.DYNAMIC_LEFT_RAIL:i=i.concat(this.getSpotsByType(c.SpotType.FIXED_LEFT_RAIL));break;case c.SpotType.DYNAMIC_RIGHT_RAIL:i=i.concat(this.getSpotsByType(c.SpotType.FIXED_RIGHT_RAIL));break;case c.SpotType.DYNAMIC_MC:i=i.concat(this.getSpotsByType(c.SpotType.FIXED_MC).filter((function(e){return e.positionTypes.includes("in-line")})))}return i},e.prototype.hasFoundSpots=function(e){return!!(e.length>0||this.availableSpots.length>0)},e.prototype.isAboveStartInFold=function(e,t){var i=r.Utils.getElementFoldNumber(e);return t&&i<t?{status:"invalid",message:"above startIF("+i+")"}:(this.firstScannedElement||(this.firstScannedElement=e),{status:"valid"})},e.prototype.isStopInFoldViolated=function(e,t){var i=r.Utils.getElementFoldNumber(e);if(t&&t>0)if(t===Math.floor(t)){if(Math.floor(i)>t)return!0}else if(i>t)return!0;return!1},e.prototype.getNextParagraphsTotalHeight=function(e,t,i,n){var o=0,s=r.Utils.getMaxWrapSize(i),a=0;if(!s)return o;for(;e&&o<s.h&&(!r.Utils.isElement(e)||"valid"===this.isSkippedElement(e).status&&"valid"===p.default.instance.isStayAwayElement(e,!0,c.SpotType.DYNAMIC_MC).status);){if(r.Utils.isElement(e)){if(["auto","hidden","overlay","scroll"].includes(getComputedStyle(e).overflow||""))return this.logger.debug("Stopped height calc. overflow: "+getComputedStyle(e).overflow+". current height: "+o,e),o;!r.Utils.isVisible(e)&&o>0&&e.nextSibling&&(e=e.nextSibling)}switch(e.nodeName){case"BR":break;case"P":if(this.hasNonWrappingChildren(e))return o;r.Utils.isEmptyParagraph(e)?a+=e.getBoundingClientRect().height:(o+=e.getBoundingClientRect().height+a,a=0);break;case"#text":e.nodeValue&&e.nodeValue.length>1?(o+=r.Utils.calculateTextNodeHeight(e)+a,a=0):a+=r.Utils.calculateTextNodeHeight(e);break;default:if(t.includes(e.nodeName)&&!this.hasNonWrappingChildren(e)){o+=e.getBoundingClientRect().height+a,a=0;break}return o}var l=i.find((function(e){return e.h>=o}))||s;n.push({el:e,minWrapSize:l}),e=e.nextSibling}return o},e.prototype.hasNonWrappingChildren=function(e){var t=e.querySelector("img, iframe");return!!t&&(this.logger.info("stopping height calc because "+e.nodeName+" element has special child: ",t),!0)},e.prototype.getCompatibleAdsSizes=function(e,t,i,n,o){var r=[];if(!this.profile.domData&&!o)return r;for(var s=i===c.SpotType.DYNAMIC_MC&&this.isAfterOneLine(e),a=e.getBoundingClientRect().height,l=0,d=n;l<d.length;l++){var p=d[l],u=i===c.SpotType.DYNAMIC_MC?p.optionalEmbeddings.indexOf("wrapped"):-1;if(u>-1?this.isSizeValidForWrapping(t,a,p)||p.optionalEmbeddings.splice(u,1):(y.SpotsUtils.isFixedSpot(i)||y.DYNAMIC_RAIL_TYPES.includes(i))&&(p.selectedEmbedding="break"),s){var f=p.optionalEmbeddings.indexOf("break");f>-1&&(p.optionalEmbeddings.splice(f,1),this.logger.debug(e,"is after one liner, only wrap allowed"))}p.optionalEmbeddings.length&&r.push(p)}return r},e.prototype.getStickyCompatibleAdsSizes=function(){for(var e,t=[],i=0,n=(null===(e=y.SpotsUtils.getConf(c.SPOT_TAGS_MAP[c.SpotType.STICKY]))||void 0===e?void 0:e.allowedCreativeSizes)||[];i<n.length;i++){var o=n[i];if(r.Utils.isValidStickySize(o)){var s={w:o.w,h:o.h,selectedEmbedding:"break",optionalEmbeddings:[],adSizeType:"wide",minSizeForWrapping:-1};t.push(s)}}return t},e.prototype.isSizeValidForWrapping=function(e,t,i){return t>=i.minSizeForWrapping&&e>0||e>=i.minSizeForWrapping},e.prototype.buildSpotEngineTest=function(){if(this.lastScannedElement&&this.firstScannedElement){var e=r.Utils.getElementFoldNumber(this.lastScannedElement),t=r.Utils.getElementFoldNumber(this.firstScannedElement);this.profile.spotEngineTest={firstElementFold:t,lastElementFold:e,spots:this.mapSpotEngineTestSpots(this.availableSpots)}}else this.profile.spotEngineTest={spots:this.mapSpotEngineTestSpots(this.availableSpots)}},e.prototype.mapSpotEngineTestSpots=function(e){var t=[];return e.forEach((function(e){return t[e.adIndex]=e.serialize()})),t},e.prototype.validateSpot=function(e,t,i,n){var o=!this.shouldIgnoreStartInFold(i.oldType)&&this.isAboveStartInFold(e,n.startInFold).message||this.endlessRailsInvalid(e,i.oldType).message||(t?this.isInsideSkippedRef(e,i).message:this.isSkippedElement(e).message||this.isEmptyParagraph(e).message||(y.SpotsUtils.isRailSpot(i.oldType)?null:this.isElementWithFloatSibling(e).message||this.isBetweenTitleAndContent(e).message)),r=o?{status:"invalid",message:o}:{status:"valid"};return"invalid"===r.status&&this.logger.debug("invalid spot ["+r.message+"]:",e),r},e.prototype.endlessRailsInvalid=function(e,t){return this.endlessRails.top&&y.SpotsUtils.getRailsTypes().includes(t)&&r.Utils.getElementCoordinates(e).top<this.endlessRails.top?{status:"invalid",message:"above dcs element"}:{status:"valid"}},e.prototype.shouldIgnoreStartInFold=function(e){return o([c.SpotType.FIXED_TOP,c.SpotType.FIXED_BOTTOM],y.SpotsUtils.getRailsTypes()).includes(e)},e.prototype.isEmptyParagraph=function(e){return r.Utils.isEmptyParagraph(e)?{status:"invalid",message:"empty"}:{status:"valid"}},e.prototype.isCompSizeBiggerThanParentSize=function(e,t){var i=!1;if(t.parentElement){var n=r.Utils.getElementSize(t.parentElement);n&&e.w>n.w&&(i=!0)}return i},e.prototype.validateStayAway=function(e,t,i,n,o){var r=p.default.instance.isStayAwayForAllEmbedTypes(e,i,n,o.oldType),s=("valid"===r.status?this.isBrowsiStayAway(e,t,i,o):null)||r;if("invalid"===s.status){var a=s.element?{element:e,stayAwayElement:r.element}:"";this.logger.debug("invalid spot ["+s.message+"]",a)}return s},e.prototype.isElementWithFloatSibling=function(e){return this.profile.domData&&this.profile.domData.foundFloatElements.includes(e)?{status:"invalid",message:"element with float sibling"}:{status:"valid"}},e.prototype.isBetweenTitleAndContent=function(e){return this.profile.spotEngineConfig.pageLayoutSA&&f.default.get().isBetweenTitleAndContent(e)?{status:"invalid",message:"element is between title and content"}:{status:"valid"}},e.prototype.isAfterOneLine=function(e){return!!this.profile.spotEngineConfig.pageLayoutSA&&f.default.get().isAfterOneLiner(e)},e.prototype.isStickyApiIdsConfigured=function(){var e=y.SpotsUtils.getConf({typeTag:v.TypeTag.API,positionTag:"s",oldType:c.SpotType.API});return!(!e||!e.positionIds)},e.prototype.getAvailableSpots=function(){return this.availableSpots},e.prototype.getApiSpots=function(){return this.apiSpots},e.prototype.getDcsSerializedSpot=function(e){return n(n({browsiAd:e.browsiAd,slot:e.slot},e.selectedSize?{selectedSize:e.selectedSize}:{}),{adIndex:e.adIndex,demandIndex:e.demandIndex,type:e.type,ref:e.ref,compatibleSizes:e.compatibleSizes,positionTypes:e.positionTypes,spotTags:e.tags})},e.prototype.handleSpotsFromPreviousPageview=function(){var e=this,t=h.DcsUtils.getWindowObject(),i=t&&t.spots;i&&i.length&&i.forEach((function(t){var i;(i="s"===t.spotTags.positionTag?new w.StickySpot(t.compatibleSizes,!0):t.spotTags.typeTag===v.TypeTag.FIXED?new b.FixedSpot(t.ref,t.demandIndex,t.compatibleSizes,-1,t.type,!0):new S.DynamicSpot(t.ref,t.type,t.demandIndex,t.compatibleSizes,-1,!0)).isLazyLoading=!1,i=Object.assign(i,t),e.logger.info("Found "+i.type+" spot from previous page view: ",i),a.EventsService.get().sendSpotFoundEvent(i),e.availableSpots.push(i),e.spotsFromPreviousPageview.push(i),i.refreshDcsSpotOnNewPv()}))},e.prototype.getRightRailsSpotsFound=function(){return this.getSpotsByType(c.SpotType.DYNAMIC_RIGHT_RAIL).concat(this.getSpotsByType(c.SpotType.FIXED_RIGHT_RAIL))},e.prototype.getLeftRailsSpotsFound=function(){return this.getSpotsByType(c.SpotType.DYNAMIC_LEFT_RAIL).concat(this.getSpotsByType(c.SpotType.FIXED_LEFT_RAIL))},e.prototype.getSpotsByType=function(e){return this.availableSpots.filter((function(t){return t.type===e})).concat(this.firstScanSpots.filter((function(t){return t.type===e})))},e.prototype.getFoundSpots=function(){return{fixedFirst:this.firstScanSpots,availableSpots:this.availableSpots}},e}();t.default=F},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),o=i(29),r=i(1),s=i(2),a=i(3),l=i(18),d=i(14),p=i(10),c=i(28),u=i(32),f=i(26),h=i(33),g=i(7),m=i(25),y=function(){function e(){this._foundAds=[],this.logger=new n.Logger("ProvidersDetector"),this._foundAds=[],this.profile=s.Profiler.get(),this.handlePreviousPageViewAds()}return e.get=function(){return this.instance||(this.instance=new e),this.instance},Object.defineProperty(e.prototype,"foundAds",{get:function(){return this._foundAds},enumerable:!1,configurable:!0}),e.prototype.addIfNew=function(e,t,i,n){var o=e.element;if(!(!n&&this.isDetectedAlready(o)||d.Embedder.isEmbeddedByBrowsi(o))){var s=r.Utils.getElementPosition(o).top,p=this.resolveElementSize(o,i),c=this.getAdPositionType(o),f=-1!=c.indexOf("sticky")||-1!=c.indexOf("interstitial")?-1:r.Utils.getElementFoldNumber(o),g=0;if(n){var y=this._foundAds.find((function(e){return e.element===o}));y&&(g=++y.refreshCount)}var v={providerName:e.providerName,positionType:c,element:o,topPos:s,foldNum:f,width:p.w,height:p.h,placementId:e.placementId,adUnit:e.adUnit,isLazyLoaded:e.isLazyLoaded,refreshCount:g,refreshType:n},S=u.default.get().getFoundPublisherAdData(v.providerName,"manual_ad"===v.providerName?o.id:e.placementId,v.refreshCount,t);v=this.updateFoundAdFromBptData(v,S),this.foundAds.push(v),this.logger.info("Found provider on page: "+e.providerName+"("+p.w+"x"+p.h+")",o),new h.ClickTracker(o,{refreshCount:v.refreshCount,isBrowsiAd:!1,placementId:v.placementId});var b=r.Utils.getBlockRefreshList(t);return a.EventsService.get().sendPublisherAdFound(v,S,b),l.ViewabilityService.get().subscribe(this.buildViewabilityServiceObject(v,i,t)),"dfp"===v.providerName&&t&&m.default.get().waitForPublisherAV(t,v),c}},e.prototype.updateFoundAdFromBptData=function(e,t){return e.placementId=t.plid,"manual_ad"===e.providerName&&(e.adUnit=t.plid),e},e.prototype.buildViewabilityServiceObject=function(e,t,i){var n=t&&t.w*t.h>=242500?30:50,o={type:l.ViewabilityObjectType.PUBLISHER_AD,conf:{minViewInitiator:n,duration:1e3},getCoords:function(){return r.Utils.getElementPosition(e.element)},getHeight:function(){return r.Utils.getElementSize(e.element).h},metrics:{duration:-1,startTime:null,viewed:!1},runCondition:function(){return!0},refreshInfo:{shouldRefresh:!1,rate:0,doRefresh:function(){}},sendViewedImpression:function(t){return a.EventsService.get().sendViewedPublisherAd(e,t)},root:function(){return e}},s=f.PubAdsRefreshService.get();return i&&s&&Object.assign(o,{refreshInfo:s.getViewabilityRefreshInfo(e,o,i)}),o},e.prototype.getAdPositionType=function(e){var t=[],i=r.Utils.getElementSize(e),n=r.Utils.getElementPosition(e);if(r.Utils.isPositionFixed(e)&&i.w>.85*this.profile.deviceDetails.screenWidth&&i.h>.85*this.profile.deviceDetails.screenHeight)return t.push("interstitial"),t;if(r.Utils.isPositionFixed(e)&&t.push("sticky"),this.profile.domData&&this.profile.domData.mainContent.inputElements&&this.profile.domData.mainContent.start>-1){for(var o=this.profile.domData.mainContent,s=o.inputElements[0].getBoundingClientRect().width,a=r.Utils.getElementPosition(o.inputElements[0]).left,l=0,d=n.left,p=d+i.w,c=n.top,u=0;u<o.inputElements.length;u++)a=Math.min(a,r.Utils.getElementPosition(o.inputElements[u]).left),l=Math.max(l,a+s);this.logger.debug("MC start: "+o.start+",MC end: "+o.endPosition+",\n\t\t\tarticle offset left: "+a+", article offset right "+l+",ad offset right "+p+",\n\t\t\tad offset left "+d+", ad offset top "+c+", MC elements:",o.inputElements),d>=a&&p<=l?t.push("in-line"):(d<a&&p<=a&&t.push("left rail"),d>=l&&t.push("right rail")),-1==t.indexOf("sticky")&&(c<o.start&&t.push("top"),c>o.endPosition&&t.push("bottom")),-1!=t.indexOf("in-line")&&-1==t.indexOf("sticky")&&-1==t.indexOf("bottom")&&-1==t.indexOf("top")&&t.push("within main content"),0===t.length&&c>=o.start&&c<=o.endPosition&&t.push("within main content")}else t.push("out of main content");return t},e.prototype.scan=function(e){return e&&o.default.start(),this.foundAds},e.prototype.addFoundProvider=function(e,t,i,n){var o=this.addIfNew(e,t,i,n);if(o){var r=this.buildSaObject(e,o);p.default.instance.upsertStayAwayElement(e.element,r,e.isLazyLoaded)}return!!o},e.prototype.buildSaObject=function(e,t){var i,n="dfp"===e.providerName?this.getMinDistance(t):(null===(i=s.Profiler.get().layouts.spots.dynamic)||void 0===i?void 0:i.distance)||0;return{config:{d:n,v:["pubAd"],t:this.buildStayAwayTargetByAdPosition(t)},sa:{element:e.element,distance:n,selector:"pubAd"}}},e.prototype.getMinDistance=function(e){var t=e.includes("right rail")||e.includes("left rail"),i=s.Profiler.get().spotEngineConfig.railsPublisherAdsMinDistance;return t&&"number"==typeof i?i:s.Profiler.get().spotEngineConfig.publisherAdsMinDistance},e.prototype.buildStayAwayTargetByAdPosition=function(e){var t=[],i=["bottom","top","within main content"];return e.some((function(e){return i.includes(e)}))&&t.push(c.SATargets.TOP,c.SATargets.BOTTOM,c.SATargets.MC),e.includes("right rail")&&t.push(c.SATargets.RIGHT),e.includes("left rail")&&t.push(c.SATargets.LEFT),t},e.prototype.isDetectedAlready=function(e){return!!this.foundAds.some((function(t){return t.element===e}))||(!!r.Utils.isDescendantElement(this.foundAds.map((function(e){return e.element})),e)||this.foundAds.some((function(t){return r.Utils.isDescendantElement([e],t.element)})))},e.prototype.resolveElementSize=function(e,t){if(t)return t;var i=e.getBoundingClientRect();return{w:i.width,h:i.height}},e.prototype.handlePreviousPageViewAds=function(){var e=g.DcsUtils.getWindowObject();e&&e._pubads&&e._pubads.length&&e._pubads.forEach((function(e){new h.ClickTracker(e.element,{refreshCount:e.refreshCount,isBrowsiAd:!1,placementId:e.placementId})}))},e}();t.default=y},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Embedder=void 0;var n=i(1),o=i(2),r=i(0),s=i(7),a=i(4),l=i(23),d=i(6),p=i(5),c=i(3),u=i(18),f=function(){function e(t){var i=t.getIdentifier();this.wrapperId=e.wrapperIdPrefix+"_"+i,this.containerId=e.containerIdPrefix+"_"+i,this.profile=o.Profiler.get();var n=s.DcsUtils.getWindowObject();n&&(this.wrapperId+="_dcs_"+n.count,this.containerId+="_dcs_"+n.count),t.setDomId(this.wrapperId)}return e.prototype.appendAd=function(e,t){if(e.isRefreshing()||e.removeAdFromDom(),e.type===a.SpotType.STICKY)this.appendStickyAd(t);else if(e.ref.parentNode){if(e.tableConfiguration){var i=e.tableConfiguration.mainTd.cloneNode();i.appendChild(t),e.ref.parentNode.insertBefore(i,e.ref)}else switch(e.targetElementPosition){case"ABOVE":e.ref.insertAdjacentElement("beforebegin",t);break;case"INSIDE":e.ref.insertAdjacentElement("afterbegin",t)}n.Utils.reportNewBrowsiAd(t)}this.runPostEmbedHook(e,t)},e.prototype.runPostEmbedHook=function(e,t){var i=n.Utils.getExternalFlowHandler("postEmbed");i&&(d.ResponseTimeCollector.get().setRuleBySpot("postEmbed",e,!0),i(e,t),d.ResponseTimeCollector.get().setRuleBySpot("postEmbed",e,!1))},e.prototype.appendStickyAd=function(e){var t,i=window.top.document.body;(null===(t=p.SpotsUtils.getConf(a.SPOT_TAGS_MAP[a.SpotType.STICKY]))||void 0===t?void 0:t.location)===l.StickyLocation.BOTTOM?i.appendChild(e):i.insertBefore(e,i.firstElementChild),n.Utils.reportNewBrowsiAd(e)},e.isEmbeddedByBrowsi=function(t){var i=Array.from(n.Utils.getCurrentContextElement().querySelectorAll('div[id^="'+e.wrapperIdPrefix+'"]')),o=!1;return i.forEach((function(e){!o&&n.Utils.isPositionContained(e,t)&&(o=!0)})),o},e.injectMoat=function(e){var t=this;if(e.browsiAd.wrapper){var i={moatClientLevel1:e.providerName?e.providerName:"NA",moatClientLevel2:o.Profiler.get().identity.siteKey,moatClientLevel3:o.Profiler.get().deviceDetails.deviceType,moatClientLevel4:e.adIndex},r=this.moatUrl+"#"+n.Utils.toUrlParams(i);this.logger.info("injecting moat for spot "+e.adIndex),n.Utils.appendScript(r,e.browsiAd).catch((function(e){return t.logger.error("moat failed: "+r)}))}},e.addStickyCloseButton=function(t,i){var o,r=p.SpotsUtils.getConf(a.SPOT_TAGS_MAP[a.SpotType.STICKY]);if(i&&(null==r?void 0:r.closeButton)){var s=r.location,d=document.documentElement.clientWidth||n.Utils.getPageWidth(),u=(null===(o=t.selectedSize)||void 0===o?void 0:o.w)||d,f=document.createElement("c-button");f.id="close-sticky-"+t.getIdentifier(),f.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 30 30"><defs><style>.a{fill:#fff;stroke:#707070;}.b{stroke:none;}.c{fill:none;}</style></defs><g transform="translate(-1429 -929)"><g class="a" transform="translate(1429 929)"><circle class="b" cx="15" cy="15" r="15"/><circle class="c" cx="15" cy="15" r="14.5"/></g><path d="M20.518,6.563,18.955,5l-6.2,6.2L6.563,5,5,6.563l6.2,6.2L5,18.955l1.563,1.563,6.2-6.2,6.2,6.2,1.563-1.563-6.2-6.2Z" transform="translate(1430.975 930.975)"/></g></svg>',f.setAttribute("style","position: absolute;width: 24px;height: 24px;border:none; background:none;padding:0;cursor:pointer"),f.style.right=d-24<=u?"0px":"-12px",f.style[s===l.StickyLocation.BOTTOM?"top":"bottom"]="-12px",f.onclick=function(){t.isRefreshing()||(e.removeStickyAd(t),c.EventsService.get().sendStickyClosedEvent(t))},i.appendChild(f)}},e.removeStickyAd=function(e){var t,i;if(e.type===a.SpotType.STICKY){e.removeAdFromDom(),e.browsiAd&&e.slot&&(null===(i=null===(t=e.browsiAd.win)||void 0===t?void 0:t.googletag)||void 0===i||i.destroySlots([e.slot]),e.slot=void 0),u.ViewabilityService.get().unsubscribe(e);var n=window.document.body.style,o=p.SpotsUtils.getConf(a.SPOT_TAGS_MAP[a.SpotType.STICKY]);o&&o.location===l.StickyLocation.TOP?n.paddingTop="":n.paddingBottom=""}},e.prototype.setPlaceholder=function(e,t,i){if(e.placeholder&&!e.isRefreshing()){var n=e.placeholder.size;t.style.display="block",i.setAttribute("style","display:block; width:"+n.w+"px; height:"+n.h+"px; background-color:transparent;margin:auto;"),e.placeholder.openPlaceholder(e)}},e.logger=new r.Logger("Embedder"),e.wrapperIdPrefix="browsi_adWrapper",e.containerIdPrefix="browsi_adContainer",e.moatUrl="//z.moatads.com/browsidisplay14489870757/moatad.js",e}();t.Embedder=f},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Focus=void 0;var n=i(0),o=i(3),r=i(2),s=i(8),a=function(){function e(){var e=this;this.logger=new n.Logger("Focus"),this.profile=r.Profiler.get(),this.isSubscribed=!0,this.isHidden="hidden"===document.visibilityState,this.isHidden&&o.EventsService.get().sendFocusChangedEvent(!1),this.subscribe((function(t){e.onFocusChanged(t)})),this.waitForFocus=[]}return e.get=function(){return this.instance||(this.instance=new e),this.instance},e.prototype.subscribe=function(e){this.profile.debugMode&&this.listenToDemoVisibilityChange(e),s.default.get().listen("visibilitychange",document,(function(){e("hidden"===document.visibilityState)}))},e.prototype.unsubscribe=function(){return this.isSubscribed=!1,!0},e.prototype.waitForUserFocusWithAdBlock=function(e){return this.profile.spotEngineConfig.blockAdRequestOnOOF?(this.isHidden&&!e.adRequestBlockedSent&&o.EventsService.get().sendAdBlockedEvent(e,[{reason:"out_of_focus"}]),this.waitForUserFocus()):Promise.resolve()},e.prototype.waitForUserFocus=function(){var e=this;return new Promise((function(t){if(!e.isHidden)return t();e.waitForFocus.push(t)}))},e.prototype.onFocusChanged=function(e){var t=this;setTimeout((function(){var i="hidden"===document.visibilityState;if(e===i&&t.isHidden!==i){if(t.isHidden=i,!i)for(;t.waitForFocus.length;){var n=t.waitForFocus.shift();"function"==typeof n&&n()}t.logger.info("focus changed. in focus: "+!t.isHidden),o.EventsService.get().sendFocusChangedEvent(!i)}}),1e3)},e.prototype.listenToDemoVisibilityChange=function(e){var t=this;s.default.get().listen("demoVisibilityChange",document,(function(){t.isHidden=!!window._isHidden,e(t.isHidden)}))},e}();t.Focus=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConsentLocation=t.ConsentType=void 0;var n=i(1),o=i(2);!function(e){e.GDPR="gdpr",e.CCPA="ccpa"}(t.ConsentType||(t.ConsentType={})),function(e){e.EUROPE="eu",e.USA="us",e.REST_OF_WORLD="row",e.NA="NA"}(t.ConsentLocation||(t.ConsentLocation={}));var r=function(){function e(){}return Object.defineProperty(e,"hasUserConsent",{get:function(){return this.updateConsentStatus(),this.hasConsent},enumerable:!1,configurable:!0}),Object.defineProperty(e,"location",{get:function(){return"string"!=typeof this._location&&null!==this._location&&(this._location=o.Profiler.get().userAnonymousContinent||null),this._location},enumerable:!1,configurable:!0}),e.updateConsentStatus=function(){var e=this.getCurrentConsentType();this.hasConsent=!e||this.getConsentStatus(e)},e.getConsentStatus=function(e){var t=n.Utils.getBrowsiTag();return t&&t.__cs&&"function"==typeof t.__cs[e]?t.__cs[e]():this.hasConsent},Object.defineProperty(e,"prebidConf",{get:function(){var e=null;return"eu"===this.location?e={gdpr:{cmpApi:"iab",allowAuctionWithoutConsent:!0,timeout:1e3}}:"us"===this.location&&(e={usp:{cmpApi:"iab",timeout:1e3}}),e?{consentManagement:e}:null},enumerable:!1,configurable:!0}),e.getCurrentConsentType=function(){if(this.location){if("eu"===this.location)return"gdpr";if("us"===this.location)return"ccpa"}return null},e.getTimeOffset=function(e){var t=n.Utils.getBrowsiTag();return t&&t.consentTimeOffsets&&"function"==typeof t.consentTimeOffsets[e]?t.consentTimeOffsets[e]():-1},e}();t.default=r},function(e,t,i){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.YieldClient=void 0;var o=i(0),r=i(2),s=i(1),a=i(11),l=i(4),d=i(44),p=i(45),c=i(34),u=i(8),f=i(10),h=i(5),g=i(6),m=i(3),y=i(24),v=i(12),S=function(){function e(){this.logger=new o.Logger("YieldClient"),this.profile=r.Profiler.get()}return e.get=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.handleSpots=function(e){f.default.instance.setSpots(e);var t=this.profile.layouts.analysisMode;e.length&&!t&&(this.runPreDemand(e),this.processSpots(e))},e.prototype.runPreDemand=function(e){var t=s.Utils.getExternalFlowHandler("onPreDemand");t&&(g.ResponseTimeCollector.get().setRuleBySpot("preDemand",e[0],!0),t(e),g.ResponseTimeCollector.get().setRuleBySpot("preDemand",e[0],!1))},e.prototype.runPostDemand=function(e,t){var i=s.Utils.getExternalFlowHandler("onPostDemand");if(i){this.logger.info("invoking onPostDemand");try{g.ResponseTimeCollector.get().setRuleBySpot("onPostDemand",t[0],!0),i(e,t),g.ResponseTimeCollector.get().setRuleBySpot("onPostDemand",t[0],!1)}catch(e){this.logger.error("failed to execute onPostDemand",e)}}},e.prototype.processSpots=function(e){var t=this;this.profile.layouts.potentialSpots?this.getDemand(e,d.DemandRequestType.SRA):e.forEach((function(e){t.getDemand([e],d.DemandRequestType.SINGLE)}))},e.prototype.processSingleSpot=function(e){if(this.logger.info("attemptIndex",e.attemptIndex),e.type===l.SpotType.STICKY)return this.stickyDemandRequest(e);this.getDemand([e],d.DemandRequestType.SINGLE)},e.prototype.getDemandCallback=function(e,t){var i=this;e&&this.runPostDemand(e,t),e&&"sra"===e.rt&&(e=c.SRAResponseManager.preProcessSRAResponse(e,t),this.logger.info("getDemand returned  SRA response ",e)),t.forEach((function(n){if(!e&&!(e=n.handleEmptyResponse()))return i.logger.info("getDemand returned empty, waterfall ended for spot "+n.adIndex),void n.closePlaceholderAndRemove();n.shouldWaitForUserEngagement()?i.waitForUserEngagement().then((function(){return p.DemandManager.get().processResponse(n,e,t)})):p.DemandManager.get().processResponse(n,e,t)}))},e.prototype.stickyDemandRequest=function(e){var t=this;if(!this.profile.layouts.analysisMode){var i=this.buildStickyDemand(e),n="//"+this.profile.yieldData.host+"/v4/demand/sticky?"+s.Utils.toUrlParams(i);s.Utils.xhrPromise(n,"GET").then((function(i){if(204===i.status)t.logger.info("Waterfall ended for sticky spot"),e.closePlaceholderAndRemove();else if(202===i.status)t.handleRefreshBlocked(e);else if(200===i.status){var o=JSON.parse(i.responseText);p.DemandManager.get().processResponse(e,o,[e])}else t.logger.info("Error on get demand for sticky spot");s.Utils.logXhrRequestTime(n,"sticky")}))}},e.prototype.nextWaterfallStep=function(e){e.isRefreshing()?e.handleRefreshFailed():(e.attemptIndex++,this.processSingleSpot(e))},e.prototype.waitForUserEngagement=function(){var e=this;return new Promise((function(t){var i=function(){e.logger.info("detected scroll, fetching"),u.default.get().removeListener("scroll",window.top,i),e.profile.isUserEngaged=!0,t()};u.default.get().listen("scroll",window.top,i)}))},e.prototype.getDemand=function(e,t){var i="";switch(t){case d.DemandRequestType.SRA:i=this.buildGetSRADemandUrl(e);break;case d.DemandRequestType.SINGLE:if(1===e.length){var n=e[0];i=this.buildGetDemandUrl(n)}else this.logger.error("Error while creating getDemand script tag: Invalid spots list",e)}i?this.getDemandXhrRequest(i,e):this.logger.error("error building demand url",e)},e.prototype.getDemandXhrRequest=function(e,t){var i=this;this.profile.layouts.analysisMode||s.Utils.xhrPromise(e,"GET").then((function(n){if(204===n.status)i.getDemandCallback(null,t);else if(202===n.status)i.handleRefreshBlocked(t[0]);else if(200===n.status){var o=JSON.parse(n.responseText);i.getDemandCallback(o,t)}else i.logger.info("Error on get demand. url:"+e+",spots "+t);s.Utils.logXhrRequestTime(e,"getDemand",{sra:e.includes("/sra/")})})).catch((function(e){i.logger.error("error on xhr promise",e)}))},e.prototype.buildGetSRADemandUrl=function(e){var t,i,n,o,a=r.Profiler.get(),d=v.default.instance.getFoundSpots(),p={sk:a.identity.siteKey,pvId:a.identity.pageviewId,sId:a.identity.sessionId,uId:s.Utils.getUserID(),u:s.Utils.getPageUrl(),mid:{dmc:(null===(t=h.SpotsUtils.getConf(l.SPOT_TAGS_MAP[l.SpotType.DYNAMIC_MC]))||void 0===t?void 0:t.maxItems)||0,fmc:(null===(i=h.SpotsUtils.getConf(l.SPOT_TAGS_MAP[l.SpotType.FIXED_MC]))||void 0===i?void 0:i.maxItems)||0,ft:(null===(n=h.SpotsUtils.getConf(l.SPOT_TAGS_MAP[l.SpotType.FIXED_TOP]))||void 0===n?void 0:n.maxItems)||0,fb:(null===(o=h.SpotsUtils.getConf(l.SPOT_TAGS_MAP[l.SpotType.FIXED_BOTTOM]))||void 0===o?void 0:o.maxItems)||0,r:this.getRailsMaxItemsForSRA(a)},dd:this.buildDeviceData(a),c:"",aId:a.identity.articleId,mch:s.Utils.getMainContentSize(a.domData),pl:s.Utils.getPageHeight(),pps:this.buildPotentialSpotsParams(e),ul:s.Utils.getScrollingDistance(),sdi:{rightRail:d.availableSpots.length?d.fixedFirst.filter((function(e){return e.type===l.SpotType.FIXED_RIGHT_RAIL})).length:0,leftRail:d.availableSpots.length?d.fixedFirst.filter((function(e){return e.type===l.SpotType.FIXED_LEFT_RAIL})).length:0}},c=s.Utils.getUrlQueryParams();return c.length>0&&(p.qp=c),"//"+a.yieldData.host+"/v4/demand/sra/desktop?"+s.Utils.toUrlParams(p)},e.prototype.getRailsMaxItemsForSRA=function(e){var t,i=e.layouts.spots.rails;if(i){var n=i.maxItems,o=i.railSide===y.RailsSides.RIGHT?l.SpotType.FIXED_RIGHT_RAIL:l.SpotType.FIXED_LEFT_RAIL;return n+((null===(t=h.SpotsUtils.getConf(l.SPOT_TAGS_MAP[o]))||void 0===t?void 0:t.maxItems)||0)}return 0},e.prototype.buildGetDemandUrl=function(e){var t=r.Profiler.get();this.logger.info("AttemptIndex: ",e.attemptIndex);var i={sk:t.identity.siteKey,pvId:t.identity.pageviewId,sId:t.identity.sessionId,uId:s.Utils.getUserID(),u:s.Utils.getPageUrl(),dd:this.buildDeviceData(t),ad:this.buildAdData(e),c:"",ul:s.Utils.getScrollingDistance(),eul:a.default.get().getThresholdMidPoint(e),aId:t.identity.articleId,mch:s.Utils.getMainContentSize(t.domData),pl:s.Utils.getPageHeight()},n=s.Utils.getUrlQueryParams();return n.length>0&&(i.qp=n),"//"+t.yieldData.host+"/v4/demand/desktop?"+s.Utils.toUrlParams(i)},e.prototype.buildStickyDemand=function(e){var t=r.Profiler.get();this.logger.info("AttemptIndex: ",e.attemptIndex);var i={sk:t.identity.siteKey,pvId:t.identity.pageviewId,sId:t.identity.sessionId,uId:s.Utils.getUserID(),u:s.Utils.getPageUrl(),dd:this.buildDeviceData(t),ad:this.buildStickyAdData(e),aId:t.identity.articleId,pageH:s.Utils.getPageHeight()},n=s.Utils.getUrlQueryParams();return n.length>0&&(i.qp=n),i},e.prototype.buildAdData=function(e){var t,i=n({atI:e.attemptIndex,ai:e.adIndex,f:s.Utils.getElementFoldNumber(e.ref),rc:e.refresh.count,ll:e.isLazyLoading,st:e.type,et:e.getExpectedEmbedding(),ot:s.Utils.getElementPosition(e.ref).top,di:e.demandIndex,pt:e.positionTypeToString()},s.Utils.getBlockRefreshList(e.slot)||{});return e.type===l.SpotType.API&&(i.plid=e.ref.id,i.au=null===(t=e.options)||void 0===t?void 0:t.adUnit),i},e.prototype.buildStickyAdData=function(e){return{atI:e.attemptIndex,rc:e.refresh.count}},e.prototype.buildDeviceData=function(e){return{o:e.deviceDetails.os,d:e.deviceDetails.device,t:e.deviceDetails.deviceType,b:e.deviceDetails.browser,sh:e.deviceDetails.screenHeight}},e.prototype.buildPotentialSpotsParams=function(e){return e.map(this.buildSRAPotentialSpot)},e.prototype.buildSRAPotentialSpot=function(e){return{ai:e.adIndex,f:s.Utils.getElementFoldNumber(e.ref),ll:e.isLazyLoading,st:e.type,et:e.getExpectedEmbedding(),ot:s.Utils.getElementPosition(e.ref).top,eul:a.default.get().getThresholdMidPoint(e),pt:e.positionTypeToString()}},e.prototype.handleRefreshBlocked=function(e){e.refresh.active=!1,m.EventsService.get().sendAdBlockedEvent(e,[{reason:"liIdBl"}])},e}();t.YieldClient=S},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ViewabilityService=t.ViewabilityObjectType=void 0;var n,o=i(0),r=i(1),s=i(15),a=i(8);!function(e){e[e.SPOT=0]="SPOT",e[e.PUBLISHER_AD=1]="PUBLISHER_AD"}(n=t.ViewabilityObjectType||(t.ViewabilityObjectType={}));var l=function(){function e(){var e=this;this.logger=new o.Logger("Viewability"),this.pendingObjects=[],this.viewabilityCheckInterval=150,this.isWathcing=!1,this.viewabilityCheck=this.throttle((function(t){var i=r.Utils.getScrollPosition();0===e.pendingObjects.length?(a.default.get().removeListener("scroll",window,e.viewabilityCheck),e.isWathcing=!1,e.logger.info("viewability check has stopped, no more elements")):e.pendingObjects.forEach((function(t){return e.checkElementViewability(t,i)}))}),this.viewabilityCheckInterval),s.Focus.get().subscribe(this.onFocusChanged.bind(this))}return e.get=function(){return e._instance||(this._instance=new e),e._instance},e.prototype.subscribe=function(e){var t=this;this.isPublisherAdDuplicate(e)||(this.pendingObjects.push(e),this.pendingObjects.forEach((function(e){return t.checkElementViewability(e,r.Utils.getScrollPosition())})),this.isWathcing||this.startWatching())},e.prototype.isPublisherAdDuplicate=function(e){if(e.type!==n.PUBLISHER_AD)return!1;var t=e.root();return this.pendingObjects.filter((function(e){return e.type===n.PUBLISHER_AD})).some((function(e){return e.root().element===t.element}))},e.prototype.startWatching=function(){this.isWathcing=!0,a.default.get().listen("scroll",window,this.viewabilityCheck)},e.prototype.checkElementViewability=function(e,t){var i=this;if(this.isInView(e,t)){if(r.Utils.isNullOrUndefined(e.metrics.startTime)){e.metrics.startTime=Date.now(),this.logger.info(e.root()," is in view");var n=e.refreshInfo.shouldRefresh,o=setInterval((function(e){if(i.pendingObjects.includes(e)){var s=r.Utils.getScrollPosition();i.isInView(e,s)?(r.Utils.isNullOrUndefined(e.metrics.startTime)&&(e.metrics.startTime=Date.now()),e.metrics.duration=i.getViewedDuration(e),i.logger.debug(e.root(),"is in view for "+e.metrics.duration),n&&e.metrics.duration>=e.refreshInfo.rate&&(i.logger.info(e.root(),": "+e.metrics.duration+"ms have passed.starting to refresh"),clearInterval(o),i.pendingObjects.splice(i.pendingObjects.indexOf(e),1),e.refreshInfo.doRefresh()),i.shouldSendViewedImpression(e)&&(i.handleViewed(e,t),n||clearInterval(o))):(i.handleOUtOfView(e),clearInterval(o))}}),this.viewabilityCheckInterval,e)}else e.metrics.duration=this.getViewedDuration(e);this.shouldSendViewedImpression(e)&&this.handleViewed(e,t)}else e.metrics.startTime&&this.handleOUtOfView(e)},e.prototype.handleOUtOfView=function(e){e.metrics.startTime&&(this.logger.debug(e.root()," is out of view after "+this.getViewedDuration(e)),e.metrics.startTime=null,e.metrics.duration=-1)},e.prototype.handleViewed=function(e,t){e.metrics.viewed=!0,e.refreshInfo.shouldRefresh?this.logger.debug(e.root(),"starting to count for refresh ("+e.metrics.duration+"ms out of "+e.refreshInfo.rate+"ms)"):this.pendingObjects.splice(this.pendingObjects.indexOf(e),1),this.logger.debug(e.root(),"after "+e.metrics.duration+"ms"),e.sendViewedImpression(Math.round(this.inViewPercentage(e,t)))},e.prototype.getViewedDuration=function(e){return e.metrics.startTime?Date.now()-e.metrics.startTime:-1},e.prototype.shouldSendViewedImpression=function(e){return!e.metrics.viewed&&e.metrics.duration>=e.conf.duration},e.prototype.throttle=function(e,t){var i=!1;return function(n){i||(e(n),i=!0,setTimeout((function(){i=!1,e(n)}),t))}},e.prototype.isInView=function(e,t){if(!e.runCondition()||s.Focus.get().isHidden)return!1;var i=this.inViewPercentage(e,t),n=i>=e.conf.minViewInitiator;return i>0&&this.logger.debug(e.root()," percentage in view: "+i.toFixed(2)+" , minViewInitiator: "+e.conf.minViewInitiator+", in view: "+n),n},e.prototype.onFocusChanged=function(){var e=this;s.Focus.get().waitForUserFocus().then((function(){e.viewabilityCheck(null)}))},e.prototype.inViewPercentage=function(e,t){var i=t||r.Utils.getScrollPosition(),n=e.getCoords().top,o=e.getHeight();if(i.top<=n&&i.bottom>n){var s=i.bottom-n;return 100*Math.min(Number(s/o),1)}if(i.top>n&&i.top<n+o){s=n+o-i.top;return 100*Math.min(Number(s/o),1)}return 0},e.prototype.unsubscribe=function(e){this.pendingObjects=this.pendingObjects.filter((function(t){return t.root()!==e}))},e}();t.ViewabilityService=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),o=i(3),r=i(1),s=function(){function e(e,t,i){this.logger=new n.Logger("MeasurableImpressions"),this.spot=e,this.nonFriendlyFound=0,this.rootFrames=[],this.secLevelFrames=[],this.mutationConfig={childList:!0,subtree:!0},this.isSaas=t,this.adUnit=i}return e.prototype.waitForSpotMeasurable=function(){var e=this;if(this.spot.browsiAd&&this.spot.browsiAd.wrapper){if(this.rootFrames=this.scanAllFrames(this.spot.browsiAd.wrapper),this.rootFrames.forEach((function(t){e.secLevelFrames=e.secLevelFrames.concat(e.scanAllFrames(t))})),0==this.nonFriendlyFound&&!this.adFramesFound())return void this.waitForIframe();if(this.nonFriendlyFound>0&&!this.adFramesFound())return void this.sendEvent("non-friendly iframes");this.promiseAll(this.rootFrames.concat(this.secLevelFrames))}},e.prototype.sendEvent=function(e){this.spot.isMeasurable||(this.spot.isMeasurable=!0,o.EventsService.get().sendAdMeasurableEvent(this.spot,this.adUnit,this.isSaas,e))},e.prototype.adFramesFound=function(){return this.secLevelFrames.length>0||(!this.spot.browsiAd||!this.spot.browsiAd.iframe)&&this.rootFrames.length>0},e.prototype.promiseAll=function(e){var t=this,i=e.map((function(e){return t.waitForIframeLoad(e)}));Promise.all(i).then((function(e){e.filter((function(e){return!e.status||"complete"!=e.status})).length||(t.logger.debug("send measurable event after frames scan for spot ",t.spot.adIndex," iframes scaned ",e," nonFriendly found ",t.nonFriendlyFound),t.sendEvent("all frames loaded"))})).catch((function(e){return t.logger.error("measurable no iframe loaded found ",e)}))},e.prototype.waitForIframeLoad=function(e){var t=this;return new Promise((function(i,n){var o=e.contentDocument||e.contentWindow.document;t.isIframeLoaded(o)?i({status:"complete",frame:e}):e.onload=function(t){i({status:"complete",frame:e})}}))},e.prototype.isIframeLoaded=function(e){return"complete"==e.readyState&&null!=e.querySelector("head")&&e.querySelector("head").childNodes.length>0&&null!=e.querySelector("body")&&e.querySelector("body").childNodes.length>0},e.prototype.scanAllFrames=function(e){var t=r.Utils.querySelectorOnDocument(e,"iframe"),i=t.filter((function(e){return r.Utils.isFriendlyIframe(e.element)}));return this.nonFriendlyFound+=t.length-i.length,i.map((function(e){return e.element}))},e.prototype.waitForIframe=function(){var e=this;this.observer=new MutationObserver((function(t){return e.handleMutationFound(t)})),this.rootFrames.length?this.rootFrames.forEach((function(t){e.observer.observe(t.contentDocument||t.contentWindow.document,e.mutationConfig)})):this.spot.browsiAd&&this.spot.browsiAd.wrapper&&this.observer.observe(this.spot.browsiAd.wrapper,this.mutationConfig)},e.prototype.handleMutationFound=function(e){var t=this;if(e.forEach((function(e){Array.from(e.addedNodes).forEach((function(e){"IFRAME"==e.nodeName&&t.secLevelFrames.push(e)}))})),this.secLevelFrames.length){this.logger.info("Observer destroyed");var i=this.secLevelFrames.filter((function(e){return r.Utils.isFriendlyIframe(e)}));i.length?this.promiseAll(i):this.sendEvent("non-friendly iframes")}},e}();t.default=s},function(e,t,i){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.AuctionDataCollector=void 0;var o=i(52),r=i(0),s=i(3),a=i(12),l=function(){function e(){this.logger=new r.Logger("AuctionDataCollector"),this.requests={},this.matches={},this.requestPipes={},this.matchesPipes={}}return e.get=function(){return e.instance||(this.instance=new e),e.instance},e.prototype.collectBidRequest=function(e,t,i){this.requests[t]=Object.assign(this.requests[t]||{},i),this.requestPipes[t]||this.resetRequestPipe(t),this.requestPipes[t][e]=o.CollectorPipeStatus.COMPLETE,this.shouldSendRequest(t)&&(this.logger.debug("bid request collect done for ad unit",t,this.requests[t]),this.sendBidRequestEvent(this.getSpotFromAdUnitCode(t),this.requests[t]))},e.prototype.collectBidMatch=function(e,t,i,n){this.matches[e]=this.matches[e]||{},this.matches[e][t]=this.matches[e][t]||[],this.matches[e][t][+i.im]=this.matches[e][t][+i.im]||[],this.matches[e][t][+i.im].push(i),n&&this.sendBidMatches(e)},e.prototype.sendBidMatches=function(e){var t=this.getSpotFromAdUnitCode(e),i=this.bidMatchedParamsToEvent(this.matches[e]);i&&i.length&&s.EventsService.get().sendBidMatched(t,i),this.matches[e]={}},e.prototype.bidMatchedParamsToEvent=function(e){var t=[],i=function(i){e.hasOwnProperty(i)&&e[i].forEach((function(e){var o={n:i,im:e[0].im,s:[]};e[0].reqt&&e[0].rest&&(o.reqt=e[0].reqt,o.rest=e[0].rest),e[0].brc&&(o.brc=e[0].brc),e[0].au&&(o.au=e[0].au),e.forEach((function(e){e.s.forEach((function(t){o.s.push(n(n(n({},t),e.rsn?{rsn:e.rsn}:{}),e.br?{br:e.br}:{}))}))})),t.push(o)}))};for(var o in e)i(o);return t},e.prototype.getSpotFromAdUnitCode=function(e){var t=e.split("_")[3];return a.default.instance.getAvailableSpots().concat(a.default.instance.getApiSpots()).find((function(e){return e.adIndex===+t}))},e.prototype.collectDFPBidRequest=function(e,t){this.sendBidRequestEvent(e,t)},e.prototype.sendBidRequestEvent=function(e,t){var i=this.buildRequestParamsToEvent(t);i&&i.length&&s.EventsService.get().sendBidRequest(e,i)},e.prototype.buildRequestParamsToEvent=function(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push({n:i,s:e[i]});return t},e.prototype.shouldSendRequest=function(e){return this.requestPipes[e]&&this.requestPipes[e].prebid===o.CollectorPipeStatus.COMPLETE&&this.requestPipes[e].aps===o.CollectorPipeStatus.COMPLETE},e.prototype.resetRequestPipe=function(e){this.requestPipes[e]={aps:o.CollectorPipeStatus.PENDING,prebid:o.CollectorPipeStatus.PENDING}},e.prototype.buildSizesFromArray=function(e){return e.map((function(e){return{w:e[0],h:e[1]}}))},e}();t.AuctionDataCollector=l},function(e,t,i){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.DCS=void 0;var o=i(2),r=i(0),s=i(1),a=i(8),l=i(29),d=i(38),p=i(15),c=i(10),u=i(7),f=i(3),h=i(12),g=i(11),m=i(26),y=i(4),v=i(13),S=function(){function e(e){this.dcsObj=u.DcsUtils.getWindowObject(),this.contextElement=top.document.body,this.steps=[],this.dataFromLastStep=null,this.observers=[],this.listeners=[],this.checkUrlInterval=0,this.timeoutBeforeNewRun=0,this.type=e,this.logger=new r.Logger("DCS_"+this.type),u.DcsUtils.dcsType=this.type,this.mutationConfig={childList:!0,subtree:!0},this.currentURL=window.location&&window.location.href.split("?")[0],this.dcsObj&&this.updateNewPv(this.dcsObj),this.logger.info("Started "+this.type,this.dcsObj?"Object: "+this.dcsObj:"")}return e.prototype.detectDcs=function(e,t){var i=this;return void 0===t&&(t=!1),(t?Promise.race([this.checkUrl(),this.checkSteps(0,e)]):this.checkSteps(0,e)).then((function(){i.handleStepsEnded(i.dataFromLastStep)})).catch((function(e){i.clearDcsListeners(),i.logger.error(e)})),Promise.resolve()},e.prototype.detectUrlChangeOnly=function(){var e=this;return this.checkUrl().then((function(){return e.handleStepsEnded(e.dataFromLastStep)}))},e.prototype.checkUrl=function(){return this.checkStep(-1,{type:"urlChange",value:""})},e.prototype.checkSteps=function(e,t,i){var n=this;return t.length&&t[e]?this.checkStep(e,t[e],i).then((function(i){return n.checkSteps(++e,t,i)})):Promise.resolve()},e.prototype.checkStep=function(e,t,i){var n=this;return this.logger.debug("checking step",e),"function"==typeof t?t()?Promise.resolve():Promise.reject("step function failed"):this.listenToEventOrMutation(t,i).then((function(e){if(e)return n.dataFromLastStep=e,e;n.logger.info("listenToEventOrMutation ended",e,n.dataFromLastStep)}))},e.prototype.listenToEventOrMutation=function(e,t){var i=this;if(e.container)return this.watch(e);var n=e;return n.elements=t?[t]:n.elements,this.waitForTrigger(n).then((function(e){return i.logger.info("trigger caught",e),e}))},e.prototype.watch=function(e){var t=this;return this.logger.info("watching for "+e.article+" in "+e.container),new Promise((function(i,n){var o=[],r=t.getElement(e.container);if(!r)return n("no elements found for selector: "+e.container);var s=new MutationObserver((function(n){t.mutationHandler(n,e,o,i)}));t.observers.push(s),s.observe(r,t.mutationConfig)}))},e.prototype.waitForTrigger=function(e){var t=this;switch(this.logger.info("waiting for trigger "+e.type+" of "+e.value,e.elements),e.type){case"distance":return this.distanceTrigger(e);case"buttonClick":return e.value?this.buttonClickTrigger(e):Promise.reject("no selectors");case"urlChange":return this.urlChangeTrigger().then((function(e){return t.logger.info("urlChanged",e),e}));default:return Promise.reject("no type")}},e.prototype.mutationHandler=function(e,t,i,n){var o=this;e.forEach((function(e){for(var r=0;r<e.addedNodes.length;r++){var s=e.addedNodes[r];if(s instanceof Element){if(o.matches(s,t.article))return o.handleNewArticle(s,i,n);var a=s.querySelector(t.article);if(a)return o.handleNewArticle(a,i,n)}}}))},e.prototype.handleNewArticle=function(e,t,i){return this.logger.info("New Articles detected!",e),t.push(e),i(e)},e.prototype.distanceTrigger=function(e){var t=this;return new Promise((function(i,n){e.elements&&e.elements[0]?t.addListener("scroll",document,s.Utils.throttle((function(){return t.distanceHandler(e,i)}),500)):n()}))},e.prototype.distanceHandler=function(e,t){if(e.elements&&e.elements[0]){var i=e.elements[0],n=s.Utils.getPercentageInView(i);if(n>+e.value)return this.logger.info("element in view: ",n,i),t(i)}},e.prototype.buttonClickTrigger=function(e){var t=this;return new Promise((function(i,n){var o=document.querySelectorAll(e.value);if(o.length)for(var r=0;r<o.length;r++){var s=o[r];t.addListener("click",s,(function(){i()}))}else n("no elements found for selector: "+e.value)}))},e.prototype.urlChangeTrigger=function(){var e=this;return new Promise((function(t,i){return e.hasUrlChanged()?t():(e.addListener("hashchange",window,(function(){return t})),e.addListener("popstate",window,(function(){return t})),e.addListener("locationchange",window,(function(){return t})),e.checkUrlInterval=setInterval((function(){e.hasUrlChanged()&&(clearInterval(e.checkUrlInterval),t())}),1e3),e.hasUrlChanged()?t():void 0)}))},e.prototype.setWindowObject=function(e,t){var i=this.createPvObject(e),n=u.DcsUtils.getWindowObject()||this.createDcsObject();return n.count++,n.pvs.push(i),t&&Object.assign(n.ppv,{e:t}),n},e.prototype.createDcsObject=function(){var e={count:0,dcsType:this.type,pvs:[],ppv:{pv:o.Profiler.get().identity.pageviewId}};return window.top[u.DcsUtils.winObjName]=e,e},e.prototype.createPvObject=function(e){var t=m.PubAdsRefreshService.get();return{pv:void 0,e:e,data:n(n({},"end_less"===this.type||"slides"===this.type?{sAE:c.default.instance.getStayAwayElementsList().filter((function(t){return s.Utils.isPositionedAfter(t.element,e)}))}:{}),{pad:t?t.pubAdsData:[]})}},e.prototype.updateNewPv=function(e){e.pvs[e.count-1].pv=o.Profiler.get().identity.pageviewId},e.prototype.handleStepsEnded=function(e){this.logger.info("handleStepsEnded"),this.dcsSuccessActions(e)},e.prototype.dcsSuccessActions=function(e){var t=this;this.clearListeners(),this.timeoutBeforeNewRun?setTimeout((function(){t.runNewPv()}),this.timeoutBeforeNewRun):this.runNewPv();var i=this.setWindowObject(e,this.firstArticle);this.keepSpotsReference(),this.keepPublisherAdsReference(),this.sendDcsEvent(this.eventType,{ac:i.count,ppvid:i.ppv.pv})},e.prototype.runNewPv=function(){this.logger.info("runNewPv"),window.browsi_bootstrap_loaded=!1,window._middyo=null,this.logger.info("injecting bootstrap");var e=s.Utils.cloneAndEmbedBoostrap();e&&e.parentElement&&e.parentElement.removeChild(e)},e.prototype.clearListeners=function(){a.default.get().removeAll(),this.observers.forEach((function(e){return e.disconnect()})),l.default.setInactive(),d.EngagementService.unsubscribeIfNeeded(),p.Focus.get().unsubscribe(),clearInterval(this.checkUrlInterval),g.default.get().stopService(!0);var e=m.PubAdsRefreshService.get();e&&e.deactivate(),this.clearDemandCallbacks("__b_gdc_sra_")},e.prototype.sendDcsEvent=function(e,t){f.EventsService.get().sendDcs(e,t)},e.prototype.matches=function(e,t){return e.matches?e.matches(t):e.msMatchesSelector?e.msMatchesSelector(t):!e.webkitMatchesSelector||e.webkitMatchesSelector(t)},e.prototype.getElement=function(e){return this.contextElement.querySelector(e)},e.prototype.getElements=function(e){return Array.from(this.contextElement.querySelectorAll(e))},e.prototype.getPreviousElements=function(){var e=u.DcsUtils.getWindowObject();return e?e.pvs.map((function(e){return e.e})):null},e.prototype.hasUrlChanged=function(){var e=window.location&&window.location.href.split("?")[0];return!e||this.currentURL!==e},e.prototype.addListener=function(e,t,i){this.listeners.push({type:e,listenObj:t,callback:i}),a.default.get().listen(e,t,i)},e.prototype.clearDcsListeners=function(){this.listeners.forEach((function(e){a.default.get().removeListener(e.type,e.listenObj,e.callback)}))},e.prototype.setSpots=function(e){this.spots=e},e.prototype.RemoveBrowsiAdsFromDom=function(){var e=this;h.default.instance.getAvailableSpots().forEach((function(t){t.slot&&t.browsiAd.win?t.browsiAd.win.googletag.destroySlots([t.slot]):e.logger.debug("could not destroy slot",t);var i=t.removeAdFromDom();e.logger.debug("Spot removed from DOM",i,t),e.clearDemandCallbacks("__b_gdc_ad_"+t.adIndex)}))},e.prototype.clearDemandCallbacks=function(e){var t=""+e+u.DcsUtils.getDemandDcsSuffix();window.top[t]=function(){}},e.prototype.keepSpotsReference=function(){var e=u.DcsUtils.getWindowObject();if(e){var t=h.default.instance.getSpotsByType(y.SpotType.STICKY),i=h.default.instance.getLeftRailsSpotsFound().concat(h.default.instance.getRightRailsSpotsFound()),n=t.concat(i);if(n.length&&e){var o=[];n.forEach((function(e){o.push(h.default.instance.getDcsSerializedSpot(e))})),e.spots=o}}},e.prototype.keepPublisherAdsReference=function(){var e,t=v.default.get().foundAds;if(t&&t.length){var i=u.DcsUtils.getWindowObject();if(!i)return;i._pubads||(i._pubads=[]),(e=i._pubads).push.apply(e,t)}},e}();t.DCS=S},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Provider=void 0;var n=i(1),o=i(3),r=i(14),s=i(2),a=i(31),l=i(18),d=i(4),p=i(23),c=i(6),u=i(16),f=function(){function e(e,t){this.spot=e,this.providerName=t,this.spot.providerName=this.providerName,this.hasFluidSizeSupport=!1,this.profile=s.Profiler.get(),this.browsiViewability50Key=this.profile.browsiViewability50Key}return e.prototype.getAdUnitPath=function(e){return"/"+e.a.pubID+"/"+e.au},e.prototype.getAdUnit=function(e){return e?e.au:""},e.prototype.addGPTScriptTag=function(e){var t=this;return new Promise((function(i,n){if(e&&e.win){var o=e.win.document.createElement("script");o.async=!0,o.setAttribute("src","//securepubads.g.doubleclick.net/tag/js/gpt.js"),o.addEventListener("load",(function(){i(e)})),c.ResponseTimeCollector.get().measureScript("gpt",o),e.win.document.head.appendChild(o)}else t.logger.error("failed to append gpt script tag"),n(e)}))},e.prototype.expandAd=function(e,t,i){var n=this;e.selectedSize?(e.handleRefreshSuccess(),e.expand(e.selectedSize).then((function(s){e.selectedSize?(e.isImpression=!0,o.EventsService.get().sendAdImpression(e,n.providerName,e.selectedSize.selectedEmbedding),e.type===d.SpotType.STICKY&&r.Embedder.addStickyCloseButton(e,e.browsiAd.wrapper),"generic_js"!==n.providerName&&n.isAdInViewport().then((function(t){t&&n.sendAdInViewEvent(e)})),e.updateInSpotEngineTest(),n.logger.info("added ["+s.w+"X"+s.h+"]: ",e.browsiAd.wrapper),n.verifyStickySpotSize(s)&&e.subscribeToViewabilityService(),t(Object.assign({status:"success"},i||{}))):t({status:"failure"})}))):t({status:"failure"})},e.prototype.isAdInViewport=function(){if(!this.profile.siteInfo.adInViewport||this.spot.refresh.count>0)return Promise.resolve(!1);var e=50+(this.spot.browsiAd.admarking?n.Utils.getElementSize(this.spot.browsiAd.admarking).h:0),t=this.spot.browsiAd.wrapper;return t?n.Utils.getElementSize(t).h>e?Promise.resolve(!0):new Promise((function(i){var o=new a.default(t);o.addResizeListener((function(){if(n.Utils.getElementSize(t).h>e)return o.removeResizeListener(),i(!0)}))})):Promise.resolve(!1)},e.prototype.sendAdInViewEvent=function(e){if(e.browsiAd&&e.browsiAd.wrapper){var t=e.browsiAd.wrapper,i=l.ViewabilityService.get().inViewPercentage({getCoords:function(){return n.Utils.getElementPosition(t)},getHeight:function(){return n.Utils.getElementSize(t).h}});i&&o.EventsService.get().sendAdInViewport(e,i)}},e.prototype.buildSizes=function(e,t){return t.isRefreshing()&&t.selectedSize?e&&n.Utils.isFluidSize(t.selectedSize)?["fluid"]:[t.selectedSize.w,t.selectedSize.h]:t.compatibleSizes.filter((function(t){return e||!e&&!n.Utils.isFluidSize(t)})).map((function(t){return e&&n.Utils.isFluidSize(t)?["fluid"]:[t.w,t.h]}))},e.prototype.isBrowsiSlot=function(e,t){return e.slot&&e.slot.getSlotElementId()===t},e.prototype.addKeyValues=function(e,t){e.od&&e.od[50]&&e.od[50].sp&&t.setTargeting(this.browsiViewability50Key,this.getBrowsiViewability(e.od[50])),this.spot.refresh.requested&&!this.spot.refresh.dcsRefresh&&this.spot.refresh.kv&&t.setTargeting("browsiRefresh","true");var i=e.c.pgkv||e.c&&e.c.d&&e.c.d.pgkv||{},o=Object.assign(n.Utils.clone(this.profile.pageKeyValues||{}),n.Utils.clone(i||{}));if(o)for(var r in o){var s=this.getTargetingValue(t,o[r],r);s.length&&t.setTargeting(r,s)}e.kv&&e.kv.forEach((function(e){t.setTargeting(e.k,e.v)}))},e.prototype.getTargetingValue=function(e,t,i){if(!t.v)return[];var n=this.spot.browsiAd.win.googletag;if(e.getTargeting(i).length||n&&-1!=n.pubads().getTargetingKeys().indexOf(i))return[];if(!t.j)return t.v;try{return this.spot.browsiAd.win.eval(t.v&&t.v[0])||[]}catch(e){return[]}},e.prototype.getBrowsiViewability=function(e){return e.p&&e.p>=0?(Math.floor(10*e.p)/10).toFixed(2):"NA"},e.prototype.runPreAuction=function(e,t){var i=n.Utils.getExternalFlowHandler("preAuction");if(i){this.logger.info("invoking preAuction");try{c.ResponseTimeCollector.get().setRuleBySpot("preAuction",e,!0),i(e,t),c.ResponseTimeCollector.get().setRuleBySpot("preAuction",e,!1)}catch(e){this.logger.error("preAuction failed",e)}}},e.prototype.getAdSelector=function(){return this.spot.browsiAd.container&&this.spot.browsiAd.container.id||""},e.prototype.verifyStickySpotSize=function(e){return this.spot.type!==d.SpotType.STICKY||(n.Utils.isValidStickyHeight(e.h)?(this.profile.layouts.spots.sticky.location===p.StickyLocation.TOP?window.top.document.body.style.paddingTop=e.h+"px":window.top.document.body.style.paddingBottom=e.h+"px",!0):(this.spot.slot&&this.spot.browsiAd.win&&this.spot.browsiAd.win.googletag.destroySlots([this.spot.slot]),this.spot.removeAdFromDom(),this.logger.info("sticky ad removed,",e.h," is over 30%"),!1))},e.prototype.setGoogleTagPrivacy=function(e){if(!u.default.hasUserConsent){var t=u.default.getCurrentConsentType();"ccpa"===t?e.pubads().setPrivacySettings({restrictDataProcessing:!0}):"gdpr"===t&&e.pubads().setRequestNonPersonalizedAds(1)}},e}();t.Provider=f},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StickyConstants=t.StickyLocation=void 0,function(e){e.TOP="TOP",e.BOTTOM="BOTTOM"}(t.StickyLocation||(t.StickyLocation={})),function(e){e.dcsVar="sticky"}(t.StickyConstants||(t.StickyConstants={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RailsSides=void 0,function(e){e.RIGHT="RIGHT",e.LEFT="LEFT"}(t.RailsSides||(t.RailsSides={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),o=i(2),r=i(3),s=function(){function e(){this.logger=new n.Logger("activeViewViewability"),this.isActive=!!o.Profiler.get().siteInfo.activeView}return e.get=function(){return e.instance||(this.instance=new e),e.instance},e.prototype.waitForPublisherAV=function(e,t){if(this.isActive){var i=t.refreshCount;window.googletag.pubads().addEventListener("impressionViewable",(function(n){n.slot==e&&i===t.refreshCount&&r.EventsService.get().sendViewedPublisherAdAV(t)}))}},e.prototype.waitForBrowsiAV=function(e,t){this.isActive&&t.browsiAd.win.googletag.pubads().addEventListener("impressionViewable",(function(i){i.slot==e&&r.EventsService.get().sendViewedImpressionAV(t)}))},e}();t.default=s},function(e,t,i){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.PubAdsRefreshService=void 0;var o=i(0),r=i(2),s=i(1),a=i(3),l=i(7),d=i(32),p=i(6),c=function(){function e(e){this.googletag=this.getGoogletag(),this.apstag=window.top.apstag,this.pubAdsData=[],this.logger=new o.Logger("PubadsRefresh"),this.profile=r.Profiler.get(),this.config=e,this.pbjsInstanceName=this.config.customPbjsName||"pbjs",this.pbjsInstance=this.getPbjs();var t=l.DcsUtils.getCurrentPvsObject();this.pubAdsData=t&&t.data.pad||[]}return e.get=function(){if(e.instance)return e.instance;var t=r.Profiler.get().pubAdsRefresh;return t&&(e.instance=new e(t))},e.prototype.preparePubadsRefresh=function(e,t){var i=this,n=this.findExistingAdData(t);n&&n.refreshInfo.active&&this.isAllowedLineItemId(t).then((function(){i.runPreRefresh(t,n).then((function(){if(n.refreshInfo.requested=!0,i.logger.info("preparing refresh for adData",n),i.pbjsInstance=i.getPbjs(),!i.config.dfpOnly&&i.pbjsInstance&&i.pbjsInstance.adUnits){var e=t.getAdUnitPath(),o=t.getSlotElementId();n.adUnit=i.pbjsInstance.adUnits.find((function(t){return[e,o].includes(t.code)}))}i.refreshBid(n)}))})).catch((function(t){i.logger.error("pubadsRefresh rejected slot refresh:",t),"liIdBl"===t&&(n.refreshInfo.active=!1,a.EventsService.get().sendPubAdRefreshBlockedEvent(e.placementId,n.refreshInfo.count,e.positionType,t))}))},e.prototype.runPreRefresh=function(e,t){var i=this;return new Promise((function(n,o){var r="prePubadsRefresh",a=s.Utils.getExternalFlowHandler(r);if(a){i.logger.info("invoking "+r);try{var l=e.getSlotElementId()+"_"+t.refreshInfo.count;p.ResponseTimeCollector.get().setRuleStart(r,l),a(e,t,n,o),p.ResponseTimeCollector.get().setRuleEnd(r,l)}catch(e){i.logger.error(r+" failed",e),n()}}else n()}))},e.prototype.refreshBid=function(e){var t=this;if(!e.slot||!e.element)return!1;var i=this.getAdSize(e.element);return this.attachSizeMapping(i,e.slot),this.handleKVs(e),e.refreshInfo.count++,this.sendRefreshRequestEvent(e),this.googletag.cmd=this.googletag.cmd||[],this.googletag.cmd.push((function(){var n=t.createHbPromise(e),o=t.createAmazonPromise(e.slot,i);Promise.all([n,o]).then((function(i){t.logger.debug("refreshing dfp "+i),e.slot.setCollapseEmptyDiv(!1),googletag.pubads().refresh([e.slot])}))})),!0},e.prototype.handleKVs=function(e){var t=this.getTargeting(e.slot);e.slot.clearTargeting(),Object.keys(t).forEach((function(i){i.indexOf("hb_")+i.indexOf("amzn")===-2&&e.slot&&e.slot.setTargeting(i,t[i])})),this.config.sendRefreshKV&&e.slot.setTargeting("browsiRefresh","true")},e.prototype.createHbPromise=function(e){var t=this;return new Promise((function(i,n){var o=t.getPbjs();o&&e.adUnit&&!t.config.dfpOnly?(t.logger.debug("refreshing with pbjs"),o.que=o.que||[],o.que.push((function(){e.adUnit&&o.requestBids({adUnitCodes:[e.adUnit.code],bidsBackHandler:function(){e.slot&&(o.setTargetingForGPTAsync([e.slot.getAdUnitPath()]),i("pbjs"))}})}))):i()}))},e.prototype.createAmazonPromise=function(e,t){var i=this;return new Promise((function(n){if(!i.apstag||"function"!=typeof i.apstag.fetchBids||i.config.dfpOnly)return n();var o=e.getSlotElementId(),r={slotID:o,slotName:e.getAdUnitPath(),sizes:[[t.w,t.h]]};i.apstag.fetchBids({slots:[r]},(function(e){var t=e.find((function(e){return e.slotID===o}));return i.logger.info("amazon bid: ",t),i.logger.apsLog(o,t),i.apstag.setDisplayBids(),n("amazon")}))}))},e.prototype.handleRenderEnded=function(e){if(this.config.active){var t=this.findExistingAdData(e.slot);if(t)if(e.isEmpty)this.logger.debug("refresh for adData:",t,"returned empty. disabling refresh for this slot."),t.refreshInfo.active=!1;else{if(t.refreshInfo.requested)return this.logger.debug("refresh for adData:",t,"ended successfully"),t.refreshInfo.requested=!1,!0;this.logger.debug("adData:",t,"was forced refresh. disabling refresh for this slot."),t.refreshInfo.active=!1}}return!1},e.prototype.sendRefreshRequestEvent=function(e){e.viewabilityObject&&a.EventsService.get().sendPubAdRefreshRequest(e.viewabilityObject.root(),e.refreshInfo.count,"browsi")},e.prototype.findExistingAdData=function(e){return this.pubAdsData.find((function(t){return t.slot===e}))},e.prototype.getOrCreateAdData=function(e,t,i){var n=this.findExistingAdData(e);return n||(n=this.createAdData(e,t)),n},e.prototype.getAdData=function(e,t,i){var n=this.findExistingAdData(e);if(this.checkConditions(e,n))return n||(n=this.createAdData(e,t)),n.viewabilityObject=i,n},e.prototype.createAdData=function(e,t){var i={slot:e,element:t,refreshInfo:{active:!0,requested:!1,count:0}};return this.pubAdsData.push(i),i},e.prototype.checkConditions=function(e,t){if(t&&!t.refreshInfo.active)return!1;var i=[];!this.isWhitelisted(e)&&i.push("not in whitelist"),t&&t.refreshInfo.count===this.config.refreshCount&&i.push("refresh count "+t.refreshInfo.count+" passed limit "+this.config.refreshCount);var n=!i.length;return this.logger.debug("checkConditions for",e.getSlotElementId(),"result ? ",n||i),n},e.prototype.isAllowedLineItemId=function(e){var t=r.Profiler.get();if(t.siteInfo.blockLineItemIds){var i=s.Utils.getBlockRefreshList(e);if(!i)return Promise.resolve();var o=n(n({},i),{sk:t.identity.siteKey,dt:"desktop"}),a="//"+t.yieldData.host+"/bli?"+s.Utils.toUrlParams(o);return s.Utils.xhrPromise(a,"GET").then((function(e){return s.Utils.logXhrRequestTime(a,"pubad"),202===e.status?Promise.reject("liIdBl"):Promise.resolve()}))}return Promise.resolve()},e.prototype.getViewabilityRefreshInfo=function(e,t,i){var n=this;if(this.config&&this.config.active){var o=this.getAdData(i,e.element,t);return{shouldRefresh:!(!o||!o.refreshInfo.active),rate:this.config.refreshRate,doRefresh:function(){n.preparePubadsRefresh(e,i)}}}return t.refreshInfo},e.prototype.isWhitelisted=function(e){switch(this.config.adIdType){case"AD_UNIT":var t=e.getAdUnitPath();return this.config.adIds.includes(t);case"PLACEMENT":var i=e.getSlotElementId();return this.config.adIds.includes(i);case"MACRO":var n=d.default.get().getFoundPublisherAdData("dfp",e.getSlotElementId(),0,e);if(n&&n.plid)return this.config.adIds.includes(n.plid)}return!1},e.prototype.deactivate=function(){this.config.active=!1},e.prototype.getAdSize=function(e){var t=s.Utils.getDfpAdSize(e);return t||(t={size:s.Utils.getElementSize(e),element:e}),t.size},e.prototype.attachSizeMapping=function(e,t){var i=googletag.sizeMapping().addSize([0,0],[e.w,e.h]).build();t.defineSizeMapping(i),this.logger.debug("attachedSizeMapping",i)},e.prototype.getGoogletag=function(){var e=window.top.googletag||(window.top.googletag={});return e.cmd=e.cmd||[],e},e.prototype.getTargeting=function(e){return e.getTargetingMap?e.getTargetingMap():e.getTargeting()},e.prototype.getPbjs=function(){return window.top[this.pbjsInstanceName]},e.prototype.getSlotWinner=function(e){var t=e.getHtml();return t.indexOf("renderAd")>-1?"prebid":t.indexOf("renderImp")>-1?"amazon":"dfp"},e}();t.PubAdsRefreshService=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Spot=t.AD_INDEX_LIMIT=void 0;var n=i(1),o=i(0),r=i(2),s=i(17),a=i(3),l=i(4),d=i(18),p=i(5),c=i(56),u=i(31);t.AD_INDEX_LIMIT=99;var f=function(){function e(t,i,s,a,l,d,u){this.conf={minViewInitiator:50,duration:1e3},this.wholeConf={minViewInitiator:100,duration:1e3},this.wrappedElements=[],this.isAutoSize=!1,this.ref=t,this.adIndex=-1,this.type=i.oldType,this.typeIndex=s,this.demandIndex=s,this.attemptIndex=1,this.isSaas=!1,this.compatibleSizes=a,this.availableHeight=l,this.offsetTop=n.Utils.getElementPosition(t).top,this.viewability={viewed:!1,duration:-1},this.browsiAd={h:-1,w:-1},this.isImpression=!1,this.logger=new o.Logger("Spot"),this.refresh={refreshed:!1,requested:!1,active:!1,count:0,impressionsEventCount:0,rate:0,do:!1,kv:!1},this.tableConfiguration=u?this.buildTableConfiguration():null,this.adRequestBlockedSent=!1,this.isLazyLoading=!1,this.spotRenderEnded=0,this.positionTypes=e.getPositionType(t),this.isDcs=d,this.profile=r.Profiler.get(),this.isMeasurable=!1,this.optimizeViewability=!0,this.targetElementPosition=p.SpotsUtils.getTargetElementPosition(i),this.tags=i,this.shouldUsePlaceholder()&&(this.placeholder=new c.default(this.getPlaceholderSize()))}return e.prototype.buildTableConfiguration=function(){var e=this.getTableIfExists();if(!e)return null;var t=e.rows[0].cells.length,i=document.createElement("tr"),n=document.createElement("td");return n.setAttribute("colspan",t.toString()),n.setAttribute("style","width: 100%; display: none;"),i.appendChild(n),{table:e,columns:t,adWrapper:i,mainTd:n}},e.prototype.positionTypeToString=function(){return n.Utils.sortedString(this.positionTypes)},e.prototype.getExpectedEmbedding=function(){var e=this.compatibleSizes.map((function(e){return e.selectedEmbedding}));if(1!==n.Utils.toSet(e).size)return"na";switch(e[0]){case"break":return"b";case"right":return"r";case"left":return"l";default:return"na"}},e.prototype.expand=function(e){var t=this,i=function(e){var t,i=null===(t=e.contentWindow)||void 0===t?void 0:t.document.body;if(i){e.style.setProperty("width","100%","important");var o=new u.default(i);o.addResizeListener((function(){var t=n.Utils.getElementSize(i).h;e.style.setProperty("height",t+"px","important"),setTimeout((function(){o.removeResizeListener()}),1e3)}))}};return new Promise((function(e,i){if(t.browsiAd.wrapper){var n=document.querySelector("#"+t.browsiAd.wrapper.id);n?e(n):i()}else i()})).then((function(o){return new Promise((function(r,s){var a,l=n.Utils.isFluidSize(e),d=n.Utils.getAdMarkingExpectedHeight();null===(a=t.placeholder)||void 0===a||a.removePlaceholderStyle(t.browsiAd),o.setAttribute("height",""+(l||t.isAutoSize?"auto":e.h+d)),o.setAttribute("width",""+(l||t.isAutoSize?"100%":e.w)),o.setAttribute("style",t.getEmbeddingStyle(e));var p=t.tableConfiguration&&o&&o.parentElement?o.parentElement:null;p&&p.setAttribute("style","width: 100%;"),t.browsiAd.iframe&&(t.browsiAd.iframe.setAttribute("style","text-align:center;display: block;margin: auto;width: "+e.w+"px !important; height: "+e.h+"px !important;"),l&&i(t.browsiAd.iframe));var c=n.Utils.getElementPosition(o);l?setTimeout((function(){var e=o.getBoundingClientRect();t.browsiAd.w=e.width,t.browsiAd.h=e.height,t.browsiAd=n.Utils.merge(t.browsiAd,{offsetTop:c.top,offsetLeft:c.left}),r({w:t.browsiAd.w,h:t.browsiAd.h})}),800):(t.browsiAd=n.Utils.merge(t.browsiAd,{offsetTop:c.top,offsetLeft:c.left}),r({w:t.browsiAd.w,h:t.browsiAd.h}))}))})).then((function(e){return new Promise((function(i,n){t.insertAdMarking(),t.setWrappedElementsStyle(),i(e)}))}))},e.prototype.setWrappedElementsStyle=function(){var e=this;this.selectedSize&&this.selectedSize.selectedEmbedding&&["left","right"].includes(this.selectedSize.selectedEmbedding)&&this.wrappedElements.forEach((function(t){t.minWrapSize.h<=e.selectedSize.h&&t.el.style&&(t.el.style.wordBreak="break-word")}))},e.prototype.setSelectedSize=function(e){var t=this.findSize(e);if(t)this.selectedSize=t;else{var i=r.Profiler.buildCompatibleSize(r.Profiler.getWidthForEmbed(this.ref),e,n.Utils.getAdMarkingExpectedHeight(),!0,!1);i&&(i.optionalEmbeddings.includes("break")&&(i.selectedEmbedding="break"),this.selectedSize=i,this.logger.warn("unexpected "+JSON.stringify(e)+" to",this.browsiAd.wrapper))}this.browsiAd=Object.assign({},this.browsiAd,e)},e.prototype.isSizeInSpot=function(e){return!!this.findSize(e)},e.prototype.findSize=function(e){return this.compatibleSizes.find((function(t){return t.w===+e.w&&t.h===+e.h}))},e.prototype.getDomId=function(){return this.domId||"e"},e.prototype.setDomId=function(e){this.domId=e},e.prototype.getEmbeddingStyle=function(e){var t;if(this.type===l.SpotType.STICKY)return"position:fixed!important;"+(null===(t=r.Profiler.get().layouts.spots.sticky)||void 0===t?void 0:t.location.toLowerCase())+": 0 !important; left: 50%; transform: translateX(-50%); margin:0 auto !important; z-index:9999;text-align:center; width:"+e.w+"px !important; height:"+e.h+"px !important;";var i="";return e.selectedEmbedding?i=this.buildStyle(e,r.Profiler.get().spotEngineConfig.spotStyle):this.logger.error("no embedding for spot "+this.adIndex,this.browsiAd.wrapper),i},e.prototype.buildStyle=function(e,t){var i="";if("break"===e.selectedEmbedding){var o=n.Utils.isFluidSize(e);i="text-align:center;display:block;clear: both !important;"+(l="margin: auto;margin-top:"+t.b.m.t+"px !important;margin-bottom:"+t.b.m.b+"px !important")+";width:"+(o?"100%":"auto")+" !important; height: auto !important;"}else{var r=n.Utils.getAdMarkingExpectedHeight(),s="left"===e.selectedEmbedding?t.l:t.r,a=getComputedStyle(this.ref),l="margin-top:"+(-1===s.m.t?parseInt(a.marginTop||"0"):s.m.t)+"px !important;\n                             margin-right:"+s.m.r+"px !important;\n                             margin-bottom:"+s.m.b+"px !important;\n                             margin-left:"+s.m.l+"px !important",d="padding-top:"+(-1===s.p.t?parseInt(a.paddingTop||"0"):s.p.t)+"px !important;\n                             padding-right:"+s.p.r+"px !important;\n                             padding-bottom:"+s.p.b+"px !important;\n                             padding-left:"+s.p.l+"px !important",p=this.isAutoSize?"width:auto;height:auto;":"width:"+e.w+"px !important; height:"+(e.h+r)+"px !important;";i="text-align:center;float:"+e.selectedEmbedding+";position:relative;"+n.Utils.removeSpaces(l)+";"+n.Utils.removeSpaces(d)+";"+p}return i},e.prototype.insertAdMarking=function(){if(this.type!==l.SpotType.STICKY){var e=r.Profiler.get().spotEngineConfig.adMarking;if(e&&this.browsiAd.wrapper&&this.selectedSize&&!this.browsiAd.admarking){var t=n.Utils.buildAdMarking(this,e);this.browsiAd.wrapper.insertBefore(t,this.browsiAd.wrapper.firstChild),this.browsiAd.admarking=t}}},e.prototype.getTableIfExists=function(){return this.ref?n.Utils.findParentElementByType("table",this.ref):null},e.prototype.cloneBrowsiAd=function(e){return Object.assign({},e)},e.prototype.updateRefreshDetails=function(e){this.refresh.requested||this.isAllowedProvider(e)&&(this.refresh=Object.assign(this.refresh,{active:e.c.ri&&e.c.ri.r>-1,refreshed:!!this.refresh.refreshed&&this.refresh.refreshed,requested:!!this.refresh.requested&&this.refresh.requested,count:this.refresh.count?this.refresh.count:0,impressionsEventCount:this.refresh.impressionsEventCount?this.refresh.impressionsEventCount:0,rate:e.c.ri&&e.c.ri.r?e.c.ri.r:0,do:!(!e.c.ri||!e.c.ri.do)&&e.c.ri.do,kv:!(!e.c.ri||!e.c.ri.kv)&&e.c.ri.kv}))},e.prototype.removeAdFromDom=function(){var e;if(null===(e=this.placeholder)||void 0===e||e.stopObserving(),this.browsiAd.externalElement&&n.Utils.removeElement(this.browsiAd.externalElement),this.browsiAd.wrapper){var t=document.querySelector("#"+this.browsiAd.wrapper.id);if(!(t&&document.body.contains(t)&&t.parentNode))return!1;if(this.browsiAd.admarking&&this.browsiAd.admarking.parentElement===t&&this.removeAdMarkingFromDom(),!this.tableConfiguration)return t.parentNode.removeChild(t),!0;var i=t.parentElement;if(i&&i.parentNode)return i.parentNode.removeChild(i),!0}return!1},e.prototype.removeAdMarkingFromDom=function(){return!(!this.browsiAd.admarking||!this.browsiAd.admarking.parentNode)&&(this.browsiAd.admarking.parentNode.removeChild(this.browsiAd.admarking),delete this.browsiAd.admarking,!0)},e.prototype.refreshSpot=function(){this.placeholder=void 0,this.canRefresh()&&(this.logger.info("Refreshing spot #"+this.adIndex),d.ViewabilityService.get().unsubscribe(this),this.refresh=Object.assign(this.refresh,{requested:!0,refreshed:!1,dcsRefresh:!1,oldBrowsiAd:this.cloneBrowsiAd(this.browsiAd)}),this.refresh.count++,this.waterfall=[],this.isMeasurable=!1,s.YieldClient.get().processSingleSpot(this))},e.prototype.refreshDcsSpotOnNewPv=function(){this.profile.layouts.analysisMode||(this.logger.info("Refreshing dcs spot"),d.ViewabilityService.get().unsubscribe(this),this.refresh=Object.assign(this.refresh,{active:!0,requested:!0,refreshed:!1,dcsRefresh:!0,oldBrowsiAd:this.cloneBrowsiAd(this.browsiAd)}),this.waterfall=[],s.YieldClient.get().processSingleSpot(this))},e.prototype.canRefresh=function(){return!this.isRefreshing()&&this.spotShouldRefresh()},e.prototype.isRefreshing=function(){return this.refresh.active&&this.refresh.requested&&!this.refresh.refreshed},e.prototype.spotShouldRefresh=function(){return this.refresh.active},e.prototype.handleRefreshFailed=function(){this.refresh.requested=!1,this.refresh.refreshed=!1,this.viewability={viewed:!1,duration:-1,startTime:void 0};var e=this.buildViewabilityServiceObject(this.conf);e.metrics.viewed=!0,d.ViewabilityService.get().subscribe(e)},e.prototype.handleRefreshSuccess=function(){if(this.isRefreshing()){if(this.refresh.oldBrowsiAd&&this.refresh.oldBrowsiAd.wrapper){this.removeAdMarkingFromDom();var e=void 0;(e=this.tableConfiguration?this.refresh.oldBrowsiAd.wrapper.parentElement:this.refresh.oldBrowsiAd.wrapper)&&(n.Utils.removeElement(e),n.Utils.reportBrowsiAdRemoved(e)),this.refresh.oldBrowsiAd.externalElement&&n.Utils.removeElement(this.refresh.oldBrowsiAd.externalElement)}this.refresh.requested=!1,this.refresh.refreshed=!0,this.refresh.impressionsEventCount=this.refresh.count,this.viewability={viewed:!1,duration:-1,startTime:void 0},this.logger.info("spot #"+this.adIndex+" refreshed with count "+this.refresh.count)}},e.prototype.updateBrowsiAdWrapper=function(){this.refresh.oldBrowsiAd&&this.refresh.oldBrowsiAd.wrapper&&(this.browsiAd.wrapper=this.refresh.oldBrowsiAd.wrapper,this.domId=this.refresh.oldBrowsiAd.wrapper.id,this.browsiAd.container=document.getElementById(this.refresh.oldBrowsiAd.wrapper.id.replace("adWrapper","adContainer"))||void 0)},e.prototype.initializeTypeIndex=function(e){var i=Math.min(e,t.AD_INDEX_LIMIT);this.typeIndex=i,this.demandIndex=i},e.prototype.isAllowedProvider=function(e){return"header_bidding"!==this.providerName||!!e.c.d},Object.defineProperty(e.prototype,"refreshInfo",{get:function(){var e=this;return{shouldRefresh:this.spotShouldRefresh(),rate:this.refresh.rate,doRefresh:function(){return e.refreshSpot()}}},enumerable:!1,configurable:!0}),e.prototype.sendViewedImpression=function(e){a.EventsService.get().sendViewedImpression(this,e)},e.prototype.sendViewedImpression100=function(e){a.EventsService.get().sendViewedImpression100(this)},e.getPositionType=function(e){var t=r.Profiler.get(),i=[],o=n.Utils.getElementSize(e),s=n.Utils.getElementPosition(e);if(t.domData&&t.domData.mainContent.inputElements&&t.domData.mainContent.start>-1){for(var a=t.domData.mainContent,l=a.inputElements[0].getBoundingClientRect().width,d=n.Utils.getElementPosition(a.inputElements[0]).left,p=0,c=s.left,u=Math.round(c+o.w),f=s.top,h=0;h<a.inputElements.length;h++)d=Math.min(d,n.Utils.getElementPosition(a.inputElements[h]).left),p=Math.max(p,d+l);c>=d&&u<=p?i.push("in-line"):(c<d&&u<=d&&i.push("left rail"),c>=p&&i.push("right rail")),f<a.start&&i.push("top"),f>a.endPosition&&i.push("bottom"),-1!=i.indexOf("in-line")&&-1==i.indexOf("bottom")&&-1==i.indexOf("top")&&i.push("within main content")}else i.push("out of main content");return 0===i.length&&i.push("unknown"),i},e.prototype.shouldWaitForUserEngagement=function(){return!n.Utils.isEngagedUser(this)&&!this.isEagerFirstFold()},e.prototype.subscribeToViewabilityService=function(){d.ViewabilityService.get().subscribe(this.buildViewabilityServiceObject(this.wholeConf)),d.ViewabilityService.get().subscribe(this.buildViewabilityServiceObject(this.conf))},e.prototype.isEagerFirstFold=function(){return this.profile.layouts.eagerFirstFold&&n.Utils.getElementFoldNumber(this.ref)<=2},e.prototype.buildViewabilityServiceObject=function(e){var t=this,i=e.minViewInitiator===this.wholeConf.minViewInitiator,o=i?this.sendViewedImpression100.bind(this):this.sendViewedImpression.bind(this);return{conf:e,refreshInfo:i?{shouldRefresh:!1,rate:0,doRefresh:function(){}}:this.refreshInfo,sendViewedImpression:o,type:d.ViewabilityObjectType.SPOT,getCoords:function(){return n.Utils.getSpotCoords(t)},getHeight:function(){return t.browsiAd.h},metrics:{duration:-1,startTime:null,viewed:!1},runCondition:function(){return t.isImpression},root:function(){return t}}},e.prototype.updateInSpotEngineTest=function(){var e=r.Profiler.get();e.debugMode&&e.spotEngineTest&&e.spotEngineTest.spots&&(e.spotEngineTest.spots[this.adIndex]=this.serialize())},e.prototype.serialize=function(){return{ref:this.ref,adIndex:this.adIndex,attemptIndex:this.attemptIndex,viewability:this.viewability,compatibleSizes:this.compatibleSizes,availableHeight:this.availableHeight,selectedSize:this.selectedSize,tableConfiguration:this.tableConfiguration,offsetTop:this.offsetTop,browsiAd:{iframe:this.browsiAd.iframe,wrapper:this.browsiAd.wrapper,container:this.browsiAd.container,admarking:this.browsiAd.admarking,w:this.browsiAd.w,h:this.browsiAd.h},adUnit:this.adUnit,isSaas:this.isSaas,providerName:this.providerName,isImpression:this.isImpression,slot:this.slot,domId:this.domId,logger:this.logger,refresh:this.refresh,adRequestBlockedSent:this.adRequestBlockedSent,isLazyLoading:this.isLazyLoading,spotRenderEnded:this.spotRenderEnded,waterfall:this.waterfall,positionTypes:this.positionTypes,type:this.type,typeIndex:this.typeIndex}},e.prototype.getIdentifier=function(){return"ai_"+this.adIndex+"_ati_"+(this.attemptIndex?this.attemptIndex:1)+"_rc_"+(this.refresh.active?this.refresh.count:0)},e.prototype.prepareResponseForFetch=function(e){return e},e.prototype.handleEmptyResponse=function(){return null},e.prototype.shouldUsePlaceholder=function(){var e;return this.profile.layouts.placeholder&&!!this.compatibleSizes.length&&(this.compatibleSizes.length>1||!this.isOneOnOne(this.compatibleSizes[0]))&&!(null===(e=this.refresh)||void 0===e?void 0:e.requested)},e.prototype.isOneOnOne=function(e){return 1===e.w&&1===e.h},e.prototype.getMaxSize=function(e){var t=0,i=0;return e.forEach((function(e){e.w>t&&(t=e.w),e.h>i&&(i=e.h)})),{w:t,h:i}},e.prototype.getPlaceholderSize=function(){var e=this.getMaxSize(this.compatibleSizes);if(n.Utils.isFluidSize(e)||this.isOneOnOne(e))return{w:n.Utils.getElementSize(this.ref).w,h:250};var t=e.w,i=e.h;switch(this.tags.positionTag){case"t":case"b":t=970,i=300;break;case"in":this.hasWrappedEmbedding()?(t=300,i=0):(i=300,t=970)}return{w:Math.min(e.w,t),h:Math.min(e.h,i)}},e.prototype.hasWrappedEmbedding=function(){return this.compatibleSizes.some((function(e){return e.optionalEmbeddings.includes("wrapped")||e.optionalEmbeddings.includes("left")||e.optionalEmbeddings.includes("right")}))},e.prototype.closePlaceholderAndRemove=function(){this.placeholder?this.placeholder.closePlaceholder(!0,this):this.removeAdFromDom()},e}();t.Spot=f},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SATargets=void 0,function(e){e.MC="MAIN_CONTENT",e.TOP="TOP",e.BOTTOM="BOTTOM",e.RIGHT="RIGHT_RAILS",e.LEFT="LEFT_RAILS"}(t.SATargets||(t.SATargets={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),o=i(1),r=i(13),s=i(30),a=i(26),l=function(){function e(){this.logger=new n.Logger("Dfp Detector"),this.googletag=window.googletag||{},this.googletag.cmd=this.googletag.cmd||[],this.isActive=!1}return e.start=function(){this.instance?this.instance.logger.info("already started"):(this.instance=new e,this.instance.logger.info("starting"),this.instance.run())},e.restart=function(){this.instance?this.instance.checkFetchedSlots():this.start()},e.setInactive=function(){this.instance.isActive=!1},e.prototype.run=function(){this.isActive=!0,this.listenToLazyAds(),this.checkFetchedSlots()},e.prototype.checkFetchedSlots=function(){var e=this;this.logger.debug("checkFetchedSlots"),this.checkCurrentSlots(),setTimeout((function(){return e.checkCurrentSlots()}),1e3)},e.prototype.checkCurrentSlots=function(){var e=this;this.logger.debug("checking current slots"),this.googletag.cmd.push((function(){e.googletag.pubads().getSlots().forEach((function(t){var i=document.getElementById(t.getSlotElementId());if(i){var n=e.resolveInnerMostSingleChild(i),s=o.Utils.getElementSize(n),a=o.Utils.getDfpAdSize(i);if(a&&(s=a.size,n=a.element),e.validationPassed(i,t)&&t.getResponseInformation())if(e.isRendered(n,s)){var l=e.buildFoundProvider(i,t,!1);r.default.get().addFoundProvider(l,t,s)}else e.handleThirdPartySlowAdRendering(i,t,!1)}}))}))},e.prototype.getProviderType=function(e){var t=e.getTargetingKeys();return-1!=t.indexOf("hb_pb")&&-1!=t.indexOf("hb_size")?"header_bidding":"dfp"},e.prototype.isRendered=function(e,t){return o.Utils.isVisible(e)&&s.DFP.isValidSize(t)},e.prototype.listenToLazyAds=function(){var e=this,t=a.PubAdsRefreshService.get();this.googletag.cmd.push((function(){e.googletag.pubads().addEventListener("slotRenderEnded",(function(i){var n=t&&t.handleRenderEnded(i);if(i=i,e.isActive&&!i.isEmpty){var s=document.getElementById(i.slot.getSlotElementId());if(s){var a=e.resolveInnerMostSingleChild(s),l=e.buildFoundProvider(s,i.slot,!0);e.validationPassed(s,i.slot)?e.isRendered(a,i.size)?r.default.get().addFoundProvider(l,i.slot,o.Utils.getDfpEventSize(i)):e.handleThirdPartySlowAdRendering(s,i.slot,!0):n?r.default.get().addFoundProvider(l,i.slot,o.Utils.getDfpEventSize(i),"browsi"):e.isForcedRefreshed(s,i.slot)&&r.default.get().addFoundProvider(l,i.slot,o.Utils.getDfpEventSize(i),"forced")}}}))}))},e.prototype.handleThirdPartySlowAdRendering=function(e,t,i){var n=this;this.waitForDeflating(e).then((function(o){n.logger.debug("deflated to ",o,e);var s=n.buildFoundProvider(e,t,i);r.default.get().addFoundProvider(s,t,o)})).catch((function(t){return n.logger.debug("did not deflate",t,e)}))},e.prototype.validationPassed=function(e,t){return!this.isBrowsiAd(t)&&!r.default.get().isDetectedAlready(e)&&(o.Utils.isInCurrentArticle(e)||o.Utils.isBetweenArticles(e)||o.Utils.isFixed(e))},e.prototype.isForcedRefreshed=function(e,t){return!this.isBrowsiAd(t)&&r.default.get().isDetectedAlready(e)&&(o.Utils.isInCurrentArticle(e)||o.Utils.isBetweenArticles(e)||o.Utils.isFixed(e))},e.prototype.isBrowsiAd=function(e){var t=e.getSlotElementId();return/^browsi_(ad.*)_ai_-?(\d+)_ati_(\d+).*$/.test(t)},e.prototype.resolveAdSize=function(e){for(var t,i=e;1===(t=this.getNonScriptChildren(i)).length;)i=t[0];return o.Utils.getElementSize(i)},e.prototype.resolveInnerMostSingleChild=function(e){for(var t,i=e;1===(t=this.getNonScriptChildren(i)).length;)i=t[0];return i},e.prototype.getNonScriptChildren=function(e){return Array.from(e.children).filter((function(e){return"SCRIPT"!==e.tagName}))},e.prototype.waitForDeflating=function(e){var t=this;return new Promise((function(i,n){var o=10;t.logger.debug("waiting for deflation",e);var r=setInterval((function(){var a=t.resolveAdSize(e);s.DFP.isValidSize(a)&&(clearInterval(r),i(a)),o--||(clearInterval(r),n(a))}),500)}))},e.prototype.buildFoundProvider=function(e,t,i){return{element:e,providerName:this.getProviderType(t),placementId:t.getSlotElementId(),adUnit:t.getAdUnitPath(),isLazyLoaded:i,isManualAd:!1}},e}();t.default=l},function(e,t,i){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.DFP=void 0;var r=i(22),s=i(3),a=i(0),l=i(1),d=i(15),p=i(19),c=i(25),u=function(e){function t(t){var i=e.call(this,t,"dfp")||this;return i.logger=new a.Logger("DFP"),i.hasFluidSizeSupport=!0,i}return o(t,e),t.isValidSize=function(e){return Array.isArray(e)?e[0]>this.minAdSize&&e[1]>this.minAdSize:e.w>this.minAdSize&&e.h>this.minAdSize},t.prototype.fetch=function(e,t){var i=this;return new Promise((function(n){i.logger.info("fetching spot "+i.spot.adIndex,i.spot),t.appendAndGetWrapper(i.spot).then((function(e){return i.addGPTScriptTag(e)})).then((function(t){return i.pushGoogleTagCommands(t,e)})).then((function(e){return n(e)})).catch((function(e){i.logger.error("fetching failed: ",e),n({status:"error"})}))}))},t.prototype.pushGoogleTagCommands=function(e,t){var i=this;return new Promise((function(n){d.Focus.get().waitForUserFocusWithAdBlock(i.spot).then((function(){var o=i.buildSizes(!0,i.spot),r=i.getGoogletag(e);r.cmd.push((function(){var a=i.getAdSelector(),l=r.defineSlot("/"+t.c.a.pubID+"/"+t.c.au,o,a).addService(r.pubads());i.spot.slot=l,i.setGoogleTagPrivacy(r),i.addKeyValues(t,l),i.logger.info("spot "+i.spot.adIndex+", definedSlot: "+l.getAdUnitPath()+", sizes:"+JSON.stringify(o)+", keyValue: "+JSON.stringify(l.getTargetingMap()));var d=setTimeout((function(){return i.handleAdMatchFalse(l,n,"timeout")}),t.c.t);r.pubads().addEventListener("slotRenderEnded",(function(e){return i.slotRenderEndedEvent(e,n,d,l)})),r.pubads().addEventListener("slotOnload",(function(e){return i.slotOnLoadEvent(e,t)})),i.display(r,a,l,t,!!e.iframe),s.EventsService.get().sendAdRequest(i.spot,i.providerName,o)}))}))}))},t.prototype.handleAdMatchFalse=function(e,t,i){(s.EventsService.get().sendAdMatchedEvent(this.spot,"dfp",!1,i),this.spot.isRefreshing())||(this.spot.isImpression=!1,this.getGoogletag(this.spot.browsiAd).destroySlots([e]));t({status:i||"failure"})},t.prototype.getGoogletag=function(e){return e.win&&e.win.googletag||{}},t.prototype.display=function(e,t,i,n,o){var r="false"===n.c.a.upc||!n.c.a.upc;o?(e.enableServices(),e.display(t)):(e.pubads().disableInitialLoad(),e.enableServices(),window.google_DisableInitialLoad?(e.display(t),e.pubads().refresh([i],{changeCorrelator:r})):(1===e.pubads().getSlots().length&&e.display(t),e.pubads().refresh([i],{changeCorrelator:r})))},t.prototype.slotRenderEndedEvent=function(e,t,i,n){n==e.slot&&(this.getAdSelector()===e.slot.getSlotElementId()?(this.spot.spotRenderEnded++,clearTimeout(i),this.isForcedRefresh()?this.handleFocedRefreshRenderEnded(e):this.handleRenderEnded(e,t)):this.spot.isRefreshing()&&clearTimeout(i))},t.prototype.handleFocedRefreshRenderEnded=function(e){s.EventsService.get().sendAdMatchedEvent(this.spot,"dfp",!e.isEmpty,"forced_refresh"),e.isEmpty||(s.EventsService.get().sendAdImpression(this.spot,this.providerName),this.spot.updateInSpotEngineTest())},t.prototype.handleRenderEnded=function(e,t){var i=l.Utils.getDfpEventSize(e);if(this.logger.info("dfp "+(e.isEmpty?"empty":JSON.stringify(i))+" for "+this.getAdSelector()+", au: "+e.slot.getAdUnitPath(),l.Utils.getSlotTargeting(e.slot)),e.isEmpty)this.handleAdMatchFalse(e.slot,t);else{if(this.spot.setSelectedSize(i),!this.spot.selectedSize)return t({status:"error"});this.spot.providerName=this.providerName,s.EventsService.get().sendAdMatchedEvent(this.spot,"dfp",!0),l.Utils.isNullOrUndefined(this.spot.selectedSize)?(this.logger.warn("No size match for spot: ",this.spot,e),t({status:"error"})):this.expandAd(this.spot,t)}c.default.get().waitForBrowsiAV(e.slot,this.spot)},t.prototype.isForcedRefresh=function(){return this.spot.spotRenderEnded>this.spot.attemptIndex&&!this.spot.isRefreshing()},t.prototype.slotOnLoadEvent=function(e,t){this.spot.slot==e.slot&&new p.default(this.spot,!!t.s,t.c.au).sendEvent("DFP slot loaded")},t.minAdSize=5,t}(r.Provider);t.DFP=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),o=i(8),r=function(){function e(e){this.resizeRAF=null,this.resizeListeners=[],this.isIE=null!=navigator.userAgent.match(/Trident/),this.resizeElement=e,this.obj=document.createElement("object"),this.logger=new n.Logger("ResizeListener"),this.logger.debug("set resize listener for",e)}return e.prototype.resizeListener=function(e){var t=this;this.resizeRAF&&window.cancelAnimationFrame(this.resizeRAF),this.resizeRAF=window.requestAnimationFrame((function(){t.resizeListeners.forEach((function(i){i.call(t.obj,e)}))}))},e.prototype.objectLoad=function(){var e,t=(null===(e=this.obj.contentDocument)||void 0===e?void 0:e.defaultView)||null;t&&(o.default.get().listen("resize",t,this.resizeListener.bind(this)),this.resizeListener.bind(this))},e.prototype.addResizeListener=function(e){this.resizeListeners.length||("static"==getComputedStyle(this.resizeElement).position&&(this.resizeElement.style.position="relative"),this.obj.setAttribute("style","display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; pointer-events: none; z-index: -999;"),this.obj.onload=this.objectLoad.bind(this),this.obj.type="text/html",this.isIE&&this.resizeElement.appendChild(this.obj),this.obj.data="about:blank",this.isIE||this.resizeElement.appendChild(this.obj)),this.resizeListeners.push(e)},e.prototype.removeResizeListener=function(e){var t,i;e?null===(t=this.resizeListeners)||void 0===t||t.splice(this.resizeListeners.indexOf(e),1):this.resizeListeners=[],!this.resizeListeners.length&&(null===(i=this.obj.contentDocument)||void 0===i?void 0:i.defaultView)&&(this.obj.contentDocument.defaultView.removeEventListener("resize",this.resizeListener),this.resizeElement.removeChild(this.obj))},e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),o=i(1),r=function(){function e(){this.logger=new n.Logger("BptBrowsiFunctions"),this.bptBrowsiFunctions=e.getBptBrowsiService()}return e.get=function(){return this._instance||(this._instance=new e),this._instance},e.getBptBrowsiService=function(){var e=o.Utils.getBrowsiTag();return e&&"object"==typeof e.__bbs?e.__bbs:null},e.prototype.getFoundPublisherAdData=function(e,t,i,n){var o={plid:t};switch(e){case"dfp":case"header_bidding":if(n)return this.invokeBptFunction({p:"dfp",args:{slot:n,rc:i}})||o;break;case"manual_ad":return this.invokeBptFunction({p:"manual_ad",args:{plid:t,rc:i}})||o}return o},e.prototype.invokeBptFunction=function(e){if(this.bptBrowsiFunctions&&"function"==typeof this.bptBrowsiFunctions.g_fpa_d)try{var t=this.bptBrowsiFunctions.g_fpa_d(e);return t.praw=parseFloat(t.praw),this.logger.info("request: ",e," response: ",t),t}catch(t){this.logger.info("failed to get data from bpt",e)}return null},e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClickTracker=void 0;var n=i(0),o=i(1),r=i(3),s=i(8),a=function(){function e(e,t){var i=this;this.logger=new n.Logger("ClickTracker"),this.counter=1,this.adData=t,this.mutationConfig={childList:!0,subtree:!0},this.isValidClick=!0,this.observer=new MutationObserver((function(e){return i.handleMutationFound(e)})),this.scanFrames(e)}return e.prototype.scanFrames=function(e){var t=this;o.Utils.querySelectorOnDocument(e,"iframe").filter((function(e){return o.Utils.isFriendlyIframe(e.element)})).map((function(e){return e.element})).forEach((function(e){return t.handelIframeFound(e)}))},e.prototype.handelIframeFound=function(e){var t=this,i=e.contentDocument||e.contentWindow&&e.contentWindow.document;i&&i.body&&i.body.children&&0!==i.body.children.length&&(s.default.get().listen("click",i,(function(i){t.logger.debug("ad clicked",i,e),t.handleClick(),t.observer.disconnect()})),this.scanFrames(e),this.observer.observe(i,this.mutationConfig))},e.prototype.handleMutationFound=function(e){var t=this;e.forEach((function(e){Array.from(e.addedNodes).forEach((function(e){"IFRAME"==e.nodeName&&t.handelIframeFound(e)}))}))},e.prototype.handleClick=function(){var e=this;this.isValidClick&&(r.EventsService.get().sendAdClicked(this.adData.isBrowsiAd,this.counter,this.adData.refreshCount,this.adData.adIndex,this.adData.demandIndex,this.adData.placementId),this.counter++,this.isValidClick=!1,setTimeout((function(){e.isValidClick=!0}),500))},e}();t.ClickTracker=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SRAResponseManager=void 0;var n=i(4),o=i(0),r=i(11),s=i(1),a=i(5),l=function(){function e(e,t){var i=this;this.logger=new o.Logger("SRAResponseManager"),this.response=e,this.spots={},this.configs={},a.SpotsUtils.getAllScanTypes().forEach((function(e){i.configs[e]=[],i.spots[e]=[]})),this.updateSpotsAndConfig(e,t)}return e.prototype.updateSpotsAndConfig=function(t,i){var o,r,s,l,d,p,c=this;a.SpotsUtils.getAllScanTypes().forEach((function(e){var t=i.filter((function(t){return t.type===e}));t.length&&(c.spots[e]=t.sort((function(e,t){return t.typeIndex-e.typeIndex})))})),(o=this.configs[n.SpotType.DYNAMIC_MC]).push.apply(o,e.generateConfigArray(t.c)),(r=this.configs[n.SpotType.FIXED_MC]).push.apply(r,e.generateConfigArray(t.fc)),(s=this.configs[n.SpotType.FIXED_TOP]).push.apply(s,e.generateConfigArray(t.ft)),(l=this.configs[n.SpotType.FIXED_BOTTOM]).push.apply(l,e.generateConfigArray(t.fb)),(d=this.configs[n.SpotType.FIXED_RIGHT_RAIL]).push.apply(d,e.generateConfigArray(t.rr)),(p=this.configs[n.SpotType.FIXED_LEFT_RAIL]).push.apply(p,e.generateConfigArray(t.rl)),this.configs[n.SpotType.DYNAMIC_RIGHT_RAIL]=this.configs[n.SpotType.FIXED_RIGHT_RAIL],this.configs[n.SpotType.DYNAMIC_LEFT_RAIL]=this.configs[n.SpotType.FIXED_LEFT_RAIL]},e.prototype.pop=function(e,t){var i=this.spots[e.type].indexOf(e),n=this.configs[e.type].findIndex((function(e){return e===t}));return i>-1&&n>-1?(e.demandIndex=this.configs[e.type][n].demandIndex,e.adUnit=this.configs[e.type][n].c.au,t.od=this.getPrediction(e),r.default.get().unsubscribe(this.spots[e.type].slice(i)),this.spots[e.type].length=i,this.configs[e.type].length=n,this.logger.info(e.type+" spot "+e.typeIndex+" matched demand "+e.demandIndex,t),t):(this.logger.debug("Couldn't match "+e.type+" spot "+e.typeIndex+" to response",t),null)},e.prototype.peek=function(e){var t=this.configs[e.type].length;if(t>0&&this.spots[e.type].includes(e)){var i=this.configs[e.type][t-1];return i.od=this.getPrediction(e),i}return this.logger.debug("No available demand response for "+e.type+" spot "+e.typeIndex),null},e.prototype.getPrediction=function(e){return this.response.ods&&this.response.ods[e.adIndex]},e.generateConfigArray=function(e){var t=[];for(var i in Object.keys(e))e.hasOwnProperty(i)&&t.push(Object.assign({},e[i],{demandIndex:Math.min(this.demandIndexLimit,Number(i))}));return t.sort((function(e,t){return t.demandIndex-e.demandIndex})),t},e.preProcessSRAResponse=function(e,t){var i=s.Utils.clone(e),o={dynamic:{tags:[n.SPOT_TAGS_MAP[n.SpotType.DYNAMIC_MC]],response:i.c},fixedMC:{tags:[n.SPOT_TAGS_MAP[n.SpotType.FIXED_MC]],response:i.fc},fixedBottom:{tags:[n.SPOT_TAGS_MAP[n.SpotType.FIXED_BOTTOM]],response:i.fb},fixedTop:{tags:[n.SPOT_TAGS_MAP[n.SpotType.FIXED_TOP]],response:i.ft},rightRail:{tags:[n.SPOT_TAGS_MAP[n.SpotType.DYNAMIC_RIGHT_RAIL],n.SPOT_TAGS_MAP[n.SpotType.FIXED_RIGHT_RAIL]],response:i.rr},leftRail:{tags:[n.SPOT_TAGS_MAP[n.SpotType.DYNAMIC_LEFT_RAIL],n.SPOT_TAGS_MAP[n.SpotType.FIXED_LEFT_RAIL]],response:i.rl}},r=function(e){for(var i=o[e],n=t.filter((function(e){return i.tags.some((function(t){return t.oldType===e.type}))})),r=function(e,t){var i=-1;return e.forEach((function(e){var t=a.SpotsUtils.getConf(e)||null;t&&t.maxItems>i&&(i=t.maxItems)})),i>-1?Math.min(i,t):t}(i.tags,n.length),l=0;l<r;l++)i.response[l]||(i.response[l]=s.Utils.clone(i.response[-1]));delete i.response[-1]};for(var l in o)r(l);return i},e.demandIndexLimit=99,e}();t.SRAResponseManager=l},function(e,t,i){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.HBProvider=void 0;var r=i(22),s=i(15),a=i(20),l=i(3),d=i(1),p=i(6),c=i(16),u=function(e){function t(t,i,n,o){var r=e.call(this,t,i)||this;return r.dfpTimeout=null,r.apsSize=null,r}return o(t,e),t.prototype.runHBCommands=function(e,t,i){var n=this;return new Promise((function(o,r){s.Focus.get().waitForUserFocusWithAdBlock(n.spot).then((function(){i(e,t,o,r)}))}))},t.prototype.buildAmazonPromise=function(e,t,i){var n=this;return this.hasAmazonBidder(e)&&!this.isRefreshDfpOnly()&&c.default.hasUserConsent?new Promise((function(o,r){n.appendApsToHead(i,e.c.a).then((function(i){var r=i.win.apstag,s=n.buildSizes(!1,n.spot),l=e.c.d;r.fetchBids({slots:[{slotID:t,slotName:n.getAdUnit(l),sizes:s}],timeout:l.t},(function(e){var i=e.find((function(e){return e.slotID===t}));n.logger.info("amazon bid: ",i),n.logger.apsLog(t,i);var r=d.Utils.toSize(i&&i.size);r.w>0&&r.h>0&&(n.apsSize=r);var s={im:!!i&&!!i.amzniid,s:[r],br:-1};return a.AuctionDataCollector.get().collectBidMatch(t,"aps",s),o()})),a.AuctionDataCollector.get().collectBidRequest("aps",t,{aps:a.AuctionDataCollector.get().buildSizesFromArray(s)}),setTimeout((function(){o()}),l.t)}))})):(a.AuctionDataCollector.get().collectBidRequest("aps",t,{}),Promise.resolve())},t.prototype.hasDfpBidder=function(e){return!!e.c.d},t.prototype.hasAmazonBidder=function(e){return!!e.c.a},t.prototype.appendApsToHead=function(e,i){var n=this;if(!i)return Promise.reject("No Config");var o=e.win;if(e.iframe)return this.injectApsTag(o,i,e);if(o.apstag&&"function"==typeof o.apstag.fetchBids){try{o.apstag.init(i)}catch(e){this.logger.error("could not init publisher apstag",e)}return Promise.resolve(e)}return t.apsInjectPromise||(t.apsInjectPromise=this.injectApsTag(o,i,e)),t.apsInjectPromise.then((function(){return n.logger.info("Using browsi injected apstag"),e}))},t.prototype.injectApsTag=function(e,t,i){return this.logger.info("Injecting apstag"),new Promise((function(n,o){var r=e.document.createElement("script");r.async=!0,r.setAttribute("src","//c.amazon-adsystem.com/aax2/apstag.js"),r.addEventListener("load",(function(){"function"==typeof e.apstag.init&&e.apstag.init(t),n(i)})),r.addEventListener("error",(function(){o(i)})),p.ResponseTimeCollector.get().measureScript("aps",r),e.document.head.appendChild(r)}))},t.prototype.isRefreshDfpOnly=function(){return this.spot.isRefreshing()&&this.spot.refresh.do},t.prototype.isForcedRefresh=function(){return this.spot.spotRenderEnded>this.spot.attemptIndex&&!this.spot.isRefreshing()},t.prototype.checkApsWin=function(e,t){try{var i=t.slot.getHtml();(i.includes("apstag.renderImp")||i.includes("amzn_win"))&&(this.apsSize&&this.spot.setSelectedSize(this.apsSize),l.EventsService.get().sendAPSWinner(this.spot))}catch(e){}},t.prototype.dfpTimeoutHandler=function(e,t,i){var n={im:!1,rsn:"timeout",s:[{w:-1,h:-1}],au:e.c.d.au};a.AuctionDataCollector.get().collectBidMatch(t,"dfp",n,!0),l.EventsService.get().sendAdMatchedEvent(this.spot,e.rt,!1,"timeout"),i({status:"timeout"})},t.prototype.runPreDfpHB=function(e,t){var i=d.Utils.getExternalFlowHandler("preDfpHB");if(i){this.logger.info("Invoking preDfpHB");try{p.ResponseTimeCollector.get().setRuleBySpot("preDfpHB",this.spot,!0),i(this.spot,e,t),p.ResponseTimeCollector.get().setRuleBySpot("preDfpHB",this.spot,!1)}catch(e){this.logger.error("preDfpHB failed",e)}}},t}(r.Provider);t.HBProvider=u},function(e,t,i){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.ScannedSpot=void 0;var r=function(e){function t(t,i,n,o,r,s,a){return e.call(this,t,r,i,n,o,s,a)||this}return o(t,e),t}(i(27).Spot);t.ScannedSpot=r},function(e,t,i){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.DirectSpot=void 0;var r=function(e){function t(t,i,n,o,r,s,a){return e.call(this,t,i,n,o,r,s,a)||this}return o(t,e),t}(i(27).Spot);t.DirectSpot=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EngagementService=void 0;var n=i(0),o=i(1),r=i(3),s=i(2),a=i(15),l=function(){function e(){this.isSubscribed=!1,this.timeoutObjId=null,this.logger=new n.Logger("EngagementService"),this.logger.info("initializing"),this.engagementCounter=0,this.lastScrollingDistance=0,this.lastEngagementReport=0,this.engagementsCounter=0,this.eventsBatchCounter=0,this.engagementsBatch=[],this.profile=s.Profiler.get(),this.isHidden=!1,this.hiddenTime=0,this.hiddenTimeDelta=0,this.outOfFocusTime=0,a.Focus.get().subscribe(this.onFocusChanged.bind(this))}return e.get=function(){return e._instance||(e._instance=new e),e._instance},e.prototype.subscribe=function(){var e=this;if(this.isSubscribed)this.logger.info("Already subscribed!");else{this.isSubscribed=!0;var t=this.profile.timeBetweenEngagementReports||2;this.setEventInterval(),this.timeoutObjId=setTimeout((function(){e.eventsSender(t)}),1e3*t)}},e.prototype.setEventInterval=function(){var e=this;this.eventSenderInterval=setInterval((function(){e.isSubscribed?e.isHidden||(e.eventsBatchCounter++,e.engagementsCounter++,e.engagementsBatch.push(e.buildEngagementData())):clearInterval(e.eventSenderInterval)}),1e3)},e.prototype.unsubscribe=function(){this.isSubscribed=!1,a.Focus.get().unsubscribe(),this.timeoutObjId&&clearTimeout(this.timeoutObjId)},e.unsubscribeIfNeeded=function(){e._instance&&e._instance.unsubscribe()},e.prototype.buildEngagementData=function(){var e=Date.now(),t=o.Utils.getScrollingDistance()-this.lastScrollingDistance,i=Math.abs(this.lastScrollingDistance?t:0),n=this.getTimeDelta(e),r={et:"general_engagement",c:this.engagementsCounter,dep:o.Utils.getScrollDepthPercentages(),po:o.Utils.getScrollingDistance(),pl:o.Utils.getPageHeight(),td:n,pd:i,sl:o.Utils.getWindowHeight(),now:o.Utils.getNowInSeconds(),lt:this.getLoadTime(),plt:this.getPageLoadTime(),to:o.Utils.getTimeOffset(),top:this.getTimeOnPage(),mcst:this.profile.domData?this.profile.domData.mainContent.start:-1,mcs:o.Utils.getMainContentSize(this.profile.domData),v:Math.round(i/(n/1e3))||0};return this.lastScrollingDistance=o.Utils.getScrollingDistance(),this.lastEngagementReport=e,r},e.prototype.eventsSender=function(e){var t=this;this.isSubscribed&&(!this.isHidden&&this.engagementsBatch.length>0&&(e=this.calculateNextEventSend(e),r.EventsService.get().sendEngagementReportEvent(this.engagementsBatch),this.engagementsBatch=[]),this.timeoutObjId=setTimeout((function(){t.eventsSender(e)}),1e3*e))},e.prototype.calculateNextEventSend=function(e){return this.eventsBatchCounter>=60&&(this.eventsBatchCounter=0,e+=2),(o.Utils.getTimeOffset()/1e3>=600||!o.Utils.getCookie("__browsiSessionID"))&&this.unsubscribe(),e},e.prototype.getTimeOnPage=function(){var e=o.Utils.getTimeOffset()/1e3,t=this.outOfFocusTime/1e3;return Number((e-t).toFixed(2))},e.prototype.getTimeDelta=function(e){var t=this.lastEngagementReport?e-this.lastEngagementReport:0;return this.hiddenTimeDelta>0&&(t=this.hiddenTimeDelta,this.hiddenTimeDelta=0),t},e.prototype.getLoadTime=function(){try{if(window.performance&&window.performance.timing.navigationStart>0&&window.performance.timing.domInteractive>0)return Math.floor(window.performance.timing.domInteractive-window.performance.timing.navigationStart)}catch(e){}return-1},e.prototype.getPageLoadTime=function(){try{if("complete"===document.readyState&&window.performance&&window.performance.timing.loadEventEnd>0&&window.performance.timing.domContentLoadedEventStart>0)return Math.floor(Math.abs(window.performance.timing.loadEventEnd-window.performance.timing.domContentLoadedEventStart))}catch(e){}return-1},e.prototype.onFocusChanged=function(e){if(this.isHidden=e,e)this.hiddenTime=Date.now(),clearInterval(this.eventSenderInterval);else{this.hiddenTime>0&&(this.outOfFocusTime=this.outOfFocusTime+(Date.now()-this.hiddenTime));var t=Date.now(),i=t-this.hiddenTime;this.hiddenTimeDelta=this.lastEngagementReport?t-this.lastEngagementReport-i:0,this.logger.info("Out Of focus time: "+this.outOfFocusTime/1e3+" seconds, time on page: "+this.getTimeOnPage()),this.setEventInterval()}},e}();t.EngagementService=l},function(e,t,i){e.exports=i(40)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(3),o=i(0),r=i(12),s=i(2),a=i(1),l=i(17),d=i(38),p=i(13),c=i(60),u=i(4);i(65);var f,h=i(8),g=i(5),m=i(66),y=i(6),v=function(){function e(){this.logger=new o.Logger("App.ts"),this.profile=s.Profiler.get(),s.Profiler.setLoadTime(f),this.logger.info("profile: ",this.profile),s.Profiler.detectAdBlocker((function(){return n.EventsService.get().sendAdBlockerEvent()}))}return e.prototype.run=function(){this.logger.info("started"),"bl"===this.profile.runMode?this.blocklistedRun():this.standardRun()},e.prototype.blocklistedRun=function(){this.logger.custom("Blocklisted mode",a.Utils.getLogStyle(48,"red","#000")),this.setUserEngagedListener(),n.EventsService.get().sendPageviewEvent(0,0,0,0,0,0),n.EventsService.get().sendSpotEngineDoneEvent()},e.prototype.standardRun=function(){var e=this;if(!this.profile.layouts.analysisMode&&!this.profile.identity.isBenchmarkPageview&&(new m.DemandTool,this.profile.layouts.fixedSpotsFirst)){this.logger.info("scanning fixed spots first");var t=r.default.instance.findSpots(u.FIXED_TAGS,(function(){}),!0);l.YieldClient.get().processSpots(t)}this.profile.layouts.analysisMode&&this.logger.custom("AnalysisMode ON",a.Utils.getLogStyle(18,"red","#000")),this.setUserEngagedListener(),this.profile.logEngagement&&d.EngagementService.get().subscribe();var i=a.Utils.getLoaderParams().sec.t;i?(this.logger.info("waiting "+i+"mc"),setTimeout((function(){e.desktopRunner()}),i)):this.desktopRunner()},e.prototype.initializeRun=function(){var e=this;return new Promise((function(t){var i="engineInitiator",n=a.Utils.getExternalFlowHandler(i);if(n)try{e.logger.info("executing "+i),y.ResponseTimeCollector.get().setRuleStart(i,e.profile.identity.pageviewId),n(a.Utils.getLoaderParams(),t)}catch(t){e.logger.error("failed to execute "+i,t)}else t()}))},e.prototype.desktopRunner=function(){var e=this;this.initializeRun().then((function(){return e.runPageView()}))},e.prototype.runPageView=function(){var e=this;if(y.ResponseTimeCollector.get().setRuleEnd("engineInitiator",this.profile.identity.pageviewId),this.profile.identity.isBenchmarkPageview)this.SendBenchmarkEvents();else{this.profile.domData=s.Profiler.collectDOMData(),g.SpotsUtils.rebuild();var t=this.isProfileValid(this.profile.domData),i=u.SCAN_SPOT_TAGS.filter((function(e){return!t.invalidTypes.includes(e.oldType)}));this.logger.info("types to scan",i.map((function(e){return e.oldType}))),t.errorMessages.length&&this.logger.warn("invalid profiles: ",t.errorMessages),a.Utils.isStickyActive()&&i.push(u.SPOT_TAGS_MAP[u.SpotType.STICKY]),i.length?this.checkAndHandleDcs(this.profile).catch((function(t){return e.logger.error("DCS: "+t)})).then((function(t){e.profile.layouts.fixedSpotsFirst&&(i=i.filter((function(e){return!u.FIXED_TAGS.includes(e)}))),e.findSpots(r.default.instance,i,t||void 0),p.default.get().scan(!0),a.Utils.buildBrowsiOutput(e.profile)})):(this.profile.state="error",this.logger.warn("Invalid profile",t.errorMessages),n.EventsService.get().sendPageviewEvent(0,0,0,0,0,0,t.errorMessages),n.EventsService.get().sendSpotEngineDoneEvent(),this.checkAndHandleDcs(this.profile))}p.default.get().scan(!0),a.Utils.buildBrowsiOutput(this.profile)},e.prototype.checkAndHandleDcs=function(e){var t=c.DcsFactory.buildDcs(e);return t?t.dcsObj&&"error"===e.state?t.detectUrlChangeOnly():t.prepareAndRunDcs():Promise.resolve()},e.prototype.findSpots=function(e,t,i){y.ResponseTimeCollector.get().setSingleStart("se");var n=e.findSpots(t,i,!1);y.ResponseTimeCollector.get().setSingleEnd("se"),n=n.filter((function(e){return e.type!==u.SpotType.STICKY})),l.YieldClient.get().handleSpots(n)},e.prototype.isProfileValid=function(e){var t=[],i=[];return u.SCAN_SPOT_TAGS.forEach((function(n){var o=g.SpotsUtils.getConf(n),r=s.Profiler.validateProfileForBehavior(e,n.oldType,o);!r.length&&g.SpotsUtils.isActive(n)||(t.push(n.oldType),i=i.concat(r.map((function(e){return n.oldType+"_"+e}))))})),{invalidTypes:t,errorMessages:i}},e.prototype.SendBenchmarkEvents=function(){this.logger.custom("Benchmark Mode",a.Utils.getLogStyle(30,"black","red")),n.EventsService.get().sendPageviewEvent(0,0,0,0,0,0),this.profile.state="done",n.EventsService.get().sendSpotEngineDoneEvent()},e.prototype.setUserEngagedListener=function(){var e=this;if(a.Utils.getScrollPosition().top>0)n.EventsService.get().sendUserEngagementEvent();else{var t=function(){e.logger.info("detected engagementScroll, send event"),h.default.get().removeListener("scroll",window.top,t),e.profile.isUserEngaged=!0,n.EventsService.get().sendUserEngagementEvent()};h.default.get().listen("scroll",window.top,t)}},e}();function S(){"interactive"!==document.readyState&&"complete"!==document.readyState||window._middyo.loaded||(window._middyo.loaded=!0,(new v).run())}n.EventsService.get().sendEngineLoadedEvent(),f=Date.now(),window.top.document.onreadystatechange=function(){return S()},window.top.document.addEventListener("readystatechange",(function(){return S()})),S()},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FixedHeaderService=void 0;var n=i(0),o=i(1),r=i(2),s=function(){function e(){var e=this;this.observer=null,this.noneFixedHeight=0,this.fixedHeight=0,this.isFixedHeader=!1;var t=r.Profiler.get().spotEngineConfig.fixedHeader;if(this.logger=new n.Logger("FixedHeader"),t&&"function"==typeof window.MutationObserver){var i=t.s,s=o.Utils.getCurrentContextElement().querySelector(i);s&&(this.updateProperties(s),this.noneFixedHeight=t.h,this.observer=new MutationObserver((function(t){e.updateProperties(s)})),this.observer.observe(s,{attributes:!0}),this.logger.info("found header, watching ",s,t))}}return e.prototype.updateProperties=function(e){var t=this.isHeaderFixed(e);this.isFixedHeader!==t&&this.logger.debug("header fixed: "+t),this.isFixedHeader=t,this.fixedHeight=this.isFixedHeader?o.Utils.getElementSize(e).h:0},e.get=function(){return e._instance||(this._instance=new e),e._instance},e.prototype.getFixedHeaderSize=function(){return this.fixedHeight},e.prototype.getNoneFixedHeaderSize=function(){return this.isFixedHeader?this.noneFixedHeight:0},e.prototype.isHeaderFixed=function(e){return e&&o.Utils.isPositionFixed(e)},e}();t.FixedHeaderService=s},function(e,t,i){"use strict";var n=this&&this.__spreadArrays||function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<i;t++)for(var r=arguments[t],s=0,a=r.length;s<a;s++,o++)n[o]=r[s];return n};Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultSpotsStrategy=void 0;var o=i(0),r=i(2),s=i(1),a=i(5),l=i(4),d=function(){function e(){var e,t;this.logger=new o.Logger("SpotsStrategy"),this.profile=r.Profiler.get(),this.maxItems=(null===(e=a.SpotsUtils.getConf(l.SPOT_TAGS_MAP[l.SpotType.DYNAMIC_MC]))||void 0===e?void 0:e.maxSpots)||0,this.logger.custom("spots strategy: default",s.Utils.getLogStyle(18,"black","green")),this.logger.custom("Allow narrow ads to break: true, Allow narrow ads wrap: "+!!(null===(t=this.profile.domData)||void 0===t?void 0:t.allowNarrowWrap)+" ",s.Utils.getLogStyle(18,"white","blue"))}return e.prototype.stopScanning=function(e){return this.maxItems===this.filterSpotsBy(e,"narrow","wrapped",!1).length},e.prototype.selectSpots=function(e){var t=this.maxItems,i=[],o=[],r=this.filterSpotsBy(e,"narrow","wrapped",!0,t);this.logger.debug("selected narrow spots with wrap: ",r),(t-=r.length)>0&&(i=this.filterSpotsBy(e,"narrow","break",!0,t,r),this.logger.debug("selected narrow spots with break: ",i),t-=i.length),t>0&&(o=this.filterSpotsBy(e,"wide","break",!0,t,n(r,i)),this.logger.debug("selected wide spots with break: ",o));var a=s.Utils.sortSpotsByOffsetTop.apply(s.Utils,n(r,i,o)).slice(0,this.maxItems);return(a=this.assignWrappingDirection(a)).forEach((function(e,t){e.initializeTypeIndex(t)})),a},e.prototype.selectEmbeddings=function(e){return e.forEach((function(e){e.compatibleSizes.forEach((function(e){e.selectedEmbedding=e.optionalEmbeddings.includes("wrapped")?"wrapped":"break"}))})),e},e.prototype.filterSpotsBy=function(e,t,i,n,o,r){var s=e.filter((function(e){return(!r||!r.includes(e))&&e.compatibleSizes.filter((function(e){return e.adSizeType===t&&e.optionalEmbeddings.includes(i)})).length>0}));return o&&Number.isInteger(o)&&o<s.length&&(s=s.slice(0,o)),n&&(s=this.selectEmbeddings(s)),s},e.prototype.getWrapType=function(){return"random"===this.profile.spotEngineConfig.embedType?Math.random()>.5?"left":"right":this.profile.spotEngineConfig.embedType},e.prototype.assignWrappingDirection=function(e){var t=this;return e.forEach((function(e){e.compatibleSizes.forEach((function(e){"wrapped"===e.selectedEmbedding&&(e.selectedEmbedding=t.getWrapType())}))})),e},e}();t.DefaultSpotsStrategy=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),o=i(1),r=i(10),s=i(2),a=function(){function e(){this.titleSelectors=["h1","h2","h3","h4","h5","h6","header"],this.oneLineSelectors=["span","div","p"],this.minDistance=60,this.logger=new n.Logger("ContentTitle"),this.excludeElements=this.getExcludeElements(s.Profiler.get().spotEngineConfig.pageLayoutSA.ex),this.titlesOnPage=this.collectTitles(),this.logger.debug("titles",this.titlesOnPage),this.titlesLocations=this.getLocations(this.titlesOnPage),this.oneLinersOnPage=this.collectOneLiners(),this.logger.debug("one liners",this.oneLinersOnPage),this.oneLinersLocations=this.getLocations(this.oneLinersOnPage)}return e.get=function(){return e.instance||(this.instance=new e),e.instance},e.prototype.collectTitles=function(e){var t=this;return Array.from((e||document).querySelectorAll(this.titleSelectors.join(","))).filter((function(e){return o.Utils.isVisible(e)&&r.default.instance.isInMainContent(e)&&!t.isExcluded(e)}))},e.prototype.collectOneLiners=function(){var e,t=this,i=null===(e=s.Profiler.get().domData)||void 0===e?void 0:e.mainContent.inputElements;return(i&&i.length?i:[]).reduce((function(e,i){var n=.4*o.Utils.getElementSize(i).w;return e.concat(Array.from(i.querySelectorAll(t.oneLineSelectors.join(","))).filter((function(e){return t.isOneLine(e,n)})))}),[])},e.prototype.isOneLine=function(e,t){return o.Utils.isVisible(e)&&e.offsetHeight<24&&e.offsetWidth>t&&e.innerText.trim().length>0&&!this.isExcluded(e)},e.prototype.getLocations=function(e){var t=this;return e.map((function(e){return t.getBottomOffset(e)})).filter((function(e){return e>0})).sort((function(e,t){return e-t}))},e.prototype.isTitle=function(e){return-1!=this.titlesOnPage.indexOf(e)},e.prototype.isCollectedOneLine=function(e){return-1!=this.oneLinersOnPage.indexOf(e)},e.prototype.isBetweenTitleAndContent=function(e){var t=o.Utils.getElementPosition(e).top;if(t<1)return!1;if(this.isTitle(e)){var i=this.getBottomOffset(e),n=this.titlesLocations.indexOf(i);if(n&&this.titlesLocations[n-1])return t-this.titlesLocations[n-1]<this.minDistance}for(var r=this.titlesLocations.length;r>=0;r--)if(t>=this.titlesLocations[r])return t-this.titlesLocations[r]<this.minDistance;return!1},e.prototype.isAfterOneLiner=function(e){var t=o.Utils.getElementPosition(e).top;if(t<1)return!1;if(this.isCollectedOneLine(e)){var i=this.getBottomOffset(e),n=this.oneLinersLocations.indexOf(i);if(n&&this.oneLinersLocations[n-1])return t-this.oneLinersLocations[n-1]<this.minDistance}for(var r=this.oneLinersLocations.length;r>=0;r--)if(t>=this.oneLinersLocations[r])return t-this.oneLinersLocations[r]<this.minDistance;return!1},e.prototype.getBottomOffset=function(e){return o.Utils.getElementPosition(e).top+o.Utils.getElementSize(e).h},e.prototype.getExcludeElements=function(e){return e&&e.length?Array.from(document.querySelectorAll(e.join(","))):[]},e.prototype.isExcluded=function(e){var t=-1!=this.excludeElements.indexOf(e);return t&&this.logger.debug("element is excluded from page auto layout stay away by config",e),t},e}();t.default=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DemandRequestType=void 0,function(e){e.SRA="sra",e.SINGLE="single"}(t.DemandRequestType||(t.DemandRequestType={}))},function(e,t,i){"use strict";var n=this&&this.__spreadArrays||function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<i;t++)for(var r=arguments[t],s=0,a=r.length;s<a;s++,o++)n[o]=r[s];return n};Object.defineProperty(t,"__esModule",{value:!0}),t.DemandManager=void 0;var o=i(0),r=i(34),s=i(2),a=i(11),l=i(3),d=i(4),p=i(10),c=i(1),u=i(14),f=i(46),h=i(49),g=i(17),m=i(19),y=i(33),v=i(5),S=i(6),b=function(){function e(){this.logger=new o.Logger("YieldClient"),this.profile=s.Profiler.get()}return e.get=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.processResponse=function(e,t,i){var n=this;switch(t.rt){case"provider":case"empty_api":var o=t;this.logger.info("getDemand returned ["+o.c.p+"] for spot "+e.adIndex+", attempt "+e.attemptIndex,t),e.adUnit="generic_js"===o.c.p?"NA":o.c.au;break;case"header_bidding":var s=t;this.logger.info("getDemand returned ["+s.c.b+"] for spot "+e.adIndex+", attempt "+e.attemptIndex,t),e.adUnit="NA";break;case"ix":var l=t;this.logger.info("getDemand returned ["+l.c.b+"] for spot "+e.adIndex+", attempt "+e.attemptIndex,t),e.adUnit="NA";break;case"sra":if(this.sraManager)0===i.indexOf(e)&&this.sraManager.updateSpotsAndConfig(t,i);else{var d=t;this.sraManager=new r.SRAResponseManager(d,i)}}this.isLazySpot(e)&&!e.isRefreshing()?a.default.get().subscribe(e,(function(){return n.matchResponse(t,e)})):this.matchResponse(t,e)},e.prototype.matchResponse=function(t,i){var n=e.isSRAResponse(t)&&this.sraManager?this.sraManager.peek(i):t;if(n){var o=this.checkSpotViolations(i,n);if(o.length)this.handleAdRequestBlock(i,o);else{var r=e.isSRAResponse(t)&&this.sraManager?this.sraManager.pop(i,n):n;if(r){if("empty"===r.rt)return this.logger.info("getDemand returned empty, waterfall ended for spot "+i.adIndex),void i.closePlaceholderAndRemove();i.isSaas=r.s,i.isAutoSize=this.isAutoSizeResponse(r,i),this.fetch(r,i)}}}},e.prototype.fetch=function(e,t){var i=this,n=f.EmbeddingFactory.getEmbedder(e,t),o=h.ProviderFactory.getProvider(e,t);o&&n?(e=t.prepareResponseForFetch(e),this.runPreFetch(t,e,o).then((function(){return t.updateRefreshDetails(e),o.fetch(e,n)})).then((function(n){var r;switch(i.logger.logWaterfallDetails(t,e,n.status),n.status){case"failure":case"timeout":case"not_supported":case"generic_snippet_error":t.isRefreshing()&&t.removeAdFromDom(),t.updateBrowsiAdWrapper(),g.YieldClient.get().nextWaterfallStep(t);break;case"success":if(i.logger.info("SUCCESS"),"dfp"!==o.providerName)new m.default(t,!!e.s,t.adUnit||"").waitForSpotMeasurable();t.type===d.SpotType.API&&c.Utils.dispatchBrowsiAdEvent("browsiAdImpression",t.ref),s.Profiler.get().siteInfo.enableMoat&&u.Embedder.injectMoat(t),t.browsiAd.wrapper&&new y.ClickTracker(t.browsiAd.wrapper,{refreshCount:t.refresh.count,adIndex:t.adIndex,isBrowsiAd:!0,demandIndex:t.demandIndex}),null===(r=t.placeholder)||void 0===r||r.removePlaceholderStyle(t.browsiAd),i.runPostFetch(t,e)}})).catch((function(e){i.logger.info("Failed fetching "+t.type+" spot "+t.typeIndex+":",e)}))):g.YieldClient.get().nextWaterfallStep(t)},e.prototype.isLazySpot=function(e){return a.default.isLazyConfiguredForSpotType(e)&&e.isLazyLoading},e.isSRAResponse=function(e){return"sra"===e.rt},e.prototype.handleAdRequestBlock=function(e,t){var i;e.adRequestBlockedSent||t.length&&(this.logger.info("spot "+e.adIndex+" blocked: "+t.map((function(e){return e.reason})).join(",")),l.EventsService.get().sendAdBlockedEvent(e,t)),null===(i=e.placeholder)||void 0===i||i.closePlaceholder(!1,e)},e.prototype.checkSpotViolations=function(e,t){var i,o=[],r=e.optimizeViewability&&this.checkViewabilityThreshold(e.tags,t);if(r&&o.push(r),e.type===d.SpotType.API)return o;n([d.SpotType.DYNAMIC_MC],v.DYNAMIC_RAIL_TYPES).includes(e.type)&&!e.isRefreshing()&&((i=p.default.instance.checkStayAwayViolation(e))&&o.push(i));"provider"===t.rt&&"generic_js"===t.c.p&&((i=this.checkGenericExpectedSizeViolation(e,t))&&o.push(i));return c.Utils.isPositionedDisconnected(e.ref,document.body)&&o.push({reason:"spot_not_exists"}),e.type===d.SpotType.STICKY&&(e.compatibleSizes.length||o.push({reason:"no_compatible_sizes"})),o},e.prototype.checkViewabilityThreshold=function(e,t){var i,n,o=v.SpotsUtils.getViewabilityThreshold(e);if(o){var r=(null===(n=null===(i=null==t?void 0:t.od)||void 0===i?void 0:i[50])||void 0===n?void 0:n.p)&&Number(t.od[50].p);if(r&&r>0&&r<o)return{reason:"prediction_threshold",message:""}}return null},e.prototype.checkGenericExpectedSizeViolation=function(e,t){var i={w:Number(t.c.a.expectedWidth),h:Number(t.c.a.expectedHeight)};return e.isSizeInSpot(i)?null:{reason:"generic_js_size_mismatch"}},e.prototype.runPreFetch=function(e,t,i){var n=this;return new Promise((function(o,r){var s=c.Utils.getExternalFlowHandler("preFetchAsync");if(s){n.logger.info("Invoking preFetchAsync");try{return S.ResponseTimeCollector.get().setRuleBySpot("preFetchAsync",e,!0),void s(e,i,t,o,r)}catch(e){n.logger.error("Failed to execute preFetchAsync",e),o()}}else{var a=c.Utils.getExternalFlowHandler("preFetch");if(a){n.logger.info("Invoking preFetch");try{S.ResponseTimeCollector.get().setRuleBySpot("preFetch",e,!0),a(e,i,t),S.ResponseTimeCollector.get().setRuleBySpot("preFetch",e,!1)}catch(e){n.logger.error("Failed to execute preFetch",e)}}o()}})).then((function(){S.ResponseTimeCollector.get().setRuleBySpot("preFetchAsync",e,!1)}))},e.prototype.runPostFetch=function(e,t){var i=c.Utils.getExternalFlowHandler("postFetch");if(i)try{this.logger.info("executing postFetch"),S.ResponseTimeCollector.get().setRuleBySpot("postFetch",e,!0),i(e,t),S.ResponseTimeCollector.get().setRuleBySpot("postFetch",e,!1)}catch(e){this.logger.error("failed to execute postFetch",e)}},e.prototype.isAutoSizeResponse=function(e,t){if(t.type===d.SpotType.STICKY)return!1;var i=e.c.d||e.c,n=i.a&&i.a.autoSize;return!!n&&"true"===n},e}();t.DemandManager=b},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EmbeddingFactory=void 0;var n=i(47),o=i(48),r=function(){function e(){}return e.getEmbedder=function(e,t){if("header_bidding"===e.rt||"ix"===e.rt)return e.c.if?new o.default(t):new n.default(t);if("empty_api"===e.rt)return new n.default(t);var i=e;switch(i.c.p){case"dfp":case"generic_js":return"true"===i.c.a.inIFrame?new o.default(t):new n.default(t);default:return null}},e}();t.EmbeddingFactory=r},function(e,t,i){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(t){return e.call(this,t)||this}return o(t,e),t.prototype.appendAndGetWrapper=function(e){var t=this;return new Promise((function(i,n){if(e.ref&&e.ref.parentNode){var o=document.createElement("div"),r=document.createElement("div");o.setAttribute("spotType",e.type),o.setAttribute("typeIndex",""+e.typeIndex),r.id=t.containerId,o.id=t.wrapperId,o.appendChild(r),o.style.display="none",t.appendAd(e,o),e.browsiAd.win=window,e.browsiAd.wrapper=o,e.browsiAd.container=r,e.browsiAd.iframe=null,t.setPlaceholder(e,o,r),i(e.browsiAd)}else n(e.browsiAd)}))},t}(i(14).Embedder);t.default=r},function(e,t,i){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(t){return e.call(this,t)||this}return o(t,e),t.prototype.appendAndGetWrapper=function(e){var t=this;return new Promise((function(i,n){if(e.ref&&e.ref.parentNode){var o=!1,r=document.createElement("div"),s=document.createElement("iframe");r.setAttribute("spotType",e.type),r.setAttribute("typeIndex",""+e.typeIndex),r.appendChild(s),r.id=t.wrapperId,s.id=t.containerId,s.scrolling="no",s.frameBorder="0",s.marginHeight="0",s.marginWidth="0",s.height="0",s.width="0",s.style.display="none",t.setIframePlaceholderStyle(s,e),s.onload=function(){if(!o){if(o=!0,s.contentDocument){s.contentDocument.open(),s.contentDocument.close();var n=s.contentDocument.createElement("div");n.setAttribute("id",t.containerId),s.contentDocument.body.appendChild(n),e.browsiAd.win=s.contentWindow||void 0,e.browsiAd.wrapper=r,e.browsiAd.container=n,e.browsiAd.iframe=s,t.setPlaceholder(e,r,n)}s.contentWindow.__cmp=window.top.__cmp,i(e.browsiAd)}},s.onerror=function(){n(e.browsiAd)},t.appendAd(e,r)}else n(e.browsiAd)}))},t.prototype.setIframePlaceholderStyle=function(e,t){if(t.placeholder){var i=t.getPlaceholderSize();e.width=""+i.w,e.height=""+i.h,e.style.display="block"}},t}(i(14).Embedder);t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProviderFactory=void 0;var n=i(30),o=i(50),r=i(53),s=i(54),a=function(){function e(){}return e.getProvider=function(e,t){switch(e.rt){case"empty_api":return new n.DFP(t);case"provider":var i=e;switch(i.c.p){case"dfp":return new n.DFP(t);case"generic_js":return new r.GenericJS(t,i);default:return null}case"header_bidding":var a=e;return t.providerName="header_bidding",new o.HeaderBiddingDA(t,a.c.b,a.c.d);case"ix":var l=e;return t.providerName="ix",new s.IX(t,l.c.b,l.c.d)}return null},e}();t.ProviderFactory=a},function(e,t,i){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.HeaderBiddingDA=void 0;var r=i(51),s=i(0),a=i(3),l=i(1),d=i(8),p=i(19),c=i(20),u=i(25),f=function(e){function t(t,i,n){var o=e.call(this,t,"header_bidding",i,n)||this;return o.logger=new s.Logger("HB"),o.dfpTimeout=null,o}return o(t,e),t.prototype.handleHBCommands=function(e,t,i,n){var o=this;if(this.pbjsInstance){var r=t.container&&t.container.id||"";this.isRefreshDfpOnly()||(this.adUnit=this.buildAdUnit(r,e.od)),this.runPreAuction(this.spot,this.adUnit),this.pbjsInstance.que.push((function(){a.EventsService.get().sendAdRequest(o.spot,o.providerName,o.buildSizes(!1,o.spot))}));var s=this.buildHBPromise(this.pbjsInstance,e,this.adUnit,t,i),l=this.buildAmazonPromise(e,r,t);Promise.all([s,l]).then((function(){if(o.hasDfpBidder(e))o.requestDfpBid(t,e,i);else{var n=o.hasBidders(e)?o.getPrebidWinner(t):null;a.EventsService.get().sendAdMatchedEvent(o.spot,"header_bidding",!!n,void 0,o.getHighestBidCpm(o.adUnit&&o.adUnit.code)),n?(o.spot.setSelectedSize({w:n.width,h:n.height}),o.renderAd(t,n,i)):i({status:"failure"})}})).catch((function(e){o.logger.error(e),n("failure")}))}},t.prototype.buildHBPromise=function(e,i,n,o,r){var s=this;return this.isRefreshDfpOnly()||!this.hasBidders(i)?(c.AuctionDataCollector.get().collectBidRequest("prebid",n&&n.code||this.spot.browsiAd.container.id,{}),Promise.resolve()):new Promise((function(a,l){e.que=e.que||[],e.que.push((function(){e.setConfig(s.getConfig()),s.addCustomConfigByProvider(i.c.b),d.default.get().listenToPbjs("bidWon",e,(function(e){return e&&s.winnerHandler(e,s.spot,r)})),e.addAdUnits(n),!s.spot.browsiAd.iframe&&t.isBidTimeoutListenerActive||(s.spot.browsiAd.iframe||(t.isBidTimeoutListenerActive=!0),e.onEvent("bidTimeout",(function(e){e.forEach((function(e){if(s.isBrowsiAuction(e.auctionId)){c.AuctionDataCollector.get().collectBidMatch(n.code,e.bidder,{im:!1,rsn:"timeout",s:[{w:-1,h:-1}]})}}))}))),e.requestBids({adUnitCodes:[n.code],auctionId:s.profile.identity.articleId,bidsBackHandler:function(e){s.collectBidMatched(n.code),e?s.logger.hbLog(e[n.code],n.code,s.getNoBids(n.code),s.getPrebidWinner(o)):(s.logger.info("bidsBackHandler - Empty BidResponses"),c.AuctionDataCollector.get().collectBidRequest("prebid",n.code,{})),a()}})}))}))},t.prototype.requestDfpBid=function(e,t,i){var n=this;this.addGPTScriptTag(e).then((function(){var o=e.container?e.container.id:"",r=n.buildSizes(!0,n.spot);n.pushGPTCommands(r,e,t,o),n.dfpTimeout=setTimeout((function(){return n.dfpTimeoutHandler(t,o,i)}),t.c.d.t),e.win.googletag.cmd.push((function(){e.win.googletag.pubads().addEventListener("slotRenderEnded",(function(r){return n.slotRenderEndedHandler(t,o,e,r,i)})),e.win.googletag.pubads().addEventListener("slotOnload",(function(e){return n.slotOnLoadHandler(e,t)}))}))}))},t.prototype.slotRenderEndedHandler=function(e,t,i,n,o){if(this.isBrowsiSlot(n,t)){if(this.dfpTimeout&&clearTimeout(this.dfpTimeout),this.spot.spotRenderEnded++,this.isForcedRefresh())return this.handleForcedRefreshSlotRenderEnded(e,n,o);var r=l.Utils.getDfpEventSize(n);return this.sendDfpBidMatched(e,!n.isEmpty,r),this.logger.info("dfp(da) "+(n.isEmpty?"empty":JSON.stringify(r))+", au: "+n.slot.getAdUnitPath(),l.Utils.getSlotTargeting(n.slot)),n.isEmpty?(this.destroyDFPSlots(i),a.EventsService.get().sendAdMatchedEvent(this.spot,"header_bidding",!1,void 0,this.getHighestBidCpm(this.adUnit&&this.adUnit.code||n.slot.getSlotElementId())),o({status:"failure"})):(this.spot.selectedSize||this.spot.setSelectedSize(r),a.EventsService.get().sendAdMatchedEvent(this.spot,"header_bidding",!0,void 0,this.getHighestBidCpm(this.adUnit&&this.adUnit.code||n.slot.getSlotElementId())),this.checkApsWin(t,n),u.default.get().waitForBrowsiAV(n.slot,this.spot),this.expandAd(this.spot,o,{adUnit:"NA",provider:"header_bidding"}))}},t.prototype.winnerHandler=function(e,t,i){this.adUnit&&this.adUnit.code===e.adUnitCode&&(this.dfpTimeout&&clearTimeout(this.dfpTimeout),t.setSelectedSize({w:e.width,h:e.height}),t.selectedSize&&this.spot.expand(t.selectedSize).then((function(){a.EventsService.get().sendHBWinner(t,e),i({status:"success",highestBidName:e.bidder})})))},t.prototype.sendDfpBidMatched=function(e,t,i){var n={im:t,s:[i],br:-1,au:e.c.d.au};c.AuctionDataCollector.get().collectBidMatch(this.spot.browsiAd.container.id,"dfp",n,!0)},t.prototype.pushGPTCommands=function(e,t,i,n){var o=this,r=i.c.d,s=r.a,a="false"===s.upc||!s.upc,l=t.win.googletag||{};l.cmd=l.cmd||[],this.runPreDfpHB(i,this.adUnit),l.cmd.push((function(){if(o.pbjsInstance){var d=l.defineSlot("/"+s.pubID+"/"+r.au,e,n);o.logger.info("spot "+o.spot.adIndex+", definedSlot: "+d.getAdUnitPath()+", sizes:"+JSON.stringify(e)+", keyValue: "+JSON.stringify(d.getTargetingMap())),d.addService(l.pubads()),o.setGoogleTagPrivacy(l),o.addKeyValues(i,d),l.pubads().enableSingleRequest(),l.enableServices(),o.pbjsInstance.que.push((function(){o.pbjsInstance.setTargetingForGPTAsync([n]),o.hasAmazonBidder(i)&&t.win.apstag&&t.win.apstag.setDisplayBids(),t.iframe?l.display(n):(googletag.display(t.wrapper?t.wrapper.id:n),googletag.pubads().refresh([d],{changeCorrelator:a}));var e=o.spot.selectedSize&&o.spot.selectedSize.h&&o.spot.selectedSize.w?{w:o.spot.selectedSize.w,h:o.spot.selectedSize.h}:{w:-1,h:-1};c.AuctionDataCollector.get().collectDFPBidRequest(o.spot,{dfp:[e]})})),o.spot.slot=d}}))},t.prototype.destroyDFPSlots=function(e){this.spot.slot&&e.win&&(e.win.googletag.destroySlots([this.spot.slot]),this.spot.slot=void 0)},t.prototype.onAuctionInit=function(e){var t={},i=e.adUnitCodes[0];i&&this.isBrowsiAuction(e.auctionId)&&(e.bidderRequests.forEach((function(e){e.bids.forEach((function(i){t[e.bidderCode]=c.AuctionDataCollector.get().buildSizesFromArray(i.sizes)}))})),c.AuctionDataCollector.get().collectBidRequest("prebid",i,t))},t.prototype.hasBidders=function(e){return!(!e.c.b||!e.c.b.length)},t.prototype.handleForcedRefreshSlotRenderEnded=function(e,t,i){var n={im:!t.isEmpty,s:[l.Utils.getDfpEventSize(t)],br:-1,rsn:"forced_refresh",au:e.c.d.au};if(c.AuctionDataCollector.get().collectBidMatch(this.spot.browsiAd.container.id,"dfp",n,!0),a.EventsService.get().sendAdMatchedEvent(this.spot,"header_bidding",!t.isEmpty,"forced_refresh",this.getHighestBidCpm(this.adUnit&&this.adUnit.code||t.slot.getSlotElementId())),!t.isEmpty){var o=this.spot.selectedSize?this.spot.selectedSize.selectedEmbedding:void 0;a.EventsService.get().sendAdImpression(this.spot,this.spot.providerName||"header_bidding",o),this.spot.updateInSpotEngineTest()}i({status:"success",args:{adUnit:"NA",provider:"header_bidding"}})},t.prototype.getHighestBidCpm=function(e){if(e&&this.pbjsInstance){var t=this.getHighestBidById(this.pbjsInstance.getBidResponses(),e);return t?t.cpm:void 0}},t.prototype.slotOnLoadHandler=function(e,t){this.spot.slot==e.slot&&new p.default(this.spot,!!t.s,t.c.d&&t.c.d.au||"").sendEvent("DFP DA slot loaded")},t.prototype.isBrowsiAuction=function(e){return e===this.profile.identity.articleId},t.isBidTimeoutListenerActive=!1,t}(r.PrebidJs);t.HeaderBiddingDA=f},function(e,t,i){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.PrebidJs=void 0;var s=i(0),a=i(2),l=i(1),d=i(3),p=i(8),c=i(20),u=i(35),f=i(6),h=i(16),g=function(e){function t(t,i,n,o){var r=e.call(this,t,i)||this;return r.bidConfigs=r.getBidConfig(t,n,o),r.iframeDoc=null,r.usingBrowsiPbjs=!1,r.adUnit=null,r.logger=new s.Logger("PrebidJs"),r.profile=a.Profiler.get(),r}return o(t,e),t.prototype.fetch=function(e,i){var n=this;return new Promise((function(o){n.logger.info("fetching spot "+n.spot.adIndex,n.spot),i.appendAndGetWrapper(n.spot).then((function(e){return n.addPrebidScriptTag(e)})).then((function(i){return!i.iframe&&t.isListenersActive||(n.listenToErrors(),n.listenToAuctionInit(),i.iframe||(t.isListenersActive=!0)),n.runHBCommands(e,i,n.handleHBCommands.bind(n))})).then((function(e){return o(e)})).catch((function(e){"not_supported"===e?(n.logger.error("fetching failed: Prebid version "+(n.pbjsInstance?n.pbjsInstance.version:"")+" is not supported",n.pbjsInstance),d.EventsService.get().sendAdBlockedEvent(n.spot,[{reason:"prebid_version_unsupported",message:""+(n.pbjsInstance?n.pbjsInstance.version:"")}]),o({status:"not_supported"})):(n.logger.error("fetching failed: ",e),o("error"))}))}))},t.prototype.buildIframe=function(e,t,i){var n=e.document.createElement("iframe");return n.id=t,n.width=""+i.width,n.height=""+i.height,n.scrolling="no",n.frameBorder="0",n},t.prototype.getHighestBidById=function(e,t){var i=e[t]&&e[t].bids;return i?i.reduce((function(e,t){return e.cpm>t.cpm?e:t})):null},t.prototype.addPrebidScriptTag=function(e){var i=this;if(!e.win)return Promise.reject("error");if(!this.profile.siteInfo.prebidPath)return Promise.reject("no_url");if(e.iframe)return this.injectPbjs(e),Promise.resolve(e);var n=this.getInstanceName(e);return this.pbjsInstance=e.win[n],this.isUnsupportedVersion(this.pbjsInstance)&&Promise.reject("not_supported"),this.pbjsInstance&&(t.isBrowsiPbjs||this.pbjsInstance.version)?t.isBrowsiPbjs?(this.logger.info("using browsi existing "+n),this.usingBrowsiPbjs=!0,Promise.resolve(e)):new Promise((function(t,o){i.pbjsInstance.que=i.pbjsInstance.que||[],i.pbjsInstance.que.push((function(){i.isUnsupportedVersion(i.pbjsInstance)?o("not_supported"):(i.logger.info("Using publisher "+n),t(e))}))})):(this.injectPbjs(e),t.isBrowsiPbjs=!0,Promise.resolve(e))},t.prototype.listenToAuctionInit=function(){var e=this;this.pbjsInstance&&this.pbjsInstance.que.push((function(){p.default.get().listenToPbjs("auctionInit",e.pbjsInstance,e.onAuctionInit.bind(e))}))},t.prototype.listenToErrors=function(){var e=this;this.pbjsInstance&&this.pbjsInstance.que.push((function(){e.pbjsInstance.onEvent("auctionDebug",(function(i){var n;if("ERROR"===i.type){var o=i.arguments.length>0?Array.from(i.arguments).join(" "):"",r=t.isBrowsiPbjs?e.profile.siteInfo.prebidPath||"":"publisherPbjs-"+(null===(n=e.pbjsInstance)||void 0===n?void 0:n.version);d.EventsService.get().sendPrebidErrorEvent(o,r)}}))}))},t.prototype.isUnsupportedVersion=function(e){return!!e&&!!e.version&&0===e.version.indexOf("v0")},t.prototype.getInstanceName=function(e){return e.iframe?"pbjs":this.profile.siteInfo.prebidData&&this.profile.siteInfo.prebidData.g||"pbjs"},t.prototype.injectPbjs=function(e){if(e.win){this.logger.info("Injecting Browsi Pbjs"),this.usingBrowsiPbjs=!0,e.win.pbjs=e.win.pbjs||{},this.pbjsInstance=e.win.pbjs,this.pbjsInstance&&(this.pbjsInstance.que=this.pbjsInstance.que||[]);var t=e.win.document.createElement("script");t.async=!0,t.setAttribute("src",this.profile.siteInfo.prebidPath),f.ResponseTimeCollector.get().measureScript("pbd",t),e.win.document.head.appendChild(t)}},t.prototype.buildAdUnit=function(e,t){var i=this;t&&t[50]&&t[50].sp&&this.bidConfigs.forEach((function(e){e.params[i.browsiViewability50Key]=t[50].p}));var n={};return this.bidConfigs.forEach((function(e){"unruly"===e.bidder&&(n=i.buildVideoMediaType(e)),e.browsiSpot=i.spot.adIndex})),{code:e,mediaTypes:r({banner:{sizes:this.buildSizes(!1,this.spot)}},n),bids:this.bidConfigs}},t.prototype.getConfig=function(){var e={enableSendAllBids:!0,debug:this.profile.debugMode};return this.usingBrowsiPbjs&&(e=Object.assign(e,r(r(r(r({},this.getUserIdConfig()),this.getSupplyChainConfig()),h.default.prebidConf),this.getPriceGranularityConfig()))),this.logger.info("Using Prebid configuration:",e),e},t.prototype.getPriceGranularityConfig=function(){var e=this.profile.siteInfo.prebidData&&this.profile.siteInfo.prebidData.pg,t=e&&e.n||"auto";return"custom"===t&&e&&e.v?{priceGranularity:JSON.parse(e.v)}:"custom"===t?{priceGranularity:"auto"}:{priceGranularity:t}},t.prototype.getUserIdConfig=function(){return this.profile.siteInfo.prebidData&&this.profile.siteInfo.prebidData.um?{userSync:JSON.parse(this.profile.siteInfo.prebidData.um)}:{}},t.prototype.getSupplyChainConfig=function(){return this.profile.siteInfo.prebidData&&this.profile.siteInfo.prebidData.s?{schain:JSON.parse(this.profile.siteInfo.prebidData.s)}:{}},t.prototype.renderAd=function(e,t,i){var n;if(e.win&&e.container&&e.container.id){var o=this.buildIframe(e.win,e.container.id,t);if(((null===(n=e.iframe)||void 0===n?void 0:n.contentDocument)?e.iframe.contentDocument.body:e.container).appendChild(o),this.pbjsInstance&&t.adId&&o.contentWindow)return this.pbjsInstance.renderAd(o.contentWindow.document,t.adId),this.expandAd(this.spot,i);i({status:"failure"})}},t.prototype.getBidResponses=function(e){var t=this.pbjsInstance&&this.pbjsInstance.getBidResponses()[e];return t?t.bids:[]},t.prototype.collectBidMatched=function(e){var t=this.getBidResponses(e),i={};t.forEach((function(t){var n={im:Number(t.cpm)>0,s:[{w:t.width,h:t.height}],br:Number(t.cpm)};t.currency&&(n.brc=t.currency),t.requestTimestamp&&t.responseTimestamp&&(n.reqt=t.requestTimestamp,n.rest=t.responseTimestamp),i[t.bidder]=i[t.bidder]||[],i[t.bidder]=i[t.bidder].concat(n.s),c.AuctionDataCollector.get().collectBidMatch(e,t.bidder,n)}));var n=[];this.getNoBids(e).forEach((function(t){if(!t.bidderRequestId||!n.includes(t.bidderRequestId)){var o=i[t.bidder]||[];t.bidderRequestId&&n.push(t.bidderRequestId);var r={im:!1,rsn:"no_bid",s:c.AuctionDataCollector.get().buildSizesFromArray(t.sizes).filter((function(e){return!o.some((function(t){return t.w===e.w&&t.h===e.h}))}))};0!==r.s.length&&c.AuctionDataCollector.get().collectBidMatch(e,t.bidder,r)}})),c.AuctionDataCollector.get().sendBidMatches(e)},t.prototype.getNoBids=function(e){if(this.pbjsInstance&&this.pbjsInstance.getNoBids&&"function"==typeof this.pbjsInstance.getNoBids){var t=this.pbjsInstance.getNoBids()[e];return t?t.bids:[]}return[]},t.prototype.getBidConfig=function(e,t,i){var n=this;return t&&t.reduce((function(t,o){switch(o.a&&n.handleBidAlias(o.a,o.bc.bidder),n.getBidName(o)){case"pulsepoint":return t.concat(n.buildPulsepointBids(o,e));case"ix":return t.concat(n.buildIndexExchangeBids(o,e));case"pubmatic":return t.concat(n.buildPubmaticBids(o,e));case"ias":return t.concat(n.buildIASBids(o,i));default:return t.concat([o.bc])}}),[])||[]},t.prototype.handleBidAlias=function(e,i){var n=this,o=this.spot.browsiAd.iframe,r=t.activeBidAlias[e]&&t.activeBidAlias[e]===i,s=o||!r;this.pbjsInstance&&s&&(o||(t.activeBidAlias[e]=i),this.pbjsInstance.que.push((function(){n.pbjsInstance.aliasBidder(e,i)})))},t.prototype.buildVideoMediaType=function(e){var t=e.params["video-context"],i=e.params["video-width"],n=e.params["video-height"];return t&&i&&n?{video:{context:t,playerSize:[[i,n]]}}:{}},t.prototype.buildPulsepointBids=function(e,t){return t.compatibleSizes.map((function(t){return{bidder:e.bc.bidder,params:r(r({},e.bc.params),{cf:l.Utils.sizeToString(t)})}}))},t.prototype.buildIndexExchangeBids=function(e,t){return t.compatibleSizes.map((function(t){return{bidder:e.bc.bidder,params:r(r({},e.bc.params),{size:[t.w,t.h]})}}))},t.prototype.buildPubmaticBids=function(e,t){return t.compatibleSizes.map((function(t){return{bidder:e.bc.bidder,params:{publisherId:e.bc.params.publisherId,adSlot:e.bc.params.adSlot+"@"+l.Utils.sizeToString(t)}}}))},t.prototype.buildIASBids=function(e,t){return[{bidder:e.bc.bidder,params:Object.assign(e.bc.params,{adUnitPath:this.getAdUnitPath(t)})}]},t.prototype.getBidName=function(e){return e.a?e.a:e.bc.bidder},t.prototype.addCustomConfigByProvider=function(e){var t=this;e&&e.forEach((function(e){if(t.pbjsInstance)switch(t.getBidName(e)){case"pubmatic":case"aardvark":t.pbjsInstance.setConfig({userSync:{filterSettings:{iframe:{bidders:"*",filter:"include"}}}});break;case"ias":t.pbjsInstance.bidderSettings.ias={alwaysUseBid:!0,sendStandardTargeting:!1,suppressEmptyKeys:!0,adserverTargeting:[{key:"adt",val:function(e){return e.adt}},{key:"alc",val:function(e){return e.alc}},{key:"dlm",val:function(e){return e.dlm}},{key:"drg",val:function(e){return e.drg}},{key:"hat",val:function(e){return e.hat}},{key:"off",val:function(e){return e.off}},{key:"vio",val:function(e){return e.vio}},{key:"fr",val:function(e){return e.fr}},{key:"id",val:function(e){return e.slots[e.adUnitCode].id}},{key:"vw",val:function(e){return e.slots[e.adUnitCode].vw}},{key:"grm",val:function(e){return e.slots[e.adUnitCode].grm}},{key:"pub",val:function(e){return e.slots[e.adUnitCode].pub}}]}}}))},t.prototype.getPrebidWinner=function(e){if(e.container&&e.container.id&&this.pbjsInstance){var t=e.container.id;return this.pbjsInstance&&this.pbjsInstance.getHighestCpmBids().find((function(e){return e.adUnitCode===t}))||null}return null},t.prototype.onAuctionInit=function(e){},t.isBrowsiPbjs=!1,t.isListenersActive=!1,t.activeBidAlias={},t}(u.HBProvider);t.PrebidJs=g},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CollectorPipeStatus=void 0,function(e){e.PENDING="pending",e.COMPLETE="complete"}(t.CollectorPipeStatus||(t.CollectorPipeStatus={}))},function(e,t,i){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.GenericJS=void 0;var r=i(22),s=i(0),a=i(3),l=i(1),d=i(6),p=function(e){function t(t,i){var n=e.call(this,t,"generic_js")||this;n.logger=new s.Logger("GenericJS");var o=i.c.a;n.isJs="true"===o.isJS,n.snippetUrl=o.url,n.isCallback="true"===o.withCallback,n.callbackInvoked=!1;var r={w:Number(o.expectedWidth),h:Number(o.expectedHeight)};return n.expectedSize=t.findSize(r),n}return o(t,e),t.prototype.fetch=function(e,t){var i=this;return new Promise((function(n,o){return a.EventsService.get().sendAdRequest(i.spot,i.providerName,[]),t.appendAndGetWrapper(i.spot).then((function(t){return d.ResponseTimeCollector.get().setSingleStart("rs","gjs"),l.Utils.xhrPromise(i.snippetUrl).then((function(e){if(d.ResponseTimeCollector.get().setSingleEnd("rs","gjs"),e.status&&200===e.status)return e.responseText;throw new Error("no response")})).then((function(o){return d.ResponseTimeCollector.get().setSingleStart("gjs"),i.runSnippet(t,o,e,n)})).then((function(o){return d.ResponseTimeCollector.get().setSingleEnd("gjs"),i.handleResult(o,t,e,n)})).catch((function(e){d.ResponseTimeCollector.get().setSingleEnd("gjs"),a.EventsService.get().sendAdMatchedEvent(i.spot,i.providerName,!1),n({status:"generic_snippet_error",args:{provider:"generic_js",adUnit:"NA"}})}))})).catch((function(e){i.logger.error(e),a.EventsService.get().sendAdMatchedEvent(i.spot,i.providerName,!1),n({status:"generic_snippet_error",args:{provider:"generic_js",adUnit:"NA"}})}))}))},t.prototype.runSnippet=function(e,t,i,n){var o=this;return this.isCallback&&this.assignBrowsiCallbackToWindow(e,n),new Promise((function(n,r){if(e.container){e.container.className=e.container.id;var s=t.replace(/<DIV_ID>/g,""+e.container.id).replace(/<SPOT_INDEX>/g,o.spot.adIndex.toString()).replace(/<DEMAND_INDEX>/g,o.spot.demandIndex.toString()).replace(/<BROWSI_VIEWABILITY_PREDICTION>/g,i.od&&i.od[50]?o.getBrowsiViewability(i.od[50]):"NA");s&&o.expectedSize&&o.spot.expand(o.expectedSize).then((function(){if(o.isJs)e.win.eval(s),n({status:"success"});else if(e.container){e.container.innerHTML=s;var t=l.Utils.findAllChildrenScripts(e.container);o.copyAndAppendScriptTag(e.container,t,n,r)}})).catch((function(e){o.logger.error(e),r({status:"generic_snippet_error"})}))}else r({status:"error"})}))},t.prototype.copyAndAppendScriptTag=function(e,t,i,n){Array.from(t).forEach((function(t){var i=document.createElement("script");Array.from(t.attributes).forEach((function(e){i.setAttribute(e.name,e.value)})),t.parentElement&&t.parentElement.removeChild(t),i.text=t.text,e.appendChild(i)})),i({status:"success"})},t.prototype.assignBrowsiCallbackToWindow=function(e,t){var i=this;window.top["browsiCallback_"+this.spot.adIndex]=function(n){i.callbackInvoked=!0,i.logger.info("spot: ",i.spot),n?(a.EventsService.get().sendAdMatchedEvent(i.spot,i.providerName,!1),t({status:"failure"})):i.handleAd(e,t)}},t.prototype.handleResult=function(e,t,i,n){var o=this;if(t.container&&"success"===e.status)if(this.isAdInViewport().then((function(e){e&&o.sendAdInViewEvent(o.spot)})),this.isCallback)setTimeout((function(){return o.onCallbackTriggered(t,n)}),i.c.t);else{var r=!1;t.container.style.display="block";var s=setInterval((function(){var e=l.Utils.getElementSize(t.container);e.w>0&&e.h>0&&(clearInterval(s),r=!0,o.onCallbackTriggered(t,n))}),200);setTimeout((function(){r||(clearInterval(s),a.EventsService.get().sendAdMatchedEvent(o.spot,o.providerName,!1),n({status:"failure"}))}),i.c.t)}},t.prototype.onCallbackTriggered=function(e,t){this.callbackInvoked||this.handleAd(e,t)},t.prototype.handleAd=function(e,t){var i=l.Utils.getElementSize(e.container);i.h<1?(this.logger.info("spot "+this.spot.adIndex+" has height < 1"),a.EventsService.get().sendAdMatchedEvent(this.spot,this.providerName,!1),l.Utils.removeElement(this.spot.browsiAd.wrapper),t({status:"failure"})):(a.EventsService.get().sendAdMatchedEvent(this.spot,this.providerName,!0),this.expectedSize&&(this.spot.selectedSize=Object.assign({},this.expectedSize,i),this.spot.browsiAd.h=this.spot.selectedSize.h,this.spot.browsiAd.w=this.spot.selectedSize.w,this.expandAd(this.spot,t)),t({status:"success",args:{adUnit:"NA",provider:"generic_js"}}))},t}(r.Provider);t.GenericJS=p},function(e,t,i){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.IX=void 0;var r=i(0),s=i(3),a=i(1),l=i(19),d=i(20),p=i(35),c=i(2),u=i(6),f=function(e){function t(t,i,n){var o=e.call(this,t,"ix",i,n)||this;return o.usingBrowsiIX=!1,o.logger=new r.Logger("IX_HB"),o.dfpTimeout=null,o.ixPath=c.Profiler.get().siteInfo.ixPath,o.ixInstance=window.headertag,o}return o(t,e),t.prototype.fetch=function(e,t){var i=this;return e.c.d?new Promise((function(n){i.logger.info("fetching spot "+i.spot.adIndex,i.spot),t.appendAndGetWrapper(i.spot).then((function(e){return i.addIXScriptTag(e)})).then((function(t){return i.runHBCommands(e,t,i.handleHBCommands.bind(i))})).then((function(e){return n(e)})).catch((function(e){i.logger.error("fetching failed: ",e),n({status:"error",args:e})}))})):Promise.reject({status:"error",args:"No DFP Provider"})},t.prototype.handleHBCommands=function(e,t,i,n){var o=this;if(this.ixInstance&&t.container){s.EventsService.get().sendAdRequest(this.spot,this.providerName,this.buildSizes(!0,this.spot));var r=e;if(this.isRefreshDfpOnly())this.requestDfpBid(t,r,i);else{var a=t.container.id;this.runPreAuction(this.spot),this.buildAmazonPromise(r,a,t).then((function(){o.requestDfpBid(t,r,i)})).catch((function(e){o.logger.error(e),n("failure")}))}}},t.prototype.pushGPTCommands=function(e,t,i,n){var o=this,r=i.c.d,s=r.a,a="false"===s.upc||!s.upc;this.ixInstance=t.win.headertag,this.isRefreshDfpOnly()&&(t.win.headertag=t.win.googletag);var l=t.win.googletag||{};l.cmd=l.cmd||[],this.runPreDfpHB(i,null),l.cmd.push((function(){if(o.ixInstance){var p=o.spot.selectedSize&&o.spot.selectedSize.h&&o.spot.selectedSize.w?{w:o.spot.selectedSize.w,h:o.spot.selectedSize.h}:{w:-1,h:-1};t.win.googletag.pubads().addEventListener("slotRequested",(function(e){return o.handleSpotRequested(e,t,p)})),t.win.googletag.pubads().addEventListener("slotResponseReceived",(function(e){return o.handleSpotResponse(e,t)}));var c=l.defineSlot("/"+s.pubID+"/"+r.au,e,n);c.addService(l.pubads()),o.setGoogleTagPrivacy(l),o.addKeyValues(i,c),l.pubads().enableSingleRequest(),l.enableServices(),o.ixInstance.cmd.push((function(){(o.hasAmazonBidder(i)&&t.win.apstag&&t.win.apstag.setDisplayBids(),t.iframe)?o.ixInstance.display(n):(googletag.pubads().disableInitialLoad(),googletag.enableServices(),googletag.pubads().isInitialLoadDisabled()?(o.ixInstance.display(n),o.ixInstance.pubads().refresh([c],{changeCorrelator:a})):(1===googletag.pubads().getSlots().length&&o.ixInstance.display(n),o.ixInstance.pubads().refresh([c],{changeCorrelator:a})));d.AuctionDataCollector.get().collectDFPBidRequest(o.spot,{dfp:[p]})})),o.spot.slot=c}}))},t.prototype.addIXScriptTag=function(e){var i=this;if(!e.win)return Promise.reject("error");var n=this.getInstanceName(e);return this.ixInstance=e.win[n],this.ixInstance&&this.ixInstance.apiReady?Promise.resolve(e):this.profile.siteInfo.ixPath?e.iframe?(this.injectIX(e),Promise.resolve(e)):this.ixInstance?t.isBrowsiIX?(this.logger.info("using browsi existing "+n),this.usingBrowsiIX=!0,Promise.resolve(e)):new Promise((function(t,o){i.ixInstance.cmd=i.ixInstance.cmd||[],i.ixInstance.cmd.push((function(){i.logger.info("Using publisher "+n),t(e)}))})):(this.injectIX(e),t.isBrowsiIX=!0,Promise.resolve(e)):Promise.reject("no_url")},t.prototype.injectIX=function(e){if(e.win){this.logger.info("Injecting Browsi IX"),this.usingBrowsiIX=!0,e.win.headertag=e.win.headertag||{},this.ixInstance=e.win.headertag,this.ixInstance&&(this.ixInstance.cmd=this.ixInstance.cmd||[]);var t=e.win.document.createElement("script");t.async=!0,t.setAttribute("src",this.profile.siteInfo.ixPath),u.ResponseTimeCollector.get().measureScript("ix",t),e.win.document.head.appendChild(t)}},t.prototype.requestDfpBid=function(e,t,i){var n=this;this.addGPTScriptTag(e).then((function(){var o=e.container?e.container.id:"",r=n.buildSizes(!0,n.spot);n.pushGPTCommands(r,e,t,o),n.dfpTimeout=setTimeout((function(){return n.dfpTimeoutHandler(t,o,i)}),t.c.d.t),e.win.googletag.cmd.push((function(){e.win.googletag.pubads().addEventListener("slotRenderEnded",(function(r){return n.slotRenderEndedHandler(t,o,e,r,i)})),e.win.googletag.pubads().addEventListener("slotOnload",(function(e){return n.slotOnLoadHandler(e,t)}))}))}))},t.prototype.slotRenderEndedHandler=function(e,t,i,n,o){if(this.isBrowsiSlot(n,t)){if(this.dfpTimeout&&clearTimeout(this.dfpTimeout),this.spot.spotRenderEnded++,this.isForcedRefresh())return this.handleForcedRefreshSlotRenderEnded(e,n,o);var r=a.Utils.getDfpEventSize(n);return this.sendDfpBidMatched(e,!n.isEmpty,r),this.logger.info("dfp(da) "+(n.isEmpty?"empty":JSON.stringify(r))+", au: "+n.slot.getAdUnitPath(),a.Utils.getSlotTargeting(n.slot)),n.isEmpty?(this.destroyDFPSlots(i),s.EventsService.get().sendAdMatchedEvent(this.spot,"ix",!1,void 0),o({status:"failure"})):(this.spot.selectedSize||this.spot.setSelectedSize(r),s.EventsService.get().sendAdMatchedEvent(this.spot,"ix",!0,void 0),this.checkApsWin(t,n),this.expandAd(this.spot,o,{adUnit:"NA",provider:"ix"}))}},t.prototype.sendDfpBidMatched=function(e,t,i){var n={im:t,s:[i],br:-1,au:e.c.d.au};d.AuctionDataCollector.get().collectBidMatch(this.spot.browsiAd.container.id,"dfp",n,!0)},t.prototype.destroyDFPSlots=function(e){this.spot.slot&&e.win&&(e.win.googletag.destroySlots([this.spot.slot]),this.spot.slot=void 0)},t.prototype.handleForcedRefreshSlotRenderEnded=function(e,t,i){var n={im:!t.isEmpty,s:[a.Utils.getDfpEventSize(t)],br:-1,rsn:"forced_refresh",au:e.c.d.au};if(d.AuctionDataCollector.get().collectBidMatch(this.spot.browsiAd.container.id,"dfp",n,!0),s.EventsService.get().sendAdMatchedEvent(this.spot,"ix",!t.isEmpty,"forced_refresh"),!t.isEmpty){var o=this.spot.selectedSize?this.spot.selectedSize.selectedEmbedding:void 0;s.EventsService.get().sendAdImpression(this.spot,this.spot.providerName||"ix",o),this.spot.updateInSpotEngineTest()}i({status:"success",args:{adUnit:"NA",provider:"ix"}})},t.prototype.slotOnLoadHandler=function(e,t){this.spot.slot==e.slot&&new l.default(this.spot,!!t.s,t.c.d&&t.c.d.au||"").sendEvent("DFP DA slot loaded")},t.prototype.getInstanceName=function(e){return"headertag"},t.prototype.handleSpotRequested=function(e,t,i){this.isBrowsiSlot(e,t.container?t.container.id:"")&&(d.AuctionDataCollector.get().collectDFPBidRequest(this.spot,{dfp:[i]}),this.logger.info("slotRequested "+e.slot.getSlotElementId()+" "+e.slot.getAdUnitPath(),e))},t.prototype.handleSpotResponse=function(e,t){this.isBrowsiSlot(e,t.container?t.container.id:"")&&this.logger.info("slotResponseReceived "+e.slot.getSlotElementId()+" "+e.slot.getAdUnitPath(),e)},t.isBrowsiIX=!1,t}(p.HBProvider);t.IX=f},function(e,t,i){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.DynamicSpot=void 0;var r=i(36),s=i(9),a=i(4),l=i(2),d=function(e){function t(t,i,n,o,r,d){var p,c={positionTag:((p={})[a.SpotType.DYNAMIC_MC]={index:0,positionTag:"in"},p[a.SpotType.DYNAMIC_RIGHT_RAIL]={index:300,positionTag:"r"},p[a.SpotType.DYNAMIC_LEFT_RAIL]={index:400,positionTag:"l"},p)[i].positionTag,typeTag:s.TypeTag.DYNAMIC,oldType:i},u=l.Profiler.get().spotEngineConfig.tryInsideTables;return e.call(this,t,n,o,r,c,d,u)||this}return o(t,e),t}(r.ScannedSpot);t.DynamicSpot=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),o=i(57),r=i(4),s=i(1),a=i(3),l=function(){function e(e){this.logger=new n.Logger("PlaceholderService"),this.size=e,this.active=!1}return e.prototype.openPlaceholder=function(e){e.browsiAd.container&&(this.active=!0,this.observer=new o.default(e.browsiAd.container,.25,1e3),this.observer.observe().then((function(){a.EventsService.get().sendPlaceholderViewed(e)})))},e.prototype.stopObserving=function(){var e;null===(e=this.observer)||void 0===e||e.clearObserver(),this.observer=void 0},e.prototype.closePlaceholder=function(e,t){t.browsiAd.container&&this.active&&(t.type!==r.SpotType.STICKY&&this.isChangingViewport(t.browsiAd)?this.logger.debug("placeholder changes viewport, keep open"):(this.deactivatePlaceholder(),a.EventsService.get().sendPlaceholderClosed(t),e&&t.removeAdFromDom()))},e.prototype.isChangingViewport=function(e){var t=e.iframe||e.container,i=s.Utils.getElementPosition(t).top,n=s.Utils.getElementSize(t).h;return i<s.Utils.getScrollPosition().bottom-n/2},e.prototype.removePlaceholderStyle=function(e){var t=e.container;t.style.removeProperty("width"),t.style.removeProperty("height"),t.style.removeProperty("margin"),t.style.removeProperty("background-color"),this.deactivatePlaceholder()},e.prototype.deactivatePlaceholder=function(){this.active=!1,this.stopObserving()},e}();t.default=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),o=function(){function e(e,t,i){void 0===i&&(i=1),this.logger=new n.Logger("IntersectionHandler"),this.element=e,this.threshold=t,this.duration=i,this.observer=this.initObserver()}return e.prototype.initObserver=function(){var e={threshold:[0,this.threshold]};return new IntersectionObserver(this.observationCallback.bind(this),e)},e.prototype.observe=function(){var e=this;return this.logger.debug("observe",this.element),this.observer.observe(this.element),new Promise((function(t){e.resolver=t}))},e.prototype.observationCallback=function(e){var t,i=this,n=e[0];n.intersectionRatio>this.threshold&&(t=Date.now(),i.durationInterval=setInterval((function(){Date.now()>=t+i.duration&&(clearInterval(i.durationInterval),i.observationDone())}),10)),0===n.intersectionRatio&&clearInterval(this.durationInterval)},e.prototype.observationDone=function(){this.logger.info(this.threshold+"% of the element",this.element,"was in view for "+this.duration+" ms or more. stop observing"),this.clearObserver(),this.resolver()},e.prototype.clearObserver=function(){clearInterval(this.durationInterval),this.observer.unobserve(this.element),this.observer.disconnect()},e}();t.default=o},function(e,t,i){"use strict";var n,o,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.FixedSpot=void 0;var s=i(36),a=i(9),l=i(4),d=((o={})[l.SpotType.FIXED_MC]={index:600,positionTag:"in"},o[l.SpotType.FIXED_TOP]={index:100,positionTag:"t"},o[l.SpotType.FIXED_BOTTOM]={index:200,positionTag:"b"},o[l.SpotType.FIXED_RIGHT_RAIL]={index:700,positionTag:"r"},o[l.SpotType.FIXED_LEFT_RAIL]={index:800,positionTag:"l"},o),p=function(e){function t(t,i,n,o,r,s){var l={positionTag:d[r].positionTag,typeTag:a.TypeTag.FIXED,oldType:r};return e.call(this,t,i,n,o,l,s)||this}return r(t,e),t}(s.ScannedSpot);t.FixedSpot=p},function(e,t,i){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.StickySpot=void 0;var r=i(37),s=i(9),a=i(4),l=i(23),d=i(5),p=function(e){function t(t,i){var n,o=this,r={positionTag:"s",typeTag:s.TypeTag.STICKY,oldType:a.SpotType.STICKY},p=null===(n=d.SpotsUtils.getConf(a.SPOT_TAGS_MAP[a.SpotType.STICKY]))||void 0===n?void 0:n.location;return(o=e.call(this,window.top.document.body,r,-1,t,-1,i)||this).positionTypes=[p==l.StickyLocation.BOTTOM?"bottom":"top"],o.isLazyLoading=!1,o}return o(t,e),t}(r.DirectSpot);t.StickySpot=p},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DcsFactory=void 0;var n=i(61),o=i(62),r=i(63),s=i(64),a=function(){function e(){}return e.buildDcs=function(e){var t=e.spotEngineConfig.dcs;if(t&&t.steps)switch(t.type){case"read_more":return this.buildReadMore(t);case"end_less":return this.buildEndless(t);case"gallery":return this.buildGallery(t);case"spa":return this.buildSpa(t);case"slides":default:return}},e.buildEndless=function(e){var t=e.steps[0],i=e.steps.find((function(e){return"distance"===e.type})),o=e.steps.find((function(e){return"url"===e.type}));if(t&&t.elementSelector&&t.containerSelector&&i&&i.value){var r=[{article:t.elementSelector.join(","),container:t.containerSelector.join(",")},{type:"distance",value:i.value}];if(o&&"true"===o.value){r.push({type:"urlChange",value:""})}return new n.DcsEndless(r,e)}},e.buildReadMore=function(e){if(1===e.steps.length){var t=e.steps[0].elementSelector;return t?new o.DcsReadMore(t):void 0}},e.buildGallery=function(e){var t=e.steps.find((function(e){return"button"===e.type})),i=e.steps.find((function(e){return"selector"===e.type})),n=e.steps.find((function(e){return"url"===e.type}));if(t&&t.elementSelector){var o=[{type:"buttonClick",value:t.elementSelector.join(",")}];if(n&&n.value){o.push({type:"urlChange",value:""})}return new r.DcsGallery(o,i&&i.elementSelector||[],e)}},e.buildSpa=function(e){var t=e.steps[0],i=e.steps.find((function(e){return"url"===e.type}));if(t&&t.elementSelector&&t.containerSelector){var n=[{article:t.elementSelector.join(","),container:t.containerSelector.join(",")}];if(i&&i.value){n.push({type:"urlChange",value:""})}return new s.DcsSpa(n,e)}},e}();t.DcsFactory=a},function(e,t,i){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.DcsEndless=void 0;var r=i(21),s=i(7),a=function(e){function t(t,i){var n=e.call(this,"end_less")||this;return n.eventType="dcs_endlessScroll",n.checkUrlChanges=!1,n.steps=t,n.checkUrlChanges=i.urlChange||n.checkUrlChanges,n.timeoutBeforeNewRun=i.delay,n}return o(t,e),t.prototype.prepareAndRunDcs=function(){var e=this,t=this.steps[0],i=this.steps[1],n=this.findUnhandledArticles(t);return n.shift(),n.forEach((function(t){e.logger.info("Handling unhandled",t);var n=Object.assign(i,{elements:[t]});e.checkStep(-1,n).then((function(){return e.logger.info("Unhandled element reached distance",n),e.handleStepsEnded(t)}))})),this.detectDcs(this.steps),Promise.resolve()},t.prototype.findUnhandledArticles=function(e){var t=s.DcsUtils.getHandledArticles(this.dcsObj),i=[];return Array.from(document.querySelectorAll(e.container)).forEach((function(n){var o=Array.from(n.querySelectorAll(e.article));i.push.apply(i,o.filter((function(e){return!t.includes(e)})))})),i},t}(r.DCS);t.DcsEndless=a},function(e,t,i){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.DcsReadMore=void 0;var r=i(21),s=i(1),a=i(8),l=i(3),d=i(7),p=i(12),c=i(4),u=i(5),f=function(e){function t(t){var i=e.call(this,"read_more")||this;return i.eventType="dcs_readMore",i.checkUrlChanges=!1,i.mutationConfig={},i.clickDetected=!1,i.selectors=t,i.elements=[],i}return o(t,e),t.prototype.prepareAndRunDcs=function(){var e=this;if(p.default.instance.scanBeforeDcs(),this.elements=s.Utils.querySelectorAll(this.selectors,(function(){})),this.elements.length){d.DcsUtils.isDcs=!0;var t=p.default.instance.spotsBeforeDcs,i=t.filter((function(e){return e.type===c.SpotType.FIXED_TOP||e.type===c.SpotType.FIXED_BOTTOM})).length,n=t.filter((function(e){return e.type===c.SpotType.DYNAMIC_RIGHT_RAIL||e.type===c.SpotType.FIXED_RIGHT_RAIL})).length,o=t.filter((function(e){return e.type===c.SpotType.DYNAMIC_LEFT_RAIL||e.type===c.SpotType.FIXED_LEFT_RAIL})).length;return l.EventsService.get().sendPageviewEvent(-1,-1,p.default.instance.getSpotsByType(c.SpotType.STICKY).length,i,n,o),this.buttonClickTrigger().then((function(){return e.handleStepsEnded(),e.onSpotEngineComplete.bind(e)}))}return Promise.reject("no elements found for selector: "+this.selectors)},t.prototype.buttonClickTrigger=function(){var e=this;return new Promise((function(t){var i=function(){e.clickDetected||(e.clickDetected=!0,e.elements.forEach((function(e){a.default.get().removeListener("click",e,i)})),setTimeout((function(){u.SpotsUtils.updateMCSpotsElements(),t()}),1e3))};e.elements.forEach((function(t){e.addListener("click",t,i)}))}))},t.prototype.handleStepsEnded=function(){this.logger.info("handleStepsEnded"),d.DcsUtils.isDcs=!0},t.prototype.onSpotEngineComplete=function(e){var t=e.getSpotsByType(c.SpotType.FIXED_BOTTOM).length+e.getSpotsByType(c.SpotType.FIXED_TOP).length,i={sf:e.getSpotsByType(c.SpotType.DYNAMIC_MC).length,fsf:e.getSpotsByType(c.SpotType.FIXED_MC).length,rrsf:e.getRightRailsSpotsFound().length,lrsf:e.getLeftRailsSpotsFound().length,ftbsf:t};this.sendDcsEvent(this.eventType,i)},t}(r.DCS);t.DcsReadMore=f},function(e,t,i){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.DcsGallery=void 0;var r=function(e){function t(t,i,n){var o=e.call(this,"gallery")||this;return o.eventType="dcs_gallery",o.checkUrlChanges=!1,o.articleSelectors=[],o.steps=t,o.articleSelectors=i||[],o.checkUrlChanges=n.urlChange||o.checkUrlChanges,o.timeoutBeforeNewRun=n.delay,o}return o(t,e),t.prototype.prepareAndRunDcs=function(){return this.dcsObj||(this.firstArticle=this.getArticleElement()),this.detectDcs(this.steps,this.checkUrlChanges)},t.prototype.handleStepsEnded=function(e){this.logger.info("handleStepsEnded");var t=this.getArticleElement()||e;this.RemoveBrowsiAdsFromDom(),this.dcsSuccessActions(t)},t.prototype.getArticleElement=function(){if(this.articleSelectors.length){var e=this.getElement(this.articleSelectors.join(","));if(e)return e}},t}(i(21).DCS);t.DcsGallery=r},function(e,t,i){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.DcsSpa=void 0;var r=function(e){function t(t,i){var n=e.call(this,"spa")||this;return n.eventType="dcs_spa",n.checkUrlChanges=!1,n.steps=t,n.checkUrlChanges=i.urlChange||n.checkUrlChanges,n.timeoutBeforeNewRun=i.delay,n}return o(t,e),t.prototype.prepareAndRunDcs=function(){return this.detectDcs(this.steps,this.checkUrlChanges)},t.prototype.handleStepsEnded=function(e){this.logger.info("handleStepsEnded"),this.RemoveBrowsiAdsFromDom(),this.dcsSuccessActions(e)},t}(i(21).DCS);t.DcsSpa=r},function(e,t){var i,n,o,r;if(Array.prototype.reduce||Object.defineProperty(Array.prototype,"reduce",{value:function(e){if(null===this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof e)throw new TypeError(e+" is not a function");var t,i=Object(this),n=i.length>>>0,o=0;if(arguments.length>=2)t=arguments[1];else{for(;o<n&&!(o in i);)o++;if(o>=n)throw new TypeError("Reduce of empty array with no initial value");t=i[o++]}for(;o<n;)o in i&&(t=e(t,i[o],o,i)),o++;return t}}),Array.prototype.filter||(Array.prototype.filter=function(e){"use strict";if(null==this)throw new TypeError;var t=Object(this),i=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var n=[],o=arguments.length>=2?arguments[1]:void 0,r=0;r<i;r++)if(r in t){var s=t[r];e.call(o,s,r,t)&&n.push(s)}return n}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),i=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var n=arguments[1],o=0;o<i;){var r=t[o];if(e.call(n,r,o,t))return r;o++}}}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(e),n=1;n<arguments.length;n++){var o=arguments[n];if(null!=o)for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(i[r]=o[r])}return i},writable:!0,configurable:!0}),Array.from||(Array.from=(i=Object.prototype.toString,n=function(e){return"function"==typeof e||"[object Function]"===i.call(e)},o=Math.pow(2,53)-1,r=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),o)},function(e){var t=this,i=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var o,s=arguments.length>1?arguments[1]:void 0;if(void 0!==s){if(!n(s))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(o=arguments[2])}for(var a,l=r(i.length),d=n(t)?Object(new t(l)):new Array(l),p=0;p<l;)a=i[p],d[p]=s?void 0===o?s(a,p):s.call(o,a,p):a,p+=1;return d.length=l,d})),Array.prototype.some||(Array.prototype.some=function(e){"use strict";if(null==this)throw new TypeError("Array.prototype.some called on null or undefined");if("function"!=typeof e)throw new TypeError;for(var t=Object(this),i=t.length>>>0,n=arguments.length>=2?arguments[1]:void 0,o=0;o<i;o++)if(o in t&&e.call(n,t[o],o,t))return!0;return!1}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(e,t){if(null==this)throw new TypeError('"this" is null or not defined');var i=Object(this),n=i.length>>>0;if(0===n)return!1;var o,r,s=0|t,a=Math.max(s>=0?s:n-Math.abs(s),0);for(;a<n;){if((o=i[a])===(r=e)||"number"==typeof o&&"number"==typeof r&&isNaN(o)&&isNaN(r))return!0;a++}return!1}}),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),i=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var n=arguments[1],o=0;o<i;){var r=t[o];if(e.call(n,r,o,t))return o;o++}return-1},configurable:!0,writable:!0}),Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},"function"!=typeof window.CustomEvent){window.CustomEvent=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:null};var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),i}}},function(e,t,i){"use strict";var n,o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.DemandTool=void 0;var r=i(0),s=i(1),a=i(12),l=i(17),d=i(2),p=i(5),c=i(4),u=i(67),f=i(3),h=i(9),g=((n={})["in-content"]="in",n.top="t",n.bottom="b",n.adhesive="s",n["right-rail"]="r",n["left-rail"]="l",n),m=function(){function e(){var e=this;this.logger=new r.Logger("BrowsiDemandTool");var t=s.Utils.getBrowsiTag();if(t&&!this.isAlreadyInitiated(t)){if(t.display=this.display.bind(this),t.insertPlacement=this.insertPlacement.bind(this),t.cmd)for(;t.cmd.length;){var i=t.cmd.shift();"function"==typeof i&&this.execute(i)}else t.cmd=[];t.cmd.push=function(t){return e.execute(t)}}}return e.prototype.execute=function(e){try{e()}catch(e){this.reportFailure(e,"")}},e.prototype.insertPlacement=function(e,t){this.display(e,{sizes:t})},e.prototype.display=function(e,t){var i=this;this.logger.info("display('"+e+"')",t),this.buildSpot(e,t).then((function(e){return l.YieldClient.get().processSingleSpot(e)})).catch((function(t){return i.reportFailure(t,e)}))},e.prototype.buildSpot=function(e,t){var i=this;return e&&"string"==typeof e?this.buildOptionsPromise(e,t).then((function(t){return i.validateElement(e).then((function(e){return i.validateSpot(e,t)}))})):Promise.reject("container ID is null or not a string - "+e)},e.prototype.buildOptionsPromise=function(e,t){return t?Promise.all([this.validateSizeArray(t.sizes),this.validateRefresh(t.refresh),this.validateKeyValuesArray(t.keyValues),this.validateAdUnit(t.adUnit),this.validateViewability(t.disableViewabilityOptimization),this.validatePositionType(e,t.positionTag)]).then((function(e){var t={sizes:e[0],refresh:e[1],keyValues:e[2],adUnit:e[3],disableViewabilityOptimization:e[4],positionTag:e[5]};return Object.keys(t).forEach((function(e){void 0===t[e]&&delete t[e]})),t})):Promise.resolve({})},e.prototype.validateSpot=function(e,t){var i=this;return new Promise((function(n,o){if(i.noSizesDefinedForSpot(t))return o("No sizes defined for this spot - "+e.id);i.logger.info("Processed element and options:",e,t);var r=a.default.instance.getApiSpots(),s=new u.ApiSpot(e,r.length,t);r.push(s),i.logger.info("Found api spot",s.ref),f.EventsService.get().sendSpotFoundEvent(s),n(s)}))},e.prototype.noSizesDefinedForSpot=function(e){var t,i={typeTag:h.TypeTag.API,positionTag:e.positionTag||"in",oldType:c.SpotType.API},n=(null===(t=p.SpotsUtils.getConf(i))||void 0===t?void 0:t.sizes)||[];return(!e.sizes||0===e.sizes.length)&&0===n.length},e.prototype.validateElement=function(e){return new Promise((function(t,i){var n=document.getElementById(e);n||i("no element with such id exists - "+e),t(n)}))},e.prototype.validateSizeArray=function(e){var t=this;return new Promise((function(i,n){e||i(),Array.isArray(e)||n("sizes is not a valid sizes array. Please supply an array of objects: {w: adWidth, h: adHeight}"),(e=t.validateSizes(e)).length||i(),i(e.map((function(e){return{w:e.w,h:e.h,adSizeType:d.Profiler.getAdSizeType(e),minSizeForWrapping:-1,optionalEmbeddings:["break"],selectedEmbedding:"break"}})))}))},e.prototype.validateRefresh=function(e){return new Promise((function(t,i){void 0===e&&t(),"boolean"==typeof e?t({active:!!e}):"object"==typeof e&&"boolean"==typeof e.active?(void 0!==e.refreshSecond&&("number"!=typeof e.refreshSecond||e.refreshSecond<=0)&&i("refresh.refresh.refreshSecond should be positive number"),t(o({active:!!e.active},e.refreshSecond?{refreshSecond:e.refreshSecond}:{}))):i("refresh is not a valid object. Please supply an object: {active: true/false}")}))},e.prototype.validateKeyValuesArray=function(e){var t=this;return new Promise((function(i,n){e||i(),!(e=t.removeUnsupportedKeyValues(e))||e.length&&!t.isInvalidKeyValuesArray(e)||n("keyValues is not a valid key-value array. Please supply an array of objects: {key: key, value: value}"),i(t.processKeyValuesArray(e))}))},e.prototype.processKeyValuesArray=function(e){var t=function(e){return"string"!=typeof e?e.toString():e};return e.forEach((function(e){Array.isArray(e.value)?e.value.forEach((function(i,n){e.value[n]=t(i)})):e.value=t(e.value)})),e.map((function(e){return{k:e.key,v:e.value}}))},e.prototype.validateAdUnit=function(e){var t=this;return new Promise((function(i,n){e||i(),e&&t.isInvalidAdUnit(e)&&n('adUnit is not in the valid format. Please make sure to send a string in the format: "pubId/adUnit"'),i(e)}))},e.prototype.validateViewability=function(e){return new Promise((function(t,i){if(e&&"boolean"!=typeof e)return i("optimizeViewability is not in the valid format. Please make sure to send a boolean value (true/false)");t(!!e)}))},e.prototype.validatePositionType=function(e,t){var i=this;return new Promise((function(n){if(!t){var o=d.Profiler.get().layouts.spots.api||{};return Object.keys(o).forEach((function(t){var r,s=null===(r=o[t])||void 0===r?void 0:r.positionIds;if(i.matchRegexOrString(e,s))return n(t)})),n("in")}return n(g[t])}))},e.prototype.matchRegexOrString=function(e,t){return!!(null==t?void 0:t.some((function(t){return new RegExp("^/.*/$").test(t)?(t=t.substring(1,t.length-1),new RegExp(t).test(e)):e===t})))},e.prototype.isInvalidSizeArray=function(e){return!Array.isArray(e)||0===e.length||e.some((function(e){return isNaN(e.w)||isNaN(e.h)}))},e.prototype.validateSizes=function(e){e=e.map((function(e){return"string"==typeof e&&"fluid"===e.toLowerCase()?{h:0,w:0}:{h:Number(e.h),w:Number(e.w)}}));return e.filter((function(e){return!function(e){return(isNaN(e.w)||isNaN(e.h))&&!("string"==typeof e&&"fluid"!==e.toLowerCase())}(e)}))},e.prototype.isInvalidKeyValuesArray=function(e){return!Array.isArray(e)||0===e.length},e.prototype.isSupportedKeyValType=function(e){return["string","number","boolean"].includes(typeof e)},e.prototype.removeUnsupportedKeyValues=function(e){var t=this;return e.filter((function(e){return!function(e){return"string"!=typeof e.key||!t.isSupportedKeyValType(e.value)&&(!Array.isArray(e.value)||e.value.some((function(e){return!t.isSupportedKeyValType(e)})))}(e)}))},e.prototype.isInvalidAdUnit=function(e){return"string"!=typeof e||1===e.split("/").length},e.prototype.isAlreadyInitiated=function(e){return!!e.display},e.prototype.reportFailure=function(e,t){this.logger.error("browsitag execution failed:",e),t="string"==typeof t?t:"",f.EventsService.get().sendApiRequestBlockedEvent("api_failed",e,t)},e}();t.DemandTool=m},function(e,t,i){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.ApiSpot=void 0;var r=i(9),s=i(4),a=i(5),l=i(2),d=i(7),p=i(37),c=i(27),u=function(e){function t(t,i,n){var o=this,l={positionTag:n.positionTag||"in",typeTag:r.TypeTag.API,oldType:s.SpotType.API},p=Math.min(i,c.AD_INDEX_LIMIT),u=(o=e.call(this,t,l,p,n.sizes||[],0,d.DcsUtils.isDcs)||this).getLayoutConfig(l.positionTag);return o.adIndex=500+p,o.options=n,o.compatibleSizes=n.sizes||u&&o.buildCompatibleSizes(u.sizes)||[],o.options.sizes=o.compatibleSizes,o.optimizeViewability=o.shouldOptimizeApiViewability(u),o.isLazyLoading=a.SpotsUtils.shouldLazyLoad(o),o}return o(t,e),t.prototype.getLayoutConfig=function(e){var t={typeTag:r.TypeTag.API,positionTag:e,oldType:s.SpotType.API};return a.SpotsUtils.getConf(t)},t.prototype.shouldOptimizeApiViewability=function(e){var t,i,n;if(e){var o=e.viewabilityOptimizationBlocklist,r=o&&(!!(null===(t=this.options)||void 0===t?void 0:t.adUnit)&&o.includes(null===(i=this.options)||void 0===i?void 0:i.adUnit)||o.includes(this.ref.id));return!(null===(n=this.options)||void 0===n?void 0:n.disableViewabilityOptimization)&&!r}return!0},t.prototype.checkSpotOptions=function(e){var t=this.options,i=e.c.d||e.c,n=this.attemptIndex>1;if(this.logger.info("Merging spot options:",t," waterfall ",n),e.c.ri&&void 0!==t.refresh&&(t.refresh.active?t.refresh.refreshSecond&&(e.c.ri.r=1e3*t.refresh.refreshSecond):e.c.ri.r=-1),!n){if(t.adUnit){var o=t.adUnit.split("/"),r=o[0],s=o.slice(1).join("/");i.a.pubID=r,i.au=s,this.adUnit=s}t.keyValues&&(e.kv=e.kv?e.kv.concat(t.keyValues):t.keyValues)}return e},t.prototype.prepareResponseForFetch=function(e){return this.checkSpotOptions(e)},t.prototype.buildCompatibleSizes=function(e){return e.map((function(e){return{w:e.w,h:e.h,adSizeType:l.Profiler.getAdSizeType(e),minSizeForWrapping:-1,optionalEmbeddings:["break"],selectedEmbedding:"break"}}))},t.prototype.handleEmptyResponse=function(){return 1==this.attemptIndex&&this.options&&this.options.adUnit&&this.options.sizes?{rt:"empty_api",c:{a:{autoSize:!0,inIframe:!1},t:1e3,au:this.options.adUnit.split("/").slice(1).join("/"),p:""},plk:"",s:!1}:null},t}(p.DirectSpot);t.ApiSpot=u}])}]);